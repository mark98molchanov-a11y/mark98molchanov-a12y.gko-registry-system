<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–¥–µ–ª –ì–ö–û: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tree Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>

    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body { 
            background-color: #f8fafc; 
            font-family: 'Inter', sans-serif;
        }
        
        .custom-scroll::-webkit-scrollbar { 
            width: 6px; 
            height: 6px; 
        }
        
        .custom-scroll::-webkit-scrollbar-track { 
            background: transparent; 
        }
        
        .custom-scroll::-webkit-scrollbar-thumb { 
            background: #cbd5e1; 
            border-radius: 3px; 
        }
        
        /* Tab styles */
        .tab-btn { 
            border-bottom: 2px solid transparent; 
            color: #64748b; 
            cursor: pointer; 
            transition: all 0.2s; 
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        
        .tab-btn:hover { 
            color: #1e293b; 
        }
        
        .tab-btn.active { 
            border-bottom: 2px solid #0ea5e9; 
            color: #0ea5e9; 
            font-weight: 600; 
        }
        
        /* Card animations */
        .card-anim { 
            transition: all 0.2s ease-out; 
        }
        
        .card-anim:hover { 
            transform: translateY(-2px); 
        }
        
        /* Filter chips */
        .filter-chip {
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        
        .filter-chip.active {
            background-color: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
            box-shadow: 0 2px 4px rgba(14, 165, 233, 0.3);
        }
        
        .filter-chip:not(.active):hover {
            background-color: #e2e8f0;
            color: #334155;
        }
        
        /* Checkbox */
        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            width: 1.25em; 
            height: 1.25em;
            border: 2px solid #cbd5e1;
            border-radius: 0.35em;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .custom-checkbox::before {
            content: "";
            width: 0.75em; 
            height: 0.75em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        
        .custom-checkbox:checked {
            background-color: #0ea5e9;
            border-color: #0ea5e9;
        }
        
        .custom-checkbox:checked::before { 
            transform: scale(1); 
        }
        
        /* Progress bar */
        .progress-bar-fill { 
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        /* Dashboard card */
        .dashboard-card {
            border-left: 4px solid #4f46e5;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4f46e510 0%, transparent 100%);
            border-radius: 0 0 0 60px;
        }
        
        /* Status badges */
        .status-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-active { 
            background-color: #10b98120; 
            color: #059669; 
        }
        
        .status-draft { 
            background-color: #f59e0b20; 
            color: #d97706; 
        }
        
        .status-archived { 
            background-color: #6b728020; 
            color: #4b5563; 
        }
        
        /* Tab content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        /* Chart */
        .chart-container { 
            height: 260px; 
        }
        
        /* Calculator */
        .calculator-tab {
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        /* Scrollbar */
        .no-scrollbar::-webkit-scrollbar { 
            display: none; 
        }
        
        .no-scrollbar { 
            -ms-overflow-style: none; 
            scrollbar-width: none; 
        }
        
        /* Methodology text */
        .methodology-text h3 { 
            color: #1e3a8a; 
            font-weight: 700; 
            margin-top: 1.5em; 
            margin-bottom: 0.5em; 
            font-size: 1.1em; 
        }
        
        .methodology-text h4 { 
            color: #1e40af; 
            font-weight: 600; 
            margin-top: 1em; 
            margin-bottom: 0.3em; 
            font-size: 0.95em; 
        }
        
        .methodology-text p { 
            margin-bottom: 0.8em; 
            line-height: 1.6; 
            text-align: justify; 
        }
        
        .methodology-text ul { 
            list-style-type: disc; 
            padding-left: 1.5em; 
            margin-bottom: 1em; 
        }
        
        .methodology-text li { 
            margin-bottom: 0.4em; 
        }
        
        .methodology-text .definition { 
            font-size: 0.9em; 
            color: #334155; 
            margin-left: 1em; 
            border-left: 2px solid #cbd5e1; 
            padding-left: 0.8em; 
            margin-bottom: 0.5em; 
        }
        
        .methodology-text .source { 
            font-size: 0.85em; 
            color: #64748b; 
            font-style: italic; 
            margin-top: 4px; 
            display: block; 
        }
        
        /* Calculator input */
        .calculator-input::placeholder {
            color: transparent;
        }
        
        /* Print styles */
        @media print {
            .no-print { 
                display: none !important; 
            }
            
            .print-only { 
                display: block !important; 
            }
            
            body { 
                background: white; 
            }
            
            .shadow-lg, .shadow-xl { 
                box-shadow: none !important; 
            }
            
            .border { 
                border: 1px solid #ddd !important; 
            }
        }
        
        .print-only { 
            display: none; 
        }
        
        /* Book layout */
        .book-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .book-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
            flex-shrink: 0;
            box-shadow: 1px 0 5px rgba(0,0,0,0.05);
        }
        
        .book-content {
            flex-grow: 1;
            overflow-y: auto;
            background: #f8fafc;
        }
        
        .book-section {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .book-section.main {
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .book-section.main:hover {
            background: linear-gradient(135deg, #075985 0%, #0c4a6e 100%);
        }
        
        .book-subsection {
            padding: 1rem 1.5rem 1rem 3rem;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
        }
        
        .book-subsection:hover {
            background: #f1f5f9;
            color: #0ea5e9;
        }
        
        .book-subsection.active {
            background: #e0f2fe;
            color: #0284c7;
            border-left: 4px solid #0ea5e9;
            font-weight: 600;
        }
        
        .section-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .book-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .book-header-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }
        
        .book-header-subtitle {
            font-size: 0.875rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        
        /* Capitalization section */
        .capitalization-section {
            border-top: 1px solid #e2e8f0;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
        }
        
        .book-subsubsection {
            padding: 0.75rem 1.5rem 0.75rem 3.5rem;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
            font-size: 0.875rem;
            background: #f8fafc;
        }
        
        .book-subsubsection:hover {
            background: #e0f2fe;
            color: #0284c7;
        }
        
        .book-subsubsection.active {
            background: #dbeafe;
            color: #1d4ed8;
            border-left: 3px solid #3b82f6;
            font-weight: 600;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .book-sidebar {
                width: 240px;
            }
        }
        
        @media (max-width: 768px) {
            .book-layout {
                flex-direction: column;
            }
            
            .book-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
                max-height: 300px;
            }
        }
        
        /* GitHub Token Modal */
        #githubTokenModal {
            transition: opacity 0.2s;
        }
        
        #githubTokenModal:not(.hidden) {
            opacity: 1;
        }
        
        #githubTokenModal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        #githubTokenInput {
            font-family: 'Consolas', 'Monaco', monospace;
            letter-spacing: 0.5px;
        }
        
        /* DIO Tree Styles */
        .dio-tree-container {
            width: 100%;
            height: calc(100vh - 180px);
            position: relative;
            overflow: hidden;
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        
        #dioTree {
            width: 100%;
            height: 100%;
        }
        
        .dio-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            background: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .dio-control-btn {
            padding: 0.5rem 1rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }
        
        .dio-control-btn:hover {
            background: #2563eb;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .node:hover {
            transform: scale(1.05);
        }
        
        .node-selected {
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
        }
        
        .tree-path {
            fill: none;
            stroke: #94a3b8;
            stroke-width: 2;
        }
        
        .tree-text {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            fill: #1e293b;
            text-anchor: middle;
            pointer-events: none;
        }
    </style>
</head>

<body class="text-slate-800 antialiased flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-4">
                    <div class="bg-brand-900 text-white p-2 rounded-lg shadow-lg">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-900 leading-none tracking-tight">–û—Ç–¥–µ–ª –ì–ö–û</h1>
                        <p class="text-xs text-slate-500 mt-1 font-medium">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <div class="flex gap-2">
                        <!-- Combined JSON Import -->
                        <button onclick="importJson()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                            <span>–ò–º–ø–æ—Ä—Ç JSON</span>
                        </button>

                        <button onclick="exportJson()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç JSON</span>
                        </button>

                        <!-- Save to GitHub -->
                        <button onclick="showGitHubTokenModal()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow flex items-center gap-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
                            </svg>
                            <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ GitHub</span>
                        </button>
                        
                        <button onclick="hardResetCurrent()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 011.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            <span id="resetBtnText">–°–±—Ä–æ—Å</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="book-layout">
        <!-- Sidebar -->
        <aside class="book-sidebar">
            <div class="book-section main" onclick="toggleAllSections()">
                <div class="section-icon">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                </div>
                <span>–û—Ç–¥–µ–ª –ì–ö–û</span>
                <div id="collapseIcon" class="ml-auto transition-transform">‚ñº</div>
            </div>
            
            <div id="subsectionsContainer">
                <div class="book-subsection" onclick="switchTab('npas')" id="navNPA">
                    <div class="section-icon">üìö</div>
                    <span>–†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê</span>
                </div>
                
                <div class="book-subsection" onclick="switchTab('dashboards')" id="navDashboards">
                    <div class="section-icon">üìä</div>
                    <span>–î–∞—à–±–æ—Ä–¥—ã superset</span>
                </div>
                
                <!-- –ë–∞–∑–∞ –î–ò–û -->
                <div class="book-subsection" onclick="switchTab('dio')" id="navDIO">
                    <div class="section-icon">
                        <img src="https://avatars.mds.yandex.net/i?id=b76c00669840a26fac6c5622da34239f_l-16407139-images-thumbs&n=13" 
                             style="width: 20px; height: 20px; object-fit: contain; border-radius: 4px;">
                    </div>
                    <span>–ë–∞–∑–∞ –î–ò–û</span>
                </div>
                
                <div class="capitalization-section">
                    <div class="book-subsection" onclick="toggleCapitalization()" id="navCapitalizationToggle">
                        <div class="section-icon">üí∞</div>
                        <span>–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
                        <div class="ml-auto transition-transform" id="capitalizationIcon">‚ñº</div>
                    </div>
                    
                    <div id="capitalizationSubsections" style="display: none;">
                        <div class="book-subsubsection" onclick="switchTab('calculator')" id="navCalculator">
                            <div class="section-icon">üßÆ</div>
                            <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="book-content">
            <!-- Header with dynamic buttons -->
            <div class="book-header">
                <div id="currentSectionTitle">
                    <div class="book-header-title" id="sectionTitle">–†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê</div>
                    <div class="book-header-subtitle" id="sectionSubtitle">–ë–∞–∑–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã—Ö –∞–∫—Ç–æ–≤</div>
                </div>
                
                <div class="flex items-center gap-3" id="currentSectionButtons">
                    <!-- –ù–ü–ê Import Buttons -->
                    <div id="npaImportButtons" class="flex gap-2">
                        <button onclick="document.getElementById('importInput').click()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span>–ò–º–ø–æ—Ä—Ç Excel</span>
                        </button>
                        <input type="file" id="importInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="handleFileImport(this)">
                    </div>
                    
                    <!-- Dashboards Import Buttons -->
                    <div id="dashboardsImportButtons" class="flex gap-2 hidden">
                        <button onclick="document.getElementById('importExcelInput').click()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span>–ò–º–ø–æ—Ä—Ç Excel</span>
                        </button>
                        <input type="file" id="importExcelInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="handleExcelImport(this)">
                    </div>
                    
                    <!-- DIO Import Buttons -->
                    <div id="dioImportButtons" class="flex gap-2 hidden">
                        <button onclick="importDIOJSON()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                            <span>–ò–º–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤–∞</span>
                        </button>
                        <button onclick="exportDIOJSON()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤–∞</span>
                        </button>
                    </div>
                    
                    <button id="addButton" onclick="openModal()" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow flex items-center gap-2 active:scale-95">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        <span id="addButtonText">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</span>
                    </button>
                </div>
            </div>

            <!-- –ù–ü–ê Tab -->
            <div class="tab-content active" id="npasTab">
                <div class="flex-grow w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 pb-24">
                    <!-- Statistics Section -->
                    <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <!-- Total Card -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="resetAllFilters()">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-brand-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-brand-100"></div>
                            <div class="relative z-10">
                                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–ù–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ</h3>
                                <div class="text-4xl font-extrabold text-slate-900" id="statTotal">0</div>
                                <div class="mt-4 flex items-center text-xs text-brand-600 font-medium">
                                    <span class="w-2 h-2 rounded-full bg-brand-500 mr-2"></span> –ó–∞–ø–∏—Å–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã
                                </div>
                            </div>
                        </div>
                        
                        <!-- Document Structure -->
                        <div class="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm md:col-span-3 flex flex-col justify-between">
                            <div class="flex justify-between items-center mb-4">
                                 <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–∏</h3>
                                 <span class="text-[10px] text-slate-400">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div onclick="setDocFilter('237-–§–ó')" class="p-3 rounded-xl bg-indigo-50 border border-indigo-100 cursor-pointer hover:bg-indigo-100 transition relative overflow-hidden group">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-indigo-900 text-xs">237-–§–ó</span>
                                        <span class="bg-white/80 text-indigo-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countFZ">0</span>
                                    </div>
                                    <div class="w-full bg-indigo-200 rounded-full h-1 overflow-hidden">
                                        <div id="barFZ" class="bg-indigo-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div onclick="setDocFilter('–ü—Ä–∏–∫–∞–∑ ‚Ññ –ü/0336')" class="p-3 rounded-xl bg-sky-50 border border-sky-100 cursor-pointer hover:bg-sky-100 transition relative overflow-hidden group">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-sky-900 text-xs">–ü—Ä–∏–∫–∞–∑ –ü/0336</span>
                                        <span class="bg-white/80 text-sky-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countOrder">0</span>
                                    </div>
                                    <div class="w-full bg-sky-200 rounded-full h-1 overflow-hidden">
                                        <div id="barOrder" class="bg-sky-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div onclick="setDocFilter('378.2 –ù–ö –†–§')" class="p-3 rounded-xl bg-amber-50 border border-amber-100 cursor-pointer hover:bg-amber-100 transition relative overflow-hidden group">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-amber-900 text-xs">378.2 –ù–ö –†–§</span>
                                        <span class="bg-white/80 text-amber-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countNK">0</span>
                                    </div>
                                    <div class="w-full bg-amber-200 rounded-full h-1 overflow-hidden">
                                        <div id="barNK" class="bg-amber-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Filters and Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 space-y-4">
                            <!-- Search and Sort -->
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row gap-4">
                                <div class="relative flex-grow">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </span>
                                    <input type="text" id="searchInput" oninput="renderGrid()" placeholder="–ü–æ–∏—Å–∫..." class="pl-10 pr-4 py-2.5 w-full border border-slate-200 bg-slate-50 rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                                </div>
                                <select id="sortSelect" onchange="renderGrid()" class="py-2.5 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none cursor-pointer">
                                    <option value="lastUpdated">üïí –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è</option>
                                    <option value="dateDesc">üìÖ –ü–æ –¥–∞—Ç–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
                                    <option value="dateAsc">üìÖ –ü–æ –¥–∞—Ç–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
                                </select>
                            </div>
                            
                            <!-- Filters -->
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4">
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–§–∏–ª—å—Ç—Ä –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É</div>
                                    <div class="flex gap-2 overflow-x-auto custom-scroll pb-1" id="docFilterContainer"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É</div>
                                    <div class="flex gap-2 flex-wrap" id="typeFilterContainer"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–µ–≥–∏</div>
                                    <div class="flex gap-2 flex-wrap" id="targetContainer"></div>
                                </div>
                            </div>
                            
                            <!-- Active Filters Bar -->
                            <div id="activeFiltersBar" class="hidden flex items-center justify-between bg-brand-50 border border-brand-100 text-brand-700 px-4 py-2 rounded-lg text-sm">
                                <span class="font-medium">–§–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
                                <button onclick="resetAllFilters()" class="text-xs font-bold uppercase hover:text-brand-900 underline">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </div>
                        
                        <!-- Chart -->
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–≤ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–µ)</h4>
                            <div class="flex-grow relative" style="min-height: 300px;">
                                <canvas id="typeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Records List -->
                    <div class="flex items-center justify-between mt-2 mb-1">
                        <div class="text-sm text-slate-500 font-medium">–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π (<span id="filteredCount">0</span>)</div>
                        <div class="flex gap-2">
                            <button onclick="exportToExcelNPA()" class="text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                –≠–∫—Å–ø–æ—Ä—Ç Excel
                            </button>
                            <button onclick="toggleSelectAll()" class="text-xs text-brand-600 font-bold hover:underline ml-4">–í—ã–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    
                    <!-- Cards Grid -->
                    <div id="cardsGrid" class="grid grid-cols-1 gap-4"></div>
                </div>
            </div>

            <!-- Dashboards Tab -->
            <div class="tab-content" id="dashboardsTab">
                <div class="flex-grow w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 pb-24">
                    <!-- Dashboards content (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
                    <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="resetAllDashboardsFilters()">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-superset-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-superset-100"></div>
                            <div class="relative z-10">
                                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–í—Å–µ–≥–æ –¥–∞—à–±–æ—Ä–¥–æ–≤</h3>
                                <div class="text-4xl font-extrabold text-slate-900" id="statTotalDashboards">0</div>
                                <div class="mt-4 flex items-center text-xs text-superset-600 font-medium">
                                    <span class="w-2 h-2 rounded-full bg-superset-500 mr-2"></span> –í —Å–∏—Å—Ç–µ–º–µ Apache Superset
                                </div>
                            </div>
                        </div>
                        
                        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–∞—à–±–æ—Ä–¥–æ–≤... -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="setStatusFilterDashboards('active')">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-emerald-100"></div>
                            <div class="relative z-10">
                                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–ê–∫—Ç–∏–≤–Ω—ã–µ</h3>
                                <div class="text-4xl font-extrabold text-emerald-600" id="statActiveDashboards">0</div>
                                <div class="mt-4 flex items-center text-xs text-emerald-600 font-medium">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2"></span> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–±–æ—Ç–µ
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group md:col-span-2">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-amber-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-amber-100"></div>
                            <div class="relative z-10">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">–ü–æ —Ç–∏–ø–∞–º –∞–Ω–∞–ª–∏–∑–∞</h3>
                                    <span class="text-[10px] text-slate-400">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div onclick="setTypeFilterDashboards('analytical')" class="p-2.5 rounded-xl bg-slate-50 border border-slate-100 cursor-pointer hover:bg-slate-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-slate-700 text-xs">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                                            <span class="bg-white text-slate-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countAnalytical">0</span>
                                        </div>
                                    </div>
                                    
                                    <div onclick="setTypeFilterDashboards('monitoring')" class="p-2.5 rounded-xl bg-blue-50 border border-blue-100 cursor-pointer hover:bg-blue-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-blue-700 text-xs">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</span>
                                            <span class="bg-white text-blue-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countMonitoring">0</span>
                                        </div>
                                    </div>
                                    
                                    <div onclick="setTypeFilterDashboards('operational')" class="p-2.5 rounded-xl bg-purple-50 border border-purple-100 cursor-pointer hover:bg-purple-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-purple-700 text-xs">–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ</span>
                                            <span class="bg-white text-purple-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countOperational">0</span>
                                        </div>
                                    </div>
                                    
                                    <div onclick="setTypeFilterDashboards('reporting')" class="p-2.5 rounded-xl bg-rose-50 border border-rose-100 cursor-pointer hover:bg-rose-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-rose-700 text-xs">–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å</span>
                                            <span class="bg-white text-rose-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countReporting">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤... -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 space-y-4">
                            <!-- Search -->
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row gap-4">
                                <div class="relative flex-grow">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </span>
                                    <input type="text" id="searchInputDashboards" oninput="renderDashboardsGrid()" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é..." class="pl-10 pr-4 py-2.5 w-full border border-slate-200 bg-slate-50 rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                                </div>
                                <select id="sortSelectDashboards" onchange="renderDashboardsGrid()" class="py-2.5 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none cursor-pointer">
                                    <option value="createdDesc">üìÖ –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
                                    <option value="createdAsc">üìÖ –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
                                    <option value="nameAsc">üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                                    <option value="nameDesc">üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                                </select>
                            </div>
                            
                            <!-- Filters -->
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4">
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–°—Ç–∞—Ç—É—Å</div>
                                    <div class="flex gap-2 overflow-x-auto custom-scroll pb-1" id="statusFilterContainerDashboards"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</div>
                                    <div class="flex gap-2 flex-wrap" id="typeFilterContainerDashboards"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–µ–≥–∏</div>
                                    <div class="flex gap-2 flex-wrap" id="tagsContainerDashboards"></div>
                                </div>
                            </div>
                            
                            <!-- Active Filters Bar -->
                            <div id="activeFiltersBarDashboards" class="hidden flex items-center justify-between bg-brand-50 border border-brand-100 text-brand-700 px-4 py-2 rounded-lg text-sm">
                                <span class="font-medium">–§–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
                                <button onclick="resetAllDashboardsFilters()" class="text-xs font-bold uppercase hover:text-brand-900 underline">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </div>
                        
                        <!-- Chart -->
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –∞–Ω–∞–ª–∏–∑–∞</h4>
                            <div class="chart-container">
                                <canvas id="typeChartDashboards"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dashboard List -->
                    <div class="flex items-center justify-between mt-2 mb-1">
                        <div class="text-sm text-slate-500 font-medium">–î–∞—à–±–æ—Ä–¥—ã (<span id="filteredCountDashboards">0</span>)</div>
                        <div class="flex gap-2">
                            <button onclick="exportToExcelDashboards()" class="text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                –≠–∫—Å–ø–æ—Ä—Ç Excel
                            </button>
                            <button onclick="toggleSelectAllDashboards()" class="text-xs text-brand-600 font-bold hover:underline ml-4">–í—ã–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Cards -->
                    <div id="cardsGridDashboards" class="grid grid-cols-1 lg:grid-cols-2 gap-6"></div>
                </div>
            </div>

            <!-- Calculator Tab -->
            <div class="tab-content calculator-tab" id="calculatorTab">
                <div id="calculatorRoot"></div>
            </div>

            <!-- DIO Tree Tab -->
            <div class="tab-content" id="dioTab">
                <div class="flex-grow w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-4">
                    <!-- DIO Tree Controls -->
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div class="flex flex-wrap gap-3 items-center justify-between">
                            <div class="flex flex-wrap gap-2">
                                <button onclick="addDIORootNode()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª
                                </button>
                                
                                <button onclick="addDIOSubNode()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–π
                                </button>
                                
                                <button onclick="editDIONode()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                
                                <button onclick="deleteDIONode()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 011.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                            
                            <div class="flex flex-wrap gap-2">
                                <button onclick="collapseAllDIONodes()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                    –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ
                                </button>
                                
                                <button onclick="expandAllDIONodes()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                    </svg>
                                    –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ
                                </button>
                                
                                <button onclick="saveDIOTree()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ—Ä–µ–≤–æ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- DIO Tree Container -->
                    <div class="dio-tree-container" id="dioTreeContainer">
                        <div id="dioTree"></div>
                        
                        <!-- Floating Controls -->
                        <div class="dio-controls">
                            <button class="dio-control-btn" onclick="zoomInDIO()">+ –£–≤–µ–ª–∏—á–∏—Ç—å</button>
                            <button class="dio-control-btn" onclick="zoomOutDIO()">- –£–º–µ–Ω—å—à–∏—Ç—å</button>
                            <button class="dio-control-btn" onclick="resetZoomDIO()">‚ü≤ –°–±—Ä–æ—Å–∏—Ç—å</button>
                            <button class="dio-control-btn" onclick="centerDIO()">‚óé –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>
                    
                    <!-- Node Info Panel -->
                    <div id="dioNodeInfo" class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mt-4 hidden">
                        <h3 class="text-lg font-bold mb-3">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —É–∑–ª–µ</h3>
                        <div id="nodeDetails" class="space-y-2">
                            <!-- Node details will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-auto py-4">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-slate-400">&copy; 2026 –û—Ç–¥–µ–ª –ì–ö–û</p>
        </div>
    </footer>

    <!-- Bulk Toolbars -->
    <div id="bulkToolbar" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-40 hidden flex items-center gap-6 animate-bounce-in transition-all">
        <div class="text-sm font-medium"><span id="bulkCount">0</span> –≤—ã–±—Ä–∞–Ω–æ</div>
        <div class="h-4 w-px bg-slate-700"></div>
        <div class="flex gap-2">
            <button onclick="openBulkEditModal()" class="hover:text-brand-400 transition text-sm font-bold flex items-center gap-1">‚úèÔ∏è –ü—Ä–∞–≤–∫–∞</button>
            <button onclick="bulkDelete()" class="hover:text-red-400 transition text-sm font-bold flex items-center gap-1 ml-2">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
        <button onclick="clearSelection()" class="ml-4 text-slate-500 hover:text-white text-xs">&times;</button>
    </div>
    
    <div id="bulkToolbarDashboards" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-40 hidden flex items-center gap-6 animate-bounce-in transition-all">
        <div class="text-sm font-medium"><span id="bulkCountDashboards">0</span> –≤—ã–±—Ä–∞–Ω–æ</div>
        <div class="h-4 w-px bg-slate-700"></div>
        <div class="flex gap-2">
            <button onclick="openBulkEditModalDashboards()" class="hover:text-brand-400 transition text-sm font-bold flex items-center gap-1">‚úèÔ∏è –ü—Ä–∞–≤–∫–∞</button>
            <button onclick="bulkDeleteDashboards()" class="hover:text-red-400 transition text-sm font-bold flex items-center gap-1 ml-2">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            <button onclick="bulkOpenDashboards()" class="hover:text-emerald-400 transition text-sm font-bold flex items-center gap-1 ml-2">üîó –û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
        <button onclick="clearSelectionDashboards()" class="ml-4 text-slate-500 hover:text-white text-xs">&times;</button>
    </div>

    <!-- GitHub Token Modal -->
    <div id="githubTokenModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50" onclick="closeGitHubModal()"></div>
        <div class="relative bg-white w-96 mx-auto mt-32 rounded-xl shadow-xl p-6">
            <h3 class="text-lg font-bold mb-4">üîë GitHub Token</h3>
            
            <input 
                type="password" 
                id="githubTokenInput" 
                placeholder="github_pat_..." 
                class="w-full border p-3 rounded-lg mb-3 text-sm font-mono"
                autocomplete="off"
            >
            
            <p class="text-xs text-gray-500 mb-4">
                –í–≤–µ–¥–∏—Ç–µ Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ <code>repo</code>
            </p>
            
            <div class="flex gap-2">
                <button onclick="closeGitHubModal()" class="flex-1 py-2 border rounded-lg">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="saveToGitHub()" class="flex-1 py-2 bg-emerald-500 text-white rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- DIO Node Modal -->
    <div id="dioNodeModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50" onclick="closeDIONodeModal()"></div>
        <div class="relative bg-white w-full max-w-2xl mx-auto mt-32 rounded-xl shadow-xl p-6">
            <h3 class="text-lg font-bold mb-4" id="dioModalTitle">–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —É–∑–ª–∞ *</label>
                    <input type="text" id="dioNodeName" class="w-full border border-slate-300 rounded-lg px-3 py-2" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–∑–ª–∞">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="dioNodeDescription" rows="3" class="w-full border border-slate-300 rounded-lg px-3 py-2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É–∑–ª–∞"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">–¢–∏–ø —É–∑–ª–∞</label>
                        <select id="dioNodeType" class="w-full border border-slate-300 rounded-lg px-3 py-2">
                            <option value="department">–û—Ç–¥–µ–ª</option>
                            <option value="position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</option>
                            <option value="function">–§—É–Ω–∫—Ü–∏—è</option>
                            <option value="document">–î–æ–∫—É–º–µ–Ω—Ç</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">–°—Ç–∞—Ç—É—Å</label>
                        <select id="dioNodeStatus" class="w-full border border-slate-300 rounded-lg px-3 py-2">
                            <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
                            <option value="archived">–ê—Ä—Ö–∏–≤–Ω—ã–π</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                    <input type="text" id="dioNodeTags" class="w-full border border-slate-300 rounded-lg px-3 py-2" placeholder="–¢–µ–≥1, –¢–µ–≥2, –¢–µ–≥3">
                </div>
            </div>
            
            <div class="flex gap-2 mt-6">
                <button onclick="closeDIONodeModal()" class="flex-1 py-2 border rounded-lg">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="saveDIONode()" class="flex-1 py-2 bg-blue-500 text-white rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –î–ò–û -->
    <script src="indexed-db-manager.js"></script>
    <script src="tree-manager-core.js"></script>
    <script src="node-effects.js"></script>
    <script src="main.js"></script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript -->
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'] 
                    },
                    colors: {
                        brand: { 
                            50: '#f0f9ff', 
                            100: '#e0f2fe', 
                            500: '#0ea5e9', 
                            600: '#0284c7', 
                            700: '#0369a1', 
                            800: '#075985', 
                            900: '#0c4a6e' 
                        },
                        superset: {
                            50: '#eef2ff',
                            500: '#4f46e5',
                            600: '#4338ca',
                            700: '#3730a3'
                        },
                        calculator: {
                            50: '#f0f9ff',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9'
                        }
                    }
                }
            }
        };
    </script>

    <!-- React –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞) -->
 <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;
    const IconCalculator = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
    const IconDatabase = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>;
    const IconMap = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>;
    const IconFileText = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>;
    const IconShieldCheck = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="m9 12 2 2 4-4"/></svg>;
    const IconBookOpen = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
    const IconRotateCcw = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
    const IconCoins = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="M17.12 12.23A6 6 0 0 1 5 13.5"/></svg>;
    const IconChevronDown = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>;
    const IconChevronUp = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>;
    const IconAlertCircle = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
    const IconDownload = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
    const IconUpload = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
    const IconCalendar = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
    const IconCopy = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
    const Card = ({ children, className = "" }) => (
        <div className={`bg-white rounded-xl border border-slate-200 shadow-sm ${className}`}>
            {children}
        </div>
    );
    const ResultBreakdown = ({ items, total }) => {
        const [isOpen, setIsOpen] = useState(true);
        return (
            <div className="mt-6 border border-blue-100 rounded-lg overflow-hidden no-print">
                <button 
                    onClick={() => setIsOpen(!isOpen)}
                    className="w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 transition-colors"
                >
                    <div className="flex items-center gap-2 font-semibold text-blue-900 text-sm">
                        <IconCalculator size={16} />
                        <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞</span>
                    </div>
                    <div className="flex items-center gap-2">
                        <span className="font-bold text-blue-700">{total.toFixed(2)}%</span>
                        {isOpen ? <IconChevronUp size={16} /> : <IconChevronDown size={16} />}
                    </div>
                </button>
                {isOpen && (
                    <div className="p-3 bg-white space-y-2">
                    {items.map((item, idx) => (
                        <div key={idx} className="flex justify-between items-center py-2 border-b border-slate-100 last:border-0">
                            <div className="pr-4">
                                <div className="text-sm font-medium text-slate-700">{item.label}</div>
                                <div className="text-xs text-slate-500">{item.desc}</div>
                            </div>
                            <div className={`text-sm font-bold font-mono px-2 py-1 rounded ${
                                item.value >= 80 ? 'bg-green-100 text-green-700' : 
                                item.value >= 50 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'
                            }`}>
                                {item.value.toFixed(2)}%
                            </div>
                        </div>
                    ))}
                    </div>
                )}
            </div>
        );
    };
    const CalculatorInputGroup = ({ label, value, onChange, placeholder, hint }) => {
        const [localValue, setLocalValue] = useState(value === 0 ? '' : value.toString());

        useEffect(() => {
            const currentNumeric = localValue === '' ? 0 : parseFloat(localValue.replace(',', '.'));
            
            if (currentNumeric !== value) {
                setLocalValue(value === 0 ? '' : value.toString());
            }
        }, [value]);

        const handleChange = (e) => {
            const input = e.target.value;
            if (/^[0-9.,-]*$/.test(input)) {
                setLocalValue(input);
                const normalized = input.replace(/,/g, '.');
                const parsed = parseFloat(normalized);
                if (!isNaN(parsed)) onChange(parsed); else onChange(0);
            }
        };

        return (
            <div className="mb-4 break-inside-avoid">
                <label className="block text-sm font-medium text-slate-700 mb-1">{label}</label>
                <div className="relative">
                    <input
                        type="text"
                        inputMode="decimal"
                        value={localValue}
                        onChange={handleChange}
                        className="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:outline-none focus:border-blue-500 transition-colors calculator-input"
                        placeholder="" 
                    />
                    {hint && (
                        <div className="mt-1 text-xs text-slate-400 flex items-center gap-1 no-print">
                            <IconAlertCircle size={12} /> {hint}
                        </div>
                    )}
                </div>
            </div>
        );
    };

function EfficiencyCalculator() {
    const [activeCalcTab, setActiveCalcTab] = useState(0);
    const [moneyUnit, setMoneyUnit] = useState('rub'); 
    const [period, setPeriod] = useState('2025_year');
    const [calculatorData, setCalculatorData] = useState({});
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
        console.log('üîç –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è...');
        
        try {
            const savedDataStr = localStorage.getItem('gko_calculator_data_v1');
            console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ localStorage (—Å—ã—Ä—ã–µ):', savedDataStr);
            
            if (savedDataStr) {
                const savedData = JSON.parse(savedDataStr);
                console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ localStorage (–ø–∞—Ä—Å–∏–Ω–≥):', savedData);

                if (savedData && typeof savedData === 'object') {
                    const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                    const initialDataModel = {
                        ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                        ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                        k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                        s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                        k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                        k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                    };
                    const newData = {};
                    periodsList.forEach(p => {
                        if (savedData[p]) {
                            newData[p] = { ...initialDataModel, ...savedData[p] };
                        } else {
                            newData[p] = { ...initialDataModel };
                        }
                    });
                    
                    console.log('–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', newData);
                    setCalculatorData(newData);
                } else {
                    console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É—é –Ω–∞—á–∞–ª—å–Ω—ã–µ');
                    const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                    const initialDataModel = {
                        ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                        ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                        k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                        s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                        k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                        k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                    };
                    
                    const initialDb = {};
                    periodsList.forEach(p => initialDb[p] = { ...initialDataModel });
                    setCalculatorData(initialDb);
                }
            } else {
                console.log('localStorage –ø—É—Å—Ç –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞');
                const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                const initialDataModel = {
                    ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                    ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                    k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                    s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                    k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                    k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                };
                
                const initialDb = {};
                periodsList.forEach(p => initialDb[p] = { ...initialDataModel });
                setCalculatorData(initialDb);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞:', error);
            const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
            const initialDataModel = {
                ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
            };
            
            const initialDb = {};
            periodsList.forEach(p => initialDb[p] = { ...initialDataModel });
            setCalculatorData(initialDb);
        } finally {
            setIsLoading(false);
        }
    }, []);

    const moneyLabels = {
        'rub': '—Ä—É–±.', 'thous': '—Ç—ã—Å. —Ä—É–±.', 'mln': '–º–ª–Ω —Ä—É–±.', 'bln': '–º–ª—Ä–¥ —Ä—É–±.', 'trln': '—Ç—Ä–ª–Ω —Ä—É–±.'
    };

    const periodsList = [
        { id: '2025_year', label: '2025 –≥–æ–¥' },
        { id: '2026_1_kv', label: '2026 - 1 –∫–≤–∞—Ä—Ç–∞–ª' },
        { id: '2026_2_kv', label: '2026 - 2 –∫–≤–∞—Ä—Ç–∞–ª' },
        { id: '2026_3_kv', label: '2026 - 3 –∫–≤–∞—Ä—Ç–∞–ª' },
        { id: '2026_4_kv', label: '2026 - 4 –∫–≤–∞—Ä—Ç–∞–ª' },
    ];

    const initialDataModel = {
        ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
        ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
        k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
        s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
        k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
        k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
    };
    const currentData = calculatorData[period] || { ...initialDataModel };
    const updateCalcData = (field, value) => {
        console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: ${field} = ${value}`);
        
        const updatedData = {
            ...calculatorData,
            [period]: {
                ...(calculatorData[period] || {}),
                [field]: value
            }
        };
        
        console.log('–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', updatedData);
        setCalculatorData(updatedData);
        localStorage.setItem('gko_calculator_data_v1', JSON.stringify(updatedData));
        console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage');
    };

    const copyFromPreviousPeriod = () => {
        const currentIndex = periodsList.findIndex(p => p.id === period);
        if (currentIndex > 0) {
            const prevPeriodId = periodsList[currentIndex - 1].id;
            const prevData = calculatorData[prevPeriodId];
            
            if (confirm(`–í—Å—Ç–∞–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ "${periodsList[currentIndex - 1].label}" –≤ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥? –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.`)) {
                const updatedData = {
                    ...calculatorData,
                    [period]: prevData ? { ...prevData } : { ...initialDataModel }
                };
                
                setCalculatorData(updatedData);
                localStorage.setItem(STORAGE_KEY_CALCULATOR, JSON.stringify(updatedData));
            }
        } else {
            alert("–≠—Ç–æ –ø–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥, –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏.");
        }
    };
        const calculateResults = (data) => {
            const calcPerc = (num, den) => {
                if (den === 0) return 0;
                let val = (num / den) * 100;
                return Math.min(100, Math.max(0, val));
            };
            let sub1_1 = calcPerc(data.ks_otch, data.ks_cel);

            const k_changes = data.k_21 + (data.k_22 + data.k_22_1) + data.k_sud;
            const sub1_2 = (data.k_on_obsh > 0) ? Math.min(100, Math.max(0, (1 - (k_changes / data.k_on_obsh)) * 100)) : 0;

            const ks_changes = data.ks_21 + (data.ks_22 + data.ks_22_1) + data.ks_sud;
            const sub1_3 = (data.ks_on_obsh > 0) ? Math.min(100, Math.max(0, (1 - (ks_changes / data.ks_on_obsh)) * 100)) : 0;

            const ind1 = (sub1_1 + sub1_2 + sub1_3) / 3;
            const bad_net = Math.max(0, data.k_bezrp - data.k_mkd - data.k_vyyavl);
            const sub2_1 = (data.k_on_obsh_reestr > 0) ? Math.min(100, Math.max(0, (1 - (bad_net / data.k_on_obsh_reestr)) * 100)) : 0;
            
            const sub2_2 = (data.k_on_obsh_reestr > 0) ? Math.min(100, Math.max(0, (1 - (data.k_nkor / data.k_on_obsh_reestr)) * 100)) : 0;
            
            const ind2 = (sub2_1 + sub2_2) / 2;

            let sub3_1 = calcPerc(data.s_vyyavl, data.s_ter);
            const sub3_2 = calcPerc(data.s_vuf, data.s_gosmun);
            const ind3 = (sub3_1 + sub3_2) / 2;

            let sub4_1 = calcPerc(data.k_ps, data.k_pdpr);
            const sub4_2 = calcPerc(data.k_reg, data.k_obsh_reg);
            const ind4 = (sub4_1 + sub4_2) / 2;

            const violations_total = data.k_vknm_gzn + data.k_vknm_mzk;
            const checks_total = data.k_pknm_gzn + data.k_pknm_mzk;
            const fixed_total = data.k_uknm_gzn + data.k_uknm_mzk;

            const sub5_1 = calcPerc(violations_total, checks_total); 
            const sub5_2 = calcPerc(fixed_total, violations_total);
            
            const ind5 = (sub5_1 + sub5_2) / 2;

            const total = (ind1 * 0.25) + (ind2 * 0.25) + (ind3 * 0.25) + (ind4 * 0.125) + (ind5 * 0.125);

            return { ind1, ind2, ind3, ind4, ind5, total, sub1_1, sub1_2, sub1_3, sub2_1, sub2_2, sub3_1, sub3_2, sub4_1, sub4_2, sub5_1, sub5_2 };
        };

        const results = useMemo(() => calculateResults(currentData), [currentData]);

 const resetCurrentCalcPeriod = () => {
            if (!confirm(`–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∞ "${periodsList.find(p => p.id === period)?.label}"?`)) {
                return;
            }
            
            const emptyData = {
                ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
            };
            
            const updatedData = {
                ...calculatorData,
                [period]: emptyData
            };
            
            setCalculatorData(updatedData);
            localStorage.setItem('gko_calculator_data_v1', JSON.stringify(updatedData));
            
            showNotification(`–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –æ—á–∏—â–µ–Ω—ã`, 'success');
        };
        const sections = [
            { title: "–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞", short: "–ö–∞–¥–∞—Å—Ç—Ä", icon: IconCalculator, weight: "25%", color: "text-blue-600", bg: "bg-blue-100", numWeight: 0.25 },
            { title: "–†–µ–µ—Å—Ç—Ä –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", short: "–†–µ–µ—Å—Ç—Ä", icon: IconDatabase, weight: "25%", color: "text-indigo-600", bg: "bg-indigo-100", numWeight: 0.25 },
            { title: "–í–æ–≤–ª–µ—á–µ–Ω–∏–µ –∑–µ–º–µ–ª—å", short: "–ó–µ–º–ª—è", icon: IconMap, weight: "25%", color: "text-green-600", bg: "bg-green-100", numWeight: 0.25 },
            { title: "–§–ì–ò–° –ï–¶–ü –ù–°–ü–î", short: "–ù–°–ü–î", icon: IconFileText, weight: "12.5%", color: "text-purple-600", bg: "bg-purple-100", numWeight: 0.125 },
            { title: "–ó–µ–º–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å", short: "–ö–æ–Ω—Ç—Ä–æ–ª—å", icon: IconShieldCheck, weight: "12.5%", color: "text-red-600", bg: "bg-red-100", numWeight: 0.125 },
            { title: "–ú–µ—Ç–æ–¥–∏–∫–∞", short: "–ò–Ω—Ñ–æ", icon: IconBookOpen, weight: "–ò–Ω—Ñ–æ", color: "text-slate-600", bg: "bg-slate-100", numWeight: 0 },
        ];

        const finalResultsArray = [
            { section: sections[0], val: results.ind1 },
            { section: sections[1], val: results.ind2 },
            { section: sections[2], val: results.ind3 },
            { section: sections[3], val: results.ind4 },
            { section: sections[4], val: results.ind5 },
        ];

        return (
            <div className="max-w-7xl mx-auto p-2 md:p-6">

                <header className="mb-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col xl:flex-row justify-between items-center gap-4 no-print">
                    <div>
                        <h1 className="text-xl font-bold text-slate-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h1>
                        <p className="text-slate-500 text-sm">–ù–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º (–ö–≤–∞—Ä—Ç–∞–ª / –ì–æ–¥)</p>
                    </div>
                    <div className="flex flex-wrap gap-2 items-center justify-center">
                        
                        <div className="flex items-center bg-slate-50 border border-slate-300 rounded-lg p-1">
                            <div className="pl-2 pr-1 text-slate-500"><IconCalendar size={16} /></div>
                            <select value={period} onChange={(e) => setPeriod(e.target.value)} className="bg-transparent text-sm focus:outline-none p-1 cursor-pointer font-medium text-slate-700 min-w-[140px]">
                                {periodsList.map(p => <option key={p.id} value={p.id}>{p.label}</option>)}
                            </select>
                        </div>

                        <button onClick={copyFromPreviousPeriod} className="flex items-center gap-1 px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-blue-50 hover:text-blue-600 text-xs font-medium transition-colors border border-slate-200" title="–í–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∫–∞–∫ –æ—Å–Ω–æ–≤—É">
                            <IconCopy size={14} /> <span className="hidden sm:inline">–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –ø—Ä–µ–¥. –ø–µ—Ä–∏–æ–¥–∞</span>
                        </button>

                        <div className="w-px h-6 bg-slate-300 mx-2 hidden xl:block"></div>

<button onClick={resetCurrentCalcPeriod} cRotateCcw size={16} />
</button>
                    </div>
                </header>
                
                <div className="print-only mb-8">
                    <h1 className="text-3xl font-bold">–û—Ç—á–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≠–∫–∞–ø)</h1>
                    <p className="text-xl mt-2">–ü–µ—Ä–∏–æ–¥: <b>{periodsList.find(p=>p.id===period)?.label}</b></p>
                    <p className="text-sm text-slate-500">–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: {new Date().toLocaleDateString()}</p>
                </div>

                <div className="grid grid-cols-1 xl:grid-cols-4 gap-6">
                    
                    <div className="xl:col-span-3 space-y-4">
                        
                        <div className="flex overflow-x-auto gap-2 pb-1 no-scrollbar no-print">
                            {sections.map((s, idx) => (
                                <button key={idx} onClick={() => setActiveCalcTab(idx)} className={`flex items-center gap-2 px-3 py-2 rounded-lg whitespace-nowrap text-sm font-medium transition-colors ${activeCalcTab === idx ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`}>
                                    <s.icon size={16} /> <span>{s.short}</span>
                                </button>
                            ))}
                        </div>

                        <Card className="p-5 print:shadow-none print:border-none print:p-0">
                            {activeCalcTab !== 5 && (
                                <div className="flex flex-wrap items-center justify-between border-b pb-3 mb-4 gap-2 no-print">
                                    <h2 className="text-lg font-bold flex items-center gap-2 text-slate-800">
                                        {React.createElement(sections[activeCalcTab].icon, { className: "text-slate-400" })}
                                        {sections[activeCalcTab].title} 
                                        <span className="text-xs bg-slate-100 px-2 py-1 rounded text-slate-500 font-normal">–í–µ—Å: {sections[activeCalcTab].weight}</span>
                                    </h2>
                                    {activeCalcTab === 0 && (
                                        <div className="flex bg-slate-100 p-1 rounded">
                                            <IconCoins size={14} className="mx-2 text-slate-400 mt-1"/>
                                            {['rub', 'mln', 'bln', 'trln'].map((unit) => (
                                            <button key={unit} onClick={() => setMoneyUnit(unit)} className={`px-2 py-0.5 text-xs font-medium rounded transition-colors ${moneyUnit === unit ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                                {unit === 'rub' ? '–†—É–±' : unit === 'mln' ? '–ú–ª–Ω' : unit === 'bln' ? '–ú–ª—Ä–¥' : '–¢—Ä–ª–Ω'}
                                            </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeCalcTab === 0 && (
                                <>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="bg-slate-50 p-3 rounded border border-slate-100 print:bg-white print:border-slate-300">
                                            <h3 className="font-semibold text-slate-900 text-sm mb-3">5.1. –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—É–º–º–∞—Ä–Ω–æ–π –ö–° (–ò_—Å—É–º)</h3>
                                            <CalculatorInputGroup label={`–ö–°_–æ—Ç—á - –¢–µ–∫—É—â–∞—è (${moneyLabels[moneyUnit]})`} value={currentData.ks_otch} onChange={(v) => updateCalcData('ks_otch', v)} />
                                            <CalculatorInputGroup label={`–ö–°_—Ü–µ–ª - –¶–µ–ª–µ–≤–∞—è 2030 (${moneyLabels[moneyUnit]})`} value={currentData.ks_cel} onChange={(v) => updateCalcData('ks_cel', v)} />
                                        </div>
                                        <div className="bg-slate-50 p-3 rounded border border-slate-100 print:bg-white print:border-slate-300">
                                            <h3 className="font-semibold text-slate-900 text-sm mb-3">5.2 & 5.3 –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è</h3>
                                            <CalculatorInputGroup label="–ö_–æ–Ω.–æ–±—â - –í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ö–° (—à—Ç)" value={currentData.k_on_obsh} onChange={(v) => updateCalcData('k_on_obsh', v)} />
                                            <CalculatorInputGroup label={`–ö–°_–æ–±—â - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (${moneyLabels[moneyUnit]})`} value={currentData.ks_on_obsh} onChange={(v) => updateCalcData('ks_on_obsh', v)} />
                                        </div>
                                        <div className="bg-orange-50 p-3 rounded md:col-span-2 border border-orange-100 print:bg-white print:border-slate-300">
                                            <h3 className="text-sm font-bold text-orange-800 mb-3">–û–±—ä–µ–∫—Ç—ã —Å –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–π –ö–° (–¥–ª—è –ò_–∏–∑–º.–∫ –∏ –ò_–∏–∑–º.–∫—Å)</h3>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><CalculatorInputGroup label="–ö21 - –°—Ç. 21 (—à—Ç)" value={currentData.k_21} onChange={(v) => updateCalcData('k_21', v)} /><CalculatorInputGroup label={`–ö–°21 - –°—Ç. 21 (${moneyLabels[moneyUnit]})`} value={currentData.ks_21} onChange={(v) => updateCalcData('ks_21', v)} /></div>
                                                <div><CalculatorInputGroup label="–ö22 - –°—Ç. 22 –∏ 22.1 (—à—Ç)" value={currentData.k_22} onChange={(v) => updateCalcData('k_22', v)} /><CalculatorInputGroup label={`–ö–°22 - –°—Ç. 22 –∏ 22.1 (${moneyLabels[moneyUnit]})`} value={currentData.ks_22} onChange={(v) => updateCalcData('ks_22', v)} /></div>
                                                <div><CalculatorInputGroup label="–ö22.1 - –°—Ç. 22.1 (–¥–æ–ø., —à—Ç)" value={currentData.k_22_1} onChange={(v) => updateCalcData('k_22_1', v)} /><CalculatorInputGroup label={`–ö–°22.1 - –°—Ç. 22.1 (–¥–æ–ø., ${moneyLabels[moneyUnit]})`} value={currentData.ks_22_1} onChange={(v) => updateCalcData('ks_22_1', v)} /></div>
                                                <div><CalculatorInputGroup label="–ö—Å—É–¥ - –°—É–¥ (—à—Ç)" value={currentData.k_sud} onChange={(v) => updateCalcData('k_sud', v)} /><CalculatorInputGroup label={`–ö–°—Å—É–¥ - –°—É–¥ (${moneyLabels[moneyUnit]})`} value={currentData.ks_sud} onChange={(v) => updateCalcData('ks_sud', v)} /></div>
                                            </div>
                                        </div>
                                    </div>
                                    <ResultBreakdown total={results.ind1} items={[{ label: "5.1 –ò_—Å—É–º", desc: "–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏ 2030", value: results.sub1_1 }, { label: "5.2 –ò_–∏–∑–º.–∫", desc: "–°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª-–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π", value: results.sub1_2 }, { label: "5.3 –ò_–∏–∑–º.–∫—Å", desc: "–°–Ω–∏–∂–µ–Ω–∏–µ —Å—É–º–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π", value: results.sub1_3 }]} />
                                </>
                            )}
                            {activeCalcTab === 1 && (
                                <>
                                    <div className="space-y-4">
                                        <CalculatorInputGroup label="–ö_–æ–Ω.–æ–±—â - –í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ï–ì–†–ù" value={currentData.k_on_obsh_reestr} onChange={(v) => updateCalcData('k_on_obsh_reestr', v)} />
                                        <div className="bg-slate-50 p-3 rounded border border-slate-100 grid md:grid-cols-3 gap-2 print:bg-white print:border-slate-300">
                                            <CalculatorInputGroup label="–ö–±–µ–∑—Ä–ø - –ü—Ä–∞–≤–∞ –Ω–µ –∑–∞—Ä–µ–≥." value={currentData.k_bezrp} onChange={(v) => updateCalcData('k_bezrp', v)} />
                                            <CalculatorInputGroup label="–ö–º–∫–¥ - –ú–ö–î (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ)" value={currentData.k_mkd} onChange={(v) => updateCalcData('k_mkd', v)} />
                                            <CalculatorInputGroup label="–ö–≤—ã—è–≤–ª - –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ (–∏—Å–∫–ª)" value={currentData.k_vyyavl} onChange={(v) => updateCalcData('k_vyyavl', v)} />
                                        </div>
                                        <CalculatorInputGroup label="–ö_–Ω–∫–æ—Ä - –ë–µ–∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫" value={currentData.k_nkor} onChange={(v) => updateCalcData('k_nkor', v)} hint="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏" />
                                    </div>
                                    <ResultBreakdown total={results.ind2} items={[{ label: "6.1 –ò_–æ–Ω", desc: "–î–æ–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø—Ä–∞–≤–∞–º–∏", value: results.sub2_1 }, { label: "6.2 –ò_–∫–∞—á", desc: "–ö–∞—á–µ—Å—Ç–≤–æ —Å–≤–µ–¥–µ–Ω–∏–π –ï–ì–†–ù", value: results.sub2_2 }]} />
                                </>
                            )}
                            {activeCalcTab === 2 && (
                                <>
                                    <div className="space-y-4">
                                        <div className="bg-green-50 p-3 rounded border border-green-100 print:bg-white print:border-slate-300">
                                            <h3 className="font-semibold text-green-900 mb-2 text-sm">7.1. –î–æ–ª—è –≤—ã—è–≤–ª–µ–Ω–Ω–æ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–ò_–≤—ã—è–≤–ª)</h3>
                                            <CalculatorInputGroup label="S_–≤—ã—è–≤–ª - –ü–ª–æ—â–∞–¥—å –≤—ã—è–≤–ª–µ–Ω–Ω–∞—è (–≥–∞)" value={currentData.s_vyyavl} onChange={(v) => updateCalcData('s_vyyavl', v)} />
                                            <CalculatorInputGroup label="S_—Ç–µ—Ä - –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–≥–∞)" value={currentData.s_ter} onChange={(v) => updateCalcData('s_ter', v)} />
                                        </div>
                                        <div className="bg-green-50 p-3 rounded border border-green-100 print:bg-white print:border-slate-300">
                                            <h3 className="font-semibold text-green-900 mb-2 text-sm">7.2. –í–æ–≤–ª–µ—á–µ–Ω–∏–µ –≤ –æ–±–æ—Ä–æ—Ç (–ò_–æ–±–æ—Ä–æ—Ç)</h3>
                                            <CalculatorInputGroup label="S_–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª - –ü–ª–æ—â–∞–¥—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–∞—è/—Å–¥–µ–ª–∫–∏ (–≥–∞)" value={currentData.s_vuf} onChange={(v) => updateCalcData('s_vuf', v)} />
                                            <CalculatorInputGroup label="S_–≥–æ—Å–º—É–Ω - –í—Å–µ–≥–æ –≥–æ—Å. –∏ –º—É–Ω. –∑–µ–º–µ–ª—å (–≥–∞)" value={currentData.s_gosmun} onChange={(v) => updateCalcData('s_gosmun', v)} />
                                        </div>
                                    </div>
                                    <ResultBreakdown total={results.ind3} items={[{ label: "7.1 –ò_–≤—ã—è–≤–ª", desc: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—ã—è–≤–ª–µ–Ω–∏—è", value: results.sub3_1 }, { label: "7.2 –ò_–æ–±–æ—Ä–æ—Ç", desc: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–æ–≤–ª–µ—á–µ–Ω–∏—è", value: results.sub3_2 }]} />
                                </>
                            )}
                            {activeCalcTab === 3 && (
                                <>
                                    <div className="space-y-4">
                                        <div className="bg-purple-50 p-3 rounded border border-purple-100 print:bg-white print:border-slate-300">
                                            <h3 className="font-semibold text-purple-900 mb-2 text-sm">8.1. –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ò_–ø–¥)</h3>
                                            <CalculatorInputGroup label="–ö_–ø—Å - –ü–µ—Ä–µ–¥–∞–Ω–æ —Å–ª–æ–µ–≤" value={currentData.k_ps} onChange={(v) => updateCalcData('k_ps', v)} />
                                            <CalculatorInputGroup label="–ö_–ø–¥–ø—Ä - –ü–ª–∞–Ω –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É" value={currentData.k_pdpr} onChange={(v) => updateCalcData('k_pdpr', v)} />
                                        </div>
                                        <div className="bg-purple-50 p-3 rounded border border-purple-100 print:bg-white print:border-slate-300">
                                            <h3 className="font-semibold text-purple-900 mb-2 text-sm">8.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ù–°–ü–î –≤ —É—Å–ª—É–≥–∞—Ö (–ò_—É—Å–ª)</h3>
                                            <CalculatorInputGroup label="–ö_—Ä–µ–≥ - –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã —Å –ù–°–ü–î" value={currentData.k_reg} onChange={(v) => updateCalcData('k_reg', v)} />
                                            <CalculatorInputGroup label="–ö_–æ–±—â - –í—Å–µ–≥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–æ–≤" value={currentData.k_obsh_reg} onChange={(v) => updateCalcData('k_obsh_reg', v)} />
                                        </div>
                                    </div>
                                    <ResultBreakdown total={results.ind4} items={[{ label: "8.1 –ò_–ø–¥", desc: "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞", value: results.sub4_1 }, { label: "8.2 –ò_—É—Å–ª", desc: "–¶–∏—Ñ—Ä–æ–≤—ã–µ —É—Å–ª—É–≥–∏", value: results.sub4_2 }]} />
                                </>
                            )}
                            {activeCalcTab === 4 && (
                                <>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="bg-red-50 p-3 rounded border border-red-100 print:bg-white print:border-slate-300">
                                            <h3 className="text-red-900 font-bold text-sm mb-2">–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π (–ì–ó–ù)</h3>
                                            <CalculatorInputGroup label="–ö–≤–∫–Ω–º - –í—ã—è–≤–ª–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_vknm_gzn} onChange={(v) => updateCalcData('k_vknm_gzn', v)} />
                                            <CalculatorInputGroup label="–ö–ø–∫–Ω–º - –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫" value={currentData.k_pknm_gzn} onChange={(v) => updateCalcData('k_pknm_gzn', v)} />
                                            <CalculatorInputGroup label="–ö—É–∫–Ω–º - –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_uknm_gzn} onChange={(v) => updateCalcData('k_uknm_gzn', v)} />
                                        </div>
                                        <div className="bg-red-50 p-3 rounded border border-red-100 print:bg-white print:border-slate-300">
                                            <h3 className="text-red-900 font-bold text-sm mb-2">–ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π (–ú–ó–ö)</h3>
                                            <CalculatorInputGroup label="–ö–≤–∫–Ω–º - –í—ã—è–≤–ª–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_vknm_mzk} onChange={(v) => updateCalcData('k_vknm_mzk', v)} />
                                            <CalculatorInputGroup label="–ö–ø–∫–Ω–º - –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫" value={currentData.k_pknm_mzk} onChange={(v) => updateCalcData('k_pknm_mzk', v)} />
                                            <CalculatorInputGroup label="–ö—É–∫–Ω–º - –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_uknm_mzk} onChange={(v) => updateCalcData('k_uknm_mzk', v)} />
                                        </div>
                                    </div>
                                    <ResultBreakdown total={results.ind5} items={[{ label: "9.1 –ò_–≤–∫–Ω–º", desc: "–í—ã—è–≤–ª—è–µ–º–æ—Å—Ç—å (–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞–º)", value: results.sub5_1 }, { label: "9.2 –ò_—É–∫–Ω–º", desc: "–£—Å—Ç—Ä–∞–Ω—è–µ–º–æ—Å—Ç—å (–∫ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º)", value: results.sub5_2 }]} />
                                </>
                            )}

                            {activeCalcTab === 5 && (
                                <div className="space-y-6 text-slate-800 methodology-text">
                                    <div className="border-b pb-4">
                                        <h2 className="text-2xl font-bold">–ü—Ä–æ–µ–∫—Ç –º–µ—Ç–æ–¥–∏–∫–∏</h2>
                                        <p className="text-slate-500 mt-1">–û –ø–æ—Ä—è–¥–∫–µ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π</p>
                                    </div>

                                    <div className="space-y-4 text-sm leading-relaxed text-slate-700">
                                        <p>–ù–∞—Å—Ç–æ—è—â–∞—è –º–µ—Ç–æ–¥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–µ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ –ø–æ–≤—ã—à–µ–Ω–∏—é –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π (–¥–∞–ª–µ–µ ‚Äì –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å) –∑–∞ –æ—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (–∫–≤–∞—Ä—Ç–∞–ª, –≥–æ–¥) –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º, –Ω–∞—á–∏–Ω–∞—è —Å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –∑–∞ 2025 –≥–æ–¥.</p>
                                        
                                        <p>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –æ—Ç—Ä–∞–∂–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ –ø–æ–≤—ã—à–µ–Ω–∏—é –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π –≤—ã—Å—à–∏—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã—Ö –ª–∏—Ü —Å—É–±—ä–µ–∫—Ç–æ–≤ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤ —Å—É–±—ä–µ–∫—Ç–æ–≤ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.</p>
                                        
                                        <p>–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –æ—Ä–≥–∞–Ω–æ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–ª–∞—Å—Ç–∏, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞ —Ä–∞—Å—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è, —è–≤–ª—è–µ—Ç—Å—è –†–æ—Å—Ä–µ–µ—Å—Ç—Ä.</p>
                                        
                                        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 my-2">
                                            <p className="font-bold text-blue-900 mb-1">–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</p>
                                            <ul className="list-disc pl-4 space-y-1">
                                                <li><strong>–£—Ä–æ–≤–µ–Ω—å —Ä–∞—Å—á–µ—Ç–∞:</strong> –°—É–±—ä–µ–∫—Ç –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.</li>
                                                <li><strong>–¢–∏–ø –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è:</strong> –í–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π, –ø—Ä–µ–¥–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ 100%.</li>
                                                <li><strong>–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç (–∫–æ–¥ –û–ö–ï–ò ‚Äì 744).</li>
                                            </ul>
                                        </div>

                                        <h3 className="font-bold text-lg text-slate-900 mt-6">–ü–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–∞</h3>
                                        <p>–†–∞—Å—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –†–æ—Å—Ä–µ–µ—Å—Ç—Ä–æ–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º —Ä–∞—Å—á–µ—Ç–∞, –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–º –≤ –Ω–∞—Å—Ç–æ—è—â–µ–π –º–µ—Ç–æ–¥–∏–∫–µ, –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–º–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∞–º–∏ —Å—É–±—ä–µ–∫—Ç–∞ –†–§.</p>
                                        <p className="italic text-slate-500">–í —Å–ª—É—á–∞–µ –Ω–µ–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—à–ª–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.</p>

                                        <h3 className="font-bold text-lg text-slate-900 mt-6">–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ (–≠–∫–∞–ø)</h3>
                                        <div className="bg-white border rounded p-4 font-mono text-center">
                                            –≠–∫–∞–ø = (–ò1 √ó 0.25) + (–ò2 √ó 0.25) + (–ò3 √ó 0.25) + (–ò4 √ó 0.125) + (–ò5 √ó 0.125)
                                        </div>
                                        <p className="text-xs text-slate-500 mt-1">–ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É–¥–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.</p>

                                        <h3 className="font-bold text-lg text-slate-900 mt-6">–ü–µ—Ä–µ—á–µ–Ω—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –∏—Ö –≤–µ—Å</h3>
                                        <div className="overflow-hidden border rounded-lg">
                                            <table className="w-full text-left text-sm">
                                                <thead className="bg-slate-100">
                                                    <tr>
                                                        <th className="p-3 font-semibold">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                                                        <th className="p-3 font-semibold w-32">–£–¥–µ–ª—å–Ω—ã–π –≤–µ—Å</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    <tr><td className="p-3">1. –ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞</td><td className="p-3 font-bold text-blue-700">25%</td></tr>
                                                    <tr><td className="p-3">2. –ü–æ–ª–Ω—ã–π –∏ —Ç–æ—á–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</td><td className="p-3 font-bold text-blue-700">25%</td></tr>
                                                    <tr><td className="p-3">3. –í—ã—è–≤–ª–µ–Ω–∏–µ –∑–µ–º–µ–ª—å –¥–ª—è –≤–æ–≤–ª–µ—á–µ–Ω–∏—è –≤ –æ–±–æ—Ä–æ—Ç</td><td className="p-3 font-bold text-blue-700">25%</td></tr>
                                                    <tr><td className="p-3">4. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –§–ì–ò–° –ï–¶–ü –ù–°–ü–î</td><td className="p-3 font-bold text-blue-700">12,5%</td></tr>
                                                    <tr><td className="p-3">5. –û—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –∑–µ–º–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è (–Ω–∞–¥–∑–æ—Ä–∞)</td><td className="p-3 font-bold text-blue-700">12,5%</td></tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <h3 className="font-bold text-lg text-slate-900 mt-6">–†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ (–òi)</h3>
                                        <p>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –≤ –Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π. –ï—Å–ª–∏ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—é –Ω–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è, –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–≤–Ω—ã–º –Ω—É–ª—é.</p>
                                        
                                        <div className="mt-6 space-y-6">
                                            <div>
                                                <h4 className="text-blue-900 font-bold mb-2">1. –ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞</h4>
                                                <div className="mt-2 space-y-3">
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">5.1. –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—É–º–º–∞—Ä–Ω–æ–π –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–ò_—Å—É–º)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(–ö–°_–æ—Ç—á / –ö–°_—Ü–µ–ª) √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>–ö–°_–æ—Ç—á</b> ‚Äì —Å—É–º–º–∞—Ä–Ω–∞—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–≥–∏–æ–Ω–∞ –Ω–∞ –æ—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥; <b>–ö–°_—Ü–µ–ª</b> ‚Äì —Ü–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—É–º–º–∞—Ä–Ω–æ–π –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–µ–≥–∏–æ–Ω–∞ –Ω–∞ 2030 –≥–æ–¥.</span><br/>
                                                            <span className="source">–ò—Å—Ç–æ—á–Ω–∏–∫: –†–æ—Å—Ä–µ–µ—Å—Ç—Ä, —Ñ–æ—Ä–º–∞ –ö–°-1.</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">5.2. –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–π –ö–° (–ò_–∏–∑–º.–∫)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(1 - ((–ö21 + –ö22 + –ö—Å—É–¥) / –ö_–æ–Ω.–æ–±—â)) √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>–ö21, –ö22, –ö—Å—É–¥</b> ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ—Ç–æ—Ä—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∞ –ø–æ —Å—Ç. 21, 22, 22.1 –§–ó ‚Ññ 237 –∏–ª–∏ —Å—É–¥—É; <b>–ö_–æ–Ω.–æ–±—â</b> ‚Äì –æ–±—â–µ–µ –∫–æ–ª-–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ö–°.</span><br/>
                                                            <span className="source">–ò—Å—Ç–æ—á–Ω–∏–∫: –†–æ—Å—Ä–µ–µ—Å—Ç—Ä.</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">5.3. –°–Ω–∏–∂–µ–Ω–∏–µ —Å—É–º–º–∞—Ä–Ω–æ–π –ö–° –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–ò_–∏–∑–º.–∫—Å)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(1 - ((–ö–°21 + –ö–°22 + –ö–°—Å—É–¥) / –ö–°_–æ–±—â)) √ó 100%</code><br/>
                                                            <span className="source">–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø. 5.2, –Ω–æ —Å—á–∏—Ç–∞—é—Ç—Å—è —Å—É–º–º—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 className="text-blue-900 font-bold mb-2">2. –†–µ–µ—Å—Ç—Ä –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h4>
                                                <div className="mt-2 space-y-3">
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">6.1. –î–æ–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (–ò_–æ–Ω)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(1 ‚àí (–ö–±–µ–∑—Ä–ø ‚àí –ö–º–∫–¥ ‚àí –ö–≤—ã—è–≤–ª) / –ö_–æ–Ω.–æ–±—â) √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>–ö–±–µ–∑—Ä–ø</b> ‚Äì –æ–±—ä–µ–∫—Ç—ã –±–µ–∑ –ø—Ä–∞–≤; <b>–ö–º–∫–¥</b> ‚Äì –º–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –¥–æ–º–∞ (–∏—Å–∫–ª—é—á–∞—é—Ç—Å—è); <b>–ö–≤—ã—è–≤–ª</b> ‚Äì –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª–∏ (–∏—Å–∫–ª—é—á–∞—é—Ç—Å—è); <b>–ö_–æ–Ω.–æ–±—â</b> ‚Äì –≤—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤.</span><br/>
                                                            <span className="source">–ò—Å—Ç–æ—á–Ω–∏–∫: –ï–ì–†–ù.</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">6.2. –ö–∞—á–µ—Å—Ç–≤–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (–ò_–∫–∞—á)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(1 ‚àí (–ö_–Ω–∫–æ—Ä / –ö_–æ–±—â)) √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>–ö_–Ω–∫–æ—Ä</b> ‚Äì –æ–±—ä–µ–∫—Ç—ã —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ (–ø–ª–æ—â–∞–¥—å, –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏ —Ç.–¥.).</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 className="text-blue-900 font-bold mb-2">3. –í–æ–≤–ª–µ—á–µ–Ω–∏–µ –∑–µ–º–µ–ª—å</h4>
                                                <div className="mt-2 space-y-3">
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">7.1. –î–æ–ª—è –≤—ã—è–≤–ª–µ–Ω–Ω–æ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–ò_–≤—ã—è–≤–ª)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>S_–≤—ã—è–≤–ª / S_—Ç–µ—Ä √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>S_–≤—ã—è–≤–ª</b> ‚Äì –ø–ª–æ—â–∞–¥—å –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤; <b>S_—Ç–µ—Ä</b> ‚Äì –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏.</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">7.2. –í–æ–≤–ª–µ—á–µ–Ω–∏–µ –≤ –æ–±–æ—Ä–æ—Ç (–ò_–æ–±–æ—Ä–æ—Ç)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>S_–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª / S_–≥–æ—Å–º—É–Ω √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>S_–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª</b> ‚Äì –ø–ª–æ—â–∞–¥—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–µ–º–µ–ª—å –ø–æ —Å–¥–µ–ª–∫–∞–º; <b>S_–≥–æ—Å–º—É–Ω</b> ‚Äì –≤—Å–µ–≥–æ –≥–æ—Å/–º—É–Ω –∑–µ–º–µ–ª—å.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 className="text-blue-900 font-bold mb-2">4. –§–ì–ò–° –ï–¶–ü –ù–°–ü–î</h4>
                                                <div className="mt-2 space-y-3">
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">8.1. –ü–µ—Ä–µ–¥–∞—á–∞ —Å–ª–æ–µ–≤ (–ò_–ø–¥)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>–ö_–ø—Å / –ö_–ø–¥–ø—Ä √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>–ö_–ø—Å</b> ‚Äì –ø–µ—Ä–µ–¥–∞–Ω–æ —Å–ª–æ–µ–≤; <b>–ö_–ø–¥–ø—Ä</b> ‚Äì –ø–ª–∞–Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É.</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">8.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —É—Å–ª—É–≥–∞—Ö (–ò_—É—Å–ª)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>–ö_—Ä–µ–≥ / –ö_–æ–±—â √ó 100%</code><br/>
                                                            <span className="source">–≥–¥–µ: <b>–ö_—Ä–µ–≥</b> ‚Äì —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã —É—Å–ª—É–≥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –§–ì–ò–°; <b>–ö_–æ–±—â</b> ‚Äì –≤—Å–µ–≥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–æ–≤ –ø–æ –ø–µ—Ä–µ—á–Ω—é (–ø. 75, 76, 79, 82, 120).</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 className="text-blue-900 font-bold mb-2">5. –ó–µ–º–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å</h4>
                                                <div className="mt-2 space-y-3">
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">9.1. –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π (–ò_–≤–∫–Ω–º)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(–ö–≤–∫–Ω–º–ì–ó–ù + –ö–≤–∫–Ω–º–ú–ó–ö) / (–ö–ø–∫–Ω–º–ì–ó–ù + –ö–ø–∫–Ω–º–ú–ó–ö) √ó 100%</code><br/>
                                                            <span className="source">–û—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (–ì–ó–ù + –ú–ó–ö).</span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold text-xs uppercase tracking-wide text-slate-500">9.2. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π (–ò_—É–∫–Ω–º)</div>
                                                        <div className="definition">
                                                            –§–æ—Ä–º—É–ª–∞: <code>(–ö—É–∫–Ω–º–ì–ó–ù + –ö—É–∫–Ω–º–ú–ó–ö) / (–ö–≤–∫–Ω–º–ì–ó–ù + –ö–≤–∫–Ω–º–ú–ó–ö) √ó 100%</code><br/>
                                                            <span className="source">–û—Ç–Ω–æ—à–µ–Ω–∏–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –∫ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º.</span><br/>
                                                            <span className="source">*–ù–∞—Ä—É—à–µ–Ω–∏—è: —Å–∞–º–æ–≤–æ–ª—å–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ, –Ω–µ—Ü–µ–ª–µ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </Card>
                    </div>
                    <div className="xl:col-span-1">
                        <Card className="p-4 bg-white border-2 border-slate-200 shadow-xl sticky top-4 text-slate-800 print:shadow-none print:border print:border-slate-300">
                            <h2 className="text-xs uppercase text-slate-500 font-bold mb-1 print:text-slate-600">–ò—Ç–æ–≥–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                            <div className="text-5xl font-bold mb-2 text-slate-900">{results.total.toFixed(2)}%</div>
                            <div className="w-full bg-slate-200 h-2 rounded-full overflow-hidden mb-6 print:border print:border-slate-300">
                                <div className="bg-blue-600 h-full transition-all print:bg-black" style={{ width: `${Math.min(results.total, 100)}%` }}></div>
                            </div>
                            
                            <div className="text-xs font-bold uppercase tracking-wider text-slate-400 mb-3 border-b border-slate-200 pb-1">–ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
                            
                            <div className="space-y-3">
                                {finalResultsArray.map((item, idx) => (
                                    <div key={idx} className="flex items-center gap-2 p-2 rounded-lg bg-slate-50 border border-slate-100 print:bg-white print:border-slate-200 hover:bg-slate-100 transition-colors">
                                        {/* –ò–∫–æ–Ω–∫–∞ */}
                                        <div className={`p-2 rounded-lg ${item.section.bg} ${item.section.color} print:bg-white`}>
                                            {React.createElement(item.section.icon, { size: 20 })}
                                        </div>
                                        
                                        {/* –¢–µ–∫—Å—Ç */}
                                        <div className="flex-1 min-w-0">
                                            <div className="text-xs font-bold text-slate-700 truncate print:text-slate-600">
                                                {item.section.title}
                                            </div>
                                            <div className="flex justify-between items-center mt-1">
                                                <span className="font-mono text-slate-400 text-[10px]">{item.val.toFixed(1)}%</span>
                                                <div className="text-right leading-tight">
                                                    <div className="text-[14px] font-bold text-slate-900">{(item.val * item.section.numWeight).toFixed(2)}%</div>
                                                    <div className="text-[9px] text-slate-400">–í–∫–ª–∞–¥ –≤ –∏—Ç–æ–≥ (–≤–µ—Å {item.section.numWeight})</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="mt-6 pt-4 border-t border-slate-200 text-xs text-slate-400 print:text-black print:border-slate-300">
                                –ü–µ—Ä–∏–æ–¥: {periodsList.find(p=>p.id===period)?.label}
                            </div>
                        </Card>
                    </div>
                </div>
            </div>
        );
    }

function initCalculator() {
    const calculatorRoot = document.getElementById('calculatorRoot');
    if (calculatorRoot) {
        const root = ReactDOM.createRoot(calculatorRoot);
        root.render(<EfficiencyCalculator />);
    }
}
</script>
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        window.GITHUB_RAW_URL = 'https://raw.githubusercontent.com/mark98molchanov-a11y/mark98molchanov-a12y.gko-registry-system/main/';
        
        const STORAGE_KEY_NPA = 'rosreestr_npa_viz_v5';
        const STORAGE_KEY_DASHBOARDS = 'gko_dashboards_v2';
        const STORAGE_KEY_CALCULATOR = 'gko_calculator_data_v1';
        const STORAGE_KEY_DIO = 'gko_dio_tree_v1';
        const STORAGE_KEY_ALL = 'gko_all_data.json';
        
        const GITHUB_SYNC_ENABLED = true;
        const GITHUB_SYNC_API = window.GITHUB_RAW_URL;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let appData = [];
        let dashboardsData = [];
        let currentTab = 'npas';
        let currentGitHubToken = null;
        
        // –ù–ü–ê –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentDocFilter = null;
        let currentTypeFilter = null;
        let currentTargetFilter = null;
        let selectedIds = new Set();
        let chartInstance = null;
        
        // –î–∞—à–±–æ—Ä–¥—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentStatusFilterDashboards = null;
        let currentTypeFilterDashboards = null;
        let currentTagFilterDashboards = null;
        let selectedIdsDashboards = new Set();
        let chartInstanceDashboards = null;
        
        // –î–ò–û –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let dioTrees = [];
        let selectedDIONodeId = null;
        
        // ==================== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ====================
        
        // –§—É–Ω–∫—Ü–∏–∏ GitHub
        async function loadFromGitHub() {
            if (!GITHUB_SYNC_ENABLED) {
                loadData();
                loadDashboardsData();
                loadDIOTrees();
                return;
            }
            
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub...');
                const response = await fetch(`${GITHUB_SYNC_API}gko_all_data.json`);
                
                if (!response.ok) {
                    throw new Error(`–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (${response.status})`);
                }
                
                const json = await response.json();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –ù–ü–ê
                if (json.npas && Array.isArray(json.npas)) {
                    appData = [...json.npas];
                    localStorage.setItem(STORAGE_KEY_NPA, JSON.stringify(appData));
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${json.npas.length} –∑–∞–ø–∏—Å–µ–π –ù–ü–ê`);
                    renderGrid();
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤
                if (json.dashboards && Array.isArray(json.dashboards)) {
                    dashboardsData = [...json.dashboards];
                    localStorage.setItem(STORAGE_KEY_DASHBOARDS, JSON.stringify(dashboardsData));
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${json.dashboards.length} –¥–∞—à–±–æ—Ä–¥–æ–≤`);
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
                if (json.calculator) {
                    localStorage.setItem(STORAGE_KEY_CALCULATOR, JSON.stringify(json.calculator));
                    console.log('–î–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub');
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –î–ò–û –¥–µ—Ä–µ–≤—å–µ–≤
                if (json.dioTrees) {
                    dioTrees = json.dioTrees;
                    localStorage.setItem(STORAGE_KEY_DIO, JSON.stringify(dioTrees));
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${dioTrees.length} –¥–µ—Ä–µ–≤—å–µ–≤ –î–ò–û`);
                    renderDIOTree();
                }
                
                showNotification('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub', 'success');
                
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub:', error.message);
                loadData();
                loadDashboardsData();
                loadDIOTrees();
            }
        }
        
        function showGitHubTokenModal() {
            document.getElementById('githubTokenInput').value = '';
            document.getElementById('githubTokenModal').classList.remove('hidden');
            document.getElementById('githubTokenInput').focus();
        }
        
        function closeGitHubModal() {
            document.getElementById('githubTokenModal').classList.add('hidden');
            document.getElementById('githubTokenInput').value = '';
            currentGitHubToken = null;
        }
        
        async function saveToGitHub() {
            const token = document.getElementById('githubTokenInput').value.trim();
            
            if (!token) {
                alert('–í–≤–µ–¥–∏—Ç–µ GitHub Token');
                return;
            }
            
            currentGitHubToken = token;
            
            const allData = {
                version: "1.0",
                exportDate: new Date().toISOString(),
                npas: appData,
                dashboards: dashboardsData,
                calculator: JSON.parse(localStorage.getItem(STORAGE_KEY_CALCULATOR) || '{}'),
                dioTrees: dioTrees,
                metadata: {
                    npaCount: appData.length,
                    dashboardsCount: dashboardsData.length,
                    dioTreesCount: dioTrees.length,
                    exportFormat: "combined"
                }
            };
            
            const content = JSON.stringify(allData, null, 2);
            const owner = 'mark98molchanov-a11y';
            const repo = 'mark98molchanov-a12y.gko-registry-system';
            const path = 'gko_all_data.json';
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
            
            try {
                let sha = null;
                try {
                    const res = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        sha = data.sha;
                    }
                } catch (e) { /* –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç */ }
                
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: ${new Date().toLocaleString('ru-RU')}`,
                        content: btoa(unescape(encodeURIComponent(content))),
                        sha: sha
                    })
                });
                
                if (response.ok) {
                    closeGitHubModal();
                    showNotification('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ GitHub', 'success');
                } else {
                    const error = await response.json();
                    alert(`–û—à–∏–±–∫–∞: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
                
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        function exportJson() {
            const calculatorData = JSON.parse(localStorage.getItem(STORAGE_KEY_CALCULATOR) || '{}');
            
            const allData = {
                version: "1.0",
                exportDate: new Date().toISOString(),
                npas: appData,
                dashboards: dashboardsData,
                calculator: calculatorData,
                dioTrees: dioTrees,
                metadata: {
                    npaCount: appData.length,
                    dashboardsCount: dashboardsData.length,
                    dioTreesCount: dioTrees.length,
                    exportFormat: "combined"
                }
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allData, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = `gko_all_data.json`;
            a.click();
        }
        
        function importJson() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const json = JSON.parse(e.target.result);
                        
                        let confirmMessage = "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞?\n\n";
                        let hasNPA = false;
                        let hasDashboards = false;
                        let hasCalculator = false;
                        let hasDIO = false;
                        
                        if (json.npas && Array.isArray(json.npas)) {
                            confirmMessage += `–ù–ü–ê: ${json.npas.length} –∑–∞–ø–∏—Å–µ–π\n`;
                            hasNPA = true;
                        }
                        
                        if (json.dashboards && Array.isArray(json.dashboards)) {
                            confirmMessage += `–î–∞—à–±–æ—Ä–¥—ã: ${json.dashboards.length} –∑–∞–ø–∏—Å–µ–π\n`;
                            hasDashboards = true;
                        }
                        
                        if (json.calculator) {
                            confirmMessage += `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫\n`;
                            hasCalculator = true;
                        }
                        
                        if (json.dioTrees && Array.isArray(json.dioTrees)) {
                            confirmMessage += `–î–ò–û: ${json.dioTrees.length} –¥–µ—Ä–µ–≤—å–µ–≤\n`;
                            hasDIO = true;
                        }
                        
                        if (confirm(confirmMessage)) {
                            if (hasNPA) {
                                const npaData = json.npas || json;
                                appData = [...npaData];
                                saveData();
                            }
                            
                            if (hasDashboards) {
                                const dashData = json.dashboards || json;
                                dashboardsData = [...dashData];
                                saveDashboardsData();
                            }
                            
                            if (hasCalculator && json.calculator) {
                                localStorage.setItem(STORAGE_KEY_CALCULATOR, JSON.stringify(json.calculator));
                            }
                            
                            if (hasDIO && json.dioTrees) {
                                dioTrees = json.dioTrees;
                                saveDIOTrees();
                                if (currentTab === 'dio') {
                                    renderDIOTree();
                                }
                            }
                            
                            showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                        }
                    } catch(e) {
                        alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: " + e.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 ${
                type === 'success' ? 'bg-emerald-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-amber-500 text-white' :
                'bg-brand-600 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-white/80">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================
        
        let areSubsectionsCollapsed = false;
        let isCapitalizationExpanded = false;
        
        function toggleAllSections() {
            const container = document.getElementById('subsectionsContainer');
            const icon = document.getElementById('collapseIcon');
            
            if (areSubsectionsCollapsed) {
                container.style.display = 'block';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '‚ñº';
                areSubsectionsCollapsed = false;
                
                if (isCapitalizationExpanded) {
                    const capContainer = document.getElementById('capitalizationSubsections');
                    const capIcon = document.getElementById('capitalizationIcon');
                    if (capContainer && capIcon) {
                        capContainer.style.display = 'block';
                        capIcon.style.transform = 'rotate(180deg)';
                        capIcon.textContent = '‚ñ≤';
                    }
                }
            } else {
                container.style.display = 'none';
                icon.style.transform = 'rotate(-90deg)';
                icon.textContent = '‚ñ∂';
                areSubsectionsCollapsed = true;
            }
        }
        
        function toggleCapitalization() {
            const container = document.getElementById('capitalizationSubsections');
            const icon = document.getElementById('capitalizationIcon');
            
            if (isCapitalizationExpanded) {
                container.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '‚ñº';
                isCapitalizationExpanded = false;
            } else {
                container.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = '‚ñ≤';
                isCapitalizationExpanded = true;
            }
        }
        
        function switchTab(tabName) {
            // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.book-subsection, .book-subsubsection').forEach(el => {
                el.classList.remove('active');
            });
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
            const sectionTitle = document.getElementById('sectionTitle');
            const sectionSubtitle = document.getElementById('sectionSubtitle');
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
            currentTab = tabName;
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const navIdMap = {
                'npas': 'navNPA',
                'dashboards': 'navDashboards',
                'dio': 'navDIO',
                'calculator': 'navCalculator'
            };
            
            const navId = navIdMap[tabName];
            if (navId) {
                const activeNavItem = document.getElementById(navId);
                if (activeNavItem) {
                    activeNavItem.classList.add('active');
                }
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏
            document.getElementById('npaImportButtons').classList.add('hidden');
            document.getElementById('dashboardsImportButtons').classList.add('hidden');
            document.getElementById('dioImportButtons').classList.add('hidden');
            
            document.getElementById('bulkToolbar').classList.add('hidden');
            document.getElementById('bulkToolbarDashboards').classList.add('hidden');
            
            switch(tabName) {
                case 'npas':
                    sectionTitle.textContent = '–†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê';
                    sectionSubtitle.textContent = '–ë–∞–∑–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã—Ö –∞–∫—Ç–æ–≤';
                    document.getElementById('npaImportButtons').classList.remove('hidden');
                    document.getElementById('addButtonText').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
                    document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –ù–ü–ê';
                    
                    if (selectedIds.size > 0) {
                        document.getElementById('bulkToolbar').classList.remove('hidden');
                    }
                    
                    renderGrid();
                    break;
                    
                case 'dashboards':
                    sectionTitle.textContent = '–î–∞—à–±–æ—Ä–¥—ã Superset';
                    sectionSubtitle.textContent = '–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Apache Superset';
                    document.getElementById('dashboardsImportButtons').classList.remove('hidden');
                    document.getElementById('addButtonText').textContent = '–ù–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥';
                    document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –¥–∞—à–±–æ—Ä–¥–æ–≤';
                    
                    if (selectedIdsDashboards.size > 0) {
                        document.getElementById('bulkToolbarDashboards').classList.remove('hidden');
                    }
                    
                    initializeDashboardsTab();
                    break;
                    
                case 'dio':
                    sectionTitle.textContent = '–ë–∞–∑–∞ –î–ò–û';
                    sectionSubtitle.textContent = '–î–µ—Ä–µ–≤–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã';
                    document.getElementById('dioImportButtons').classList.remove('hidden');
                    document.getElementById('addButtonText').textContent = '–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª';
                    document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –î–ò–û';
                    
                    renderDIOTree();
                    break;
                    
                case 'calculator':
                    sectionTitle.textContent = '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏';
                    sectionSubtitle.textContent = '–†–∞—Å—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏';
                    document.getElementById('addButtonText').textContent = '–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç';
                    document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞';
                    
                    initCalculator();
                    break;
            }
        }
        
        function hardResetCurrent() {
            if (currentTab === 'npas') {
                if (confirm("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ù–ü–ê? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) {
                    localStorage.removeItem(STORAGE_KEY_NPA);
                    loadData();
                }
            } else if (currentTab === 'dashboards') {
                if (confirm("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–æ–≤? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞—à–±–æ—Ä–¥—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) {
                    localStorage.removeItem(STORAGE_KEY_DASHBOARDS);
                    loadDashboardsData();
                }
            } else if (currentTab === 'calculator') {
                if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞?")) {
                    localStorage.removeItem(STORAGE_KEY_CALCULATOR);
                    initCalculator();
                    showNotification('–î–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –æ—á–∏—â–µ–Ω—ã', 'success');
                }
            } else if (currentTab === 'dio') {
                if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–µ—Ä–µ–≤—å—è –î–ò–û?")) {
                    localStorage.removeItem(STORAGE_KEY_DIO);
                    dioTrees = [];
                    renderDIOTree();
                    showNotification('–î–µ—Ä–µ–≤—å—è –î–ò–û –æ—á–∏—â–µ–Ω—ã', 'success');
                }
            }
        }
        
        function openModal() {
            if (currentTab === 'npas') {
                openModalNPA();
            } else if (currentTab === 'dashboards') {
                openModalDashboards();
            } else if (currentTab === 'dio') {
                addDIORootNode();
            } else if (currentTab === 'calculator') {
                // –î–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫
                alert('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏');
            }
        }
        
        // ==================== –§–£–ù–ö–¶–ò–ò –ù–ü–ê (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ====================
        
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY_NPA);
            if (saved) {
                try {
                    appData = JSON.parse(saved);
                } catch (e) { 
                    appData = [];
                }
            } else {
                appData = [];
            }
            renderGrid();
        }
        
        function saveData() {
            localStorage.setItem(STORAGE_KEY_NPA, JSON.stringify(appData));
            renderGrid();
        }
        
        function setDocFilter(val) { 
            currentDocFilter = currentDocFilter === val ? null : val; 
            renderGrid(); 
        }
        
        function setTypeFilter(val) { 
            currentTypeFilter = currentTypeFilter === val ? null : val; 
            renderGrid(); 
        }
        
        function setTargetFilter(val) { 
            currentTargetFilter = currentTargetFilter === val ? null : val; 
            renderGrid(); 
        }
        
        function resetAllFilters() { 
            currentDocFilter = null; 
            currentTypeFilter = null; 
            currentTargetFilter = null; 
            document.getElementById('searchInput').value=''; 
            renderGrid(); 
        }
        
        function renderGrid() {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sortMode = document.getElementById('sortSelect').value;
            
            let filtered = appData.filter(item => {
                const matchesDoc = !currentDocFilter || item.doc === currentDocFilter;
                const matchesType = !currentTypeFilter || item.type === currentTypeFilter;
                const matchesTarget = !currentTargetFilter || (item.target && item.target.includes(currentTargetFilter));
                const matchesSearch = 
                    (item.human && item.human.toLowerCase().includes(search)) || 
                    (item.norm && item.norm.toLowerCase().includes(search)) || 
                    (item.doc && item.doc.toLowerCase().includes(search));
                return matchesDoc && matchesType && matchesTarget && matchesSearch;
            });
            
            // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ renderGrid() ...
        }
        
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ù–ü–ê ...
        
        // ==================== –§–£–ù–ö–¶–ò–ò –î–ê–®–ë–û–†–î–û–í (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ====================
        
        function loadDashboardsData() {
            const saved = localStorage.getItem(STORAGE_KEY_DASHBOARDS);
            if (saved) {
                try {
                    dashboardsData = JSON.parse(saved);
                } catch (e) { 
                    dashboardsData = [];
                }
            } else {
                dashboardsData = [];
            }
            updateDashboardStatsDashboards();
            renderStatusFiltersDashboards();
            renderTypeFiltersDashboards();
            renderTagsDashboards();
            
            if (currentTab === 'dashboards') {
                renderDashboardsGrid();
            } else {
                updateChartDashboards(dashboardsData);
            }
        }
        
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–æ–≤ ...
        
        // ==================== –§–£–ù–ö–¶–ò–ò –î–ò–û ====================
        
        function loadDIOTrees() {
            const saved = localStorage.getItem(STORAGE_KEY_DIO);
            if (saved) {
                try {
                    dioTrees = JSON.parse(saved);
                } catch (e) { 
                    dioTrees = [];
                }
            } else {
                dioTrees = [];
            }
        }
        
        function saveDIOTrees() {
            localStorage.setItem(STORAGE_KEY_DIO, JSON.stringify(dioTrees));
        }
        
        function renderDIOTree() {
            const container = document.getElementById('dioTree');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (dioTrees.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-slate-400">
                        <svg class="w-24 h-24 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="text-lg font-medium mb-2">–î–µ—Ä–µ–≤–æ –î–ò–û –ø—É—Å—Ç–æ–µ</p>
                        <p class="text-sm">–ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞</p>
                        <button onclick="addDIORootNode()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            –°–æ–∑–¥–∞—Ç—å –¥–µ—Ä–µ–≤–æ
                        </button>
                    </div>
                `;
                return;
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –¥–µ—Ä–µ–≤–∞
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("class", "dio-svg");
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø –¥–ª—è —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π
            const linksGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
            linksGroup.setAttribute("class", "tree-links");
            
            const nodesGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
            nodesGroup.setAttribute("class", "tree-nodes");
            
            svg.appendChild(linksGroup);
            svg.appendChild(nodesGroup);
            container.appendChild(svg);
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–µ—Ä–≤–æ–≥–æ –¥–µ—Ä–µ–≤–∞
            renderTree(dioTrees[0], linksGroup, nodesGroup, 0, 0);
        }
        
        function renderTree(tree, linksGroup, nodesGroup, startX, startY) {
            if (!tree || !tree.nodes || tree.nodes.length === 0) return;
            
            const nodeWidth = 180;
            const nodeHeight = 80;
            const horizontalSpacing = 250;
            const verticalSpacing = 150;
            
            // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è —É–∑–ª–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π layout)
            const positions = {};
            const levelWidths = {};
            const nodeLevels = {};
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞
            function assignLevels(nodeId, level) {
                nodeLevels[nodeId] = level;
                levelWidths[level] = (levelWidths[level] || 0) + 1;
                
                const node = tree.nodes.find(n => n.id === nodeId);
                if (node && node.children) {
                    node.children.forEach(childId => assignLevels(childId, level + 1));
                }
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –∫–æ—Ä–Ω–µ–≤—ã–µ —É–∑–ª—ã
            const rootNodes = tree.nodes.filter(n => !n.parentId);
            rootNodes.forEach(root => assignLevels(root.id, 0));
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏
            Object.keys(levelWidths).forEach(level => {
                const levelNodes = tree.nodes.filter(n => nodeLevels[n.id] === parseInt(level));
                const totalWidth = levelNodes.length * nodeWidth + (levelNodes.length - 1) * horizontalSpacing;
                const startXPos = (1000 - totalWidth) / 2; // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
                
                levelNodes.forEach((node, index) => {
                    const x = startXPos + index * (nodeWidth + horizontalSpacing);
                    const y = 100 + parseInt(level) * (nodeHeight + verticalSpacing);
                    positions[node.id] = { x, y, node };
                });
            });
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–≤—è–∑–µ–π
            tree.nodes.forEach(node => {
                if (node.children && node.children.length > 0) {
                    const parentPos = positions[node.id];
                    if (!parentPos) return;
                    
                    node.children.forEach(childId => {
                        const childPos = positions[childId];
                        if (!childPos) return;
                        
                        // –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ —Å–≤—è–∑–∏
                        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                        line.setAttribute("x1", parentPos.x + nodeWidth / 2);
                        line.setAttribute("y1", parentPos.y + nodeHeight);
                        line.setAttribute("x2", childPos.x + nodeWidth / 2);
                        line.setAttribute("y2", childPos.y);
                        line.setAttribute("class", "tree-path");
                        
                        linksGroup.appendChild(line);
                    });
                }
            });
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É–∑–ª–æ–≤
            Object.values(positions).forEach(pos => {
                const nodeElement = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                nodeElement.setAttribute("x", pos.x);
                nodeElement.setAttribute("y", pos.y);
                nodeElement.setAttribute("width", nodeWidth);
                nodeElement.setAttribute("height", nodeHeight);
                nodeElement.setAttribute("rx", "8");
                nodeElement.setAttribute("ry", "8");
                nodeElement.setAttribute("class", `node ${selectedDIONodeId === pos.node.id ? 'node-selected' : ''}`);
                nodeElement.setAttribute("data-node-id", pos.node.id);
                
                // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —É–∑–ª–∞
                let fillColor = '#3b82f6'; // –°–∏–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                switch(pos.node.type) {
                    case 'department': fillColor = '#3b82f6'; break;
                    case 'position': fillColor = '#10b981'; break;
                    case 'function': fillColor = '#8b5cf6'; break;
                    case 'document': fillColor = '#f59e0b'; break;
                }
                
                nodeElement.setAttribute("fill", fillColor);
                nodeElement.setAttribute("stroke", '#1e40af');
                nodeElement.setAttribute("stroke-width", "2");
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–ª–∏–∫–∞
                nodeElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectDIONode(pos.node.id);
                });
                
                nodesGroup.appendChild(nodeElement);
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", pos.x + nodeWidth / 2);
                text.setAttribute("y", pos.y + nodeHeight / 2);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("class", "tree-text");
                text.setAttribute("fill", "white");
                text.setAttribute("font-weight", "bold");
                text.setAttribute("font-size", "14");
                
                // –û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                let displayText = pos.node.name;
                if (displayText.length > 20) {
                    displayText = displayText.substring(0, 17) + '...';
                }
                
                text.textContent = displayText;
                nodesGroup.appendChild(text);
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (—Ç–∏–ø)
                const typeText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                typeText.setAttribute("x", pos.x + nodeWidth / 2);
                typeText.setAttribute("y", pos.y + nodeHeight - 10);
                typeText.setAttribute("text-anchor", "middle");
                typeText.setAttribute("class", "tree-text");
                typeText.setAttribute("fill", "rgba(255,255,255,0.8)");
                typeText.setAttribute("font-size", "10");
                
                let typeDisplay = '';
                switch(pos.node.type) {
                    case 'department': typeDisplay = '–û—Ç–¥–µ–ª'; break;
                    case 'position': typeDisplay = '–î–æ–ª–∂–Ω–æ—Å—Ç—å'; break;
                    case 'function': typeDisplay = '–§—É–Ω–∫—Ü–∏—è'; break;
                    case 'document': typeDisplay = '–î–æ–∫—É–º–µ–Ω—Ç'; break;
                }
                
                typeText.textContent = typeDisplay;
                nodesGroup.appendChild(typeText);
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ viewBox –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            const allX = Object.values(positions).map(p => p.x);
            const allY = Object.values(positions).map(p => p.y);
            const minX = Math.min(...allX) - 100;
            const maxX = Math.max(...allX) + nodeWidth + 100;
            const minY = Math.min(...allY) - 100;
            const maxY = Math.max(...allY) + nodeHeight + 100;
            
            svg.setAttribute("viewBox", `${minX} ${minY} ${maxX - minX} ${maxY - minY}`);
        }
        
        function selectDIONode(nodeId) {
            selectedDIONodeId = nodeId;
            renderDIOTree();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É–∑–ª–µ
            const node = findDIONode(nodeId);
            if (node) {
                const nodeInfo = document.getElementById('dioNodeInfo');
                const nodeDetails = document.getElementById('nodeDetails');
                
                nodeDetails.innerHTML = `
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <strong class="text-slate-500">–ù–∞–∑–≤–∞–Ω–∏–µ:</strong>
                            <p class="font-medium">${node.name}</p>
                        </div>
                        <div>
                            <strong class="text-slate-500">–¢–∏–ø:</strong>
                            <p class="font-medium">${getDIONodeTypeText(node.type)}</p>
                        </div>
                        <div>
                            <strong class="text-slate-500">–°—Ç–∞—Ç—É—Å:</strong>
                            <span class="px-2 py-1 rounded text-xs font-medium ${
                                node.status === 'active' ? 'bg-green-100 text-green-800' :
                                node.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-gray-100 text-gray-800'
                            }">
                                ${getDIONodeStatusText(node.status)}
                            </span>
                        </div>
                        <div>
                            <strong class="text-slate-500">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong>
                            <p class="font-medium">${new Date(node.createdDate).toLocaleDateString('ru-RU')}</p>
                        </div>
                    </div>
                    ${node.description ? `
                        <div class="mt-3">
                            <strong class="text-slate-500">–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                            <p class="mt-1">${node.description}</p>
                        </div>
                    ` : ''}
                    ${node.tags && node.tags.length > 0 ? `
                        <div class="mt-3">
                            <strong class="text-slate-500">–¢–µ–≥–∏:</strong>
                            <div class="flex flex-wrap gap-1 mt-1">
                                ${node.tags.map(tag => `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${tag}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;
                
                nodeInfo.classList.remove('hidden');
            }
        }
        
        function findDIONode(nodeId) {
            if (dioTrees.length === 0) return null;
            
            for (const tree of dioTrees) {
                const node = tree.nodes.find(n => n.id === nodeId);
                if (node) return node;
            }
            
            return null;
        }
        
        function getDIONodeTypeText(type) {
            switch(type) {
                case 'department': return '–û—Ç–¥–µ–ª';
                case 'position': return '–î–æ–ª–∂–Ω–æ—Å—Ç—å';
                case 'function': return '–§—É–Ω–∫—Ü–∏—è';
                case 'document': return '–î–æ–∫—É–º–µ–Ω—Ç';
                default: return type;
            }
        }
        
        function getDIONodeStatusText(status) {
            switch(status) {
                case 'active': return '–ê–∫—Ç–∏–≤–Ω—ã–π';
                case 'draft': return '–ß–µ—Ä–Ω–æ–≤–∏–∫';
                case 'archived': return '–ê—Ä—Ö–∏–≤–Ω—ã–π';
                default: return status;
            }
        }
        
        function addDIORootNode() {
            document.getElementById('dioModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª';
            document.getElementById('dioNodeModal').classList.remove('hidden');
            
            // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            document.getElementById('dioNodeName').value = '';
            document.getElementById('dioNodeDescription').value = '';
            document.getElementById('dioNodeType').value = 'department';
            document.getElementById('dioNodeStatus').value = 'active';
            document.getElementById('dioNodeTags').value = '';
        }
        
        function addDIOSubNode() {
            if (!selectedDIONodeId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—á–∏–Ω–µ–Ω–Ω–æ–≥–æ');
                return;
            }
            
            document.getElementById('dioModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–π —É–∑–µ–ª';
            document.getElementById('dioNodeModal').classList.remove('hidden');
            
            // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            document.getElementById('dioNodeName').value = '';
            document.getElementById('dioNodeDescription').value = '';
            document.getElementById('dioNodeType').value = 'position';
            document.getElementById('dioNodeStatus').value = 'active';
            document.getElementById('dioNodeTags').value = '';
        }
        
        function editDIONode() {
            if (!selectedDIONodeId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            const node = findDIONode(selectedDIONodeId);
            if (!node) return;
            
            document.getElementById('dioModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–∑–µ–ª';
            document.getElementById('dioNodeModal').classList.remove('hidden');
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—è —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã–º–∏ —É–∑–ª–∞
            document.getElementById('dioNodeName').value = node.name || '';
            document.getElementById('dioNodeDescription').value = node.description || '';
            document.getElementById('dioNodeType').value = node.type || 'department';
            document.getElementById('dioNodeStatus').value = node.status || 'active';
            document.getElementById('dioNodeTags').value = node.tags ? node.tags.join(', ') : '';
        }
        
        function closeDIONodeModal() {
            document.getElementById('dioNodeModal').classList.add('hidden');
        }
        
        function saveDIONode() {
            const name = document.getElementById('dioNodeName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–∑–ª–∞');
                return;
            }
            
            const nodeData = {
                id: Date.now(),
                name: name,
                description: document.getElementById('dioNodeDescription').value.trim(),
                type: document.getElementById('dioNodeType').value,
                status: document.getElementById('dioNodeStatus').value,
                tags: document.getElementById('dioNodeTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                createdDate: Date.now(),
                updatedDate: Date.now(),
                children: []
            };
            
            if (dioTrees.length === 0) {
                // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ
                dioTrees.push({
                    id: Date.now(),
                    name: '–û—Å–Ω–æ–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ',
                    createdDate: Date.now(),
                    nodes: [nodeData]
                });
            } else {
                const tree = dioTrees[0];
                
                if (selectedDIONodeId && document.getElementById('dioModalTitle').textContent === '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–∑–µ–ª') {
                    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —É–∑–ª–∞
                    const nodeIndex = tree.nodes.findIndex(n => n.id === selectedDIONodeId);
                    if (nodeIndex !== -1) {
                        nodeData.id = selectedDIONodeId;
                        nodeData.children = tree.nodes[nodeIndex].children || [];
                        tree.nodes[nodeIndex] = nodeData;
                    }
                } else if (selectedDIONodeId) {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞
                    const parentNode = tree.nodes.find(n => n.id === selectedDIONodeId);
                    if (parentNode) {
                        nodeData.parentId = selectedDIONodeId;
                        tree.nodes.push(nodeData);
                        parentNode.children = parentNode.children || [];
                        parentNode.children.push(nodeData.id);
                    }
                } else {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞
                    tree.nodes.push(nodeData);
                }
            }
            
            saveDIOTrees();
            renderDIOTree();
            closeDIONodeModal();
            showNotification('‚úÖ –£–∑–µ–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'success');
        }
        
        function deleteDIONode() {
            if (!selectedDIONodeId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É–∑–µ–ª –∏ –≤—Å–µ—Ö –µ–≥–æ –ø–æ—Ç–æ–º–∫–æ–≤?')) {
                return;
            }
            
            if (dioTrees.length === 0) return;
            
            const tree = dioTrees[0];
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Ç–æ–º–∫–æ–≤
            function deleteNodeAndChildren(nodeId) {
                const nodeIndex = tree.nodes.findIndex(n => n.id === nodeId);
                if (nodeIndex === -1) return;
                
                const node = tree.nodes[nodeIndex];
                
                // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –¥–µ—Ç–µ–π
                if (node.children && node.children.length > 0) {
                    node.children.forEach(childId => {
                        deleteNodeAndChildren(childId);
                    });
                }
                
                // –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —ç—Ç–æ—Ç —É–∑–µ–ª —É —Ä–æ–¥–∏—Ç–µ–ª—è
                if (node.parentId) {
                    const parentNode = tree.nodes.find(n => n.id === node.parentId);
                    if (parentNode && parentNode.children) {
                        parentNode.children = parentNode.children.filter(id => id !== nodeId);
                    }
                }
                
                // –£–¥–∞–ª–∏—Ç—å —Å–∞–º —É–∑–µ–ª
                tree.nodes.splice(nodeIndex, 1);
            }
            
            deleteNodeAndChildren(selectedDIONodeId);
            selectedDIONodeId = null;
            
            saveDIOTrees();
            renderDIOTree();
            showNotification('‚úÖ –£–∑–µ–ª —É–¥–∞–ª–µ–Ω', 'success');
        }
        
        function collapseAllDIONodes() {
            // –í –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –¥–µ—Ä–µ–≤–æ
            renderDIOTree();
            showNotification('–í—Å–µ —É–∑–ª—ã —Å–≤–µ—Ä–Ω—É—Ç—ã', 'info');
        }
        
        function expandAllDIONodes() {
            // –í —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ—Å—Ç–∏
            renderDIOTree();
            showNotification('–í—Å–µ —É–∑–ª—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã', 'info');
        }
        
        function saveDIOTree() {
            saveDIOTrees();
            showNotification('‚úÖ –î–µ—Ä–µ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'success');
        }
        
        function importDIOJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const json = JSON.parse(e.target.result);
                        
                        if (json.nodes && Array.isArray(json.nodes)) {
                            // –ò–º–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ nodes
                            dioTrees = [{
                                id: Date.now(),
                                name: '–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ',
                                createdDate: Date.now(),
                                nodes: json.nodes
                            }];
                        } else if (Array.isArray(json) && json[0] && json[0].nodes) {
                            // –ò–º–ø–æ—Ä—Ç –º–∞—Å—Å–∏–≤–∞ –¥–µ—Ä–µ–≤—å–µ–≤
                            dioTrees = json;
                        } else {
                            alert('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –î–ò–û');
                            return;
                        }
                        
                        saveDIOTrees();
                        renderDIOTree();
                        showNotification('‚úÖ –î–µ—Ä–µ–≤–æ –î–ò–û –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                    } catch(e) {
                        alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: " + e.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function exportDIOJSON() {
            if (dioTrees.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dioTrees, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = `dio_tree_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showNotification('‚úÖ –î–µ—Ä–µ–≤–æ –î–ò–û —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ', 'success');
        }
        
        function zoomInDIO() {
            const svg = document.querySelector('#dioTree svg');
            if (!svg) return;
            
            const viewBox = svg.getAttribute('viewBox').split(' ').map(Number);
            const scaleFactor = 0.8;
            
            const newWidth = viewBox[2] * scaleFactor;
            const newHeight = viewBox[3] * scaleFactor;
            const newX = viewBox[0] + (viewBox[2] - newWidth) / 2;
            const newY = viewBox[1] + (viewBox[3] - newHeight) / 2;
            
            svg.setAttribute('viewBox', `${newX} ${newY} ${newWidth} ${newHeight}`);
        }
        
        function zoomOutDIO() {
            const svg = document.querySelector('#dioTree svg');
            if (!svg) return;
            
            const viewBox = svg.getAttribute('viewBox').split(' ').map(Number);
            const scaleFactor = 1.2;
            
            const newWidth = viewBox[2] * scaleFactor;
            const newHeight = viewBox[3] * scaleFactor;
            const newX = viewBox[0] - (newWidth - viewBox[2]) / 2;
            const newY = viewBox[1] - (newHeight - viewBox[3]) / 2;
            
            svg.setAttribute('viewBox', `${newX} ${newY} ${newWidth} ${newHeight}`);
        }
        
        function resetZoomDIO() {
            const svg = document.querySelector('#dioTree svg');
            if (!svg) return;
            
            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É–∑–ª—ã –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü
            const nodes = document.querySelectorAll('#dioTree .node');
            if (nodes.length === 0) return;
            
            const positions = [];
            nodes.forEach(node => {
                positions.push({
                    x: parseFloat(node.getAttribute('x')),
                    y: parseFloat(node.getAttribute('y')),
                    width: parseFloat(node.getAttribute('width')),
                    height: parseFloat(node.getAttribute('height'))
                });
            });
            
            const allX = positions.map(p => p.x);
            const allY = positions.map(p => p.y);
            const allWidths = positions.map(p => p.width);
            const allHeights = positions.map(p => p.height);
            
            const minX = Math.min(...allX) - 100;
            const maxX = Math.max(...allX.map((x, i) => x + allWidths[i])) + 100;
            const minY = Math.min(...allY) - 100;
            const maxY = Math.max(...allY.map((y, i) => y + allHeights[i])) + 100;
            
            svg.setAttribute('viewBox', `${minX} ${minY} ${maxX - minX} ${maxY - minY}`);
        }
        
        function centerDIO() {
            resetZoomDIO();
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        
        window.addEventListener('DOMContentLoaded', function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const container = document.getElementById('subsectionsContainer');
            const icon = document.getElementById('collapseIcon');
            const capitalizationContainer = document.getElementById('capitalizationSubsections');
            const capitalizationIcon = document.getElementById('capitalizationIcon');
            
            if (container && icon) {
                container.style.display = 'block';
                icon.textContent = '‚ñº';
                areSubsectionsCollapsed = false;
            }
            
            if (capitalizationContainer && capitalizationIcon) {
                capitalizationContainer.style.display = 'none';
                capitalizationIcon.textContent = '‚ñº';
                isCapitalizationExpanded = false;
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            loadData();
            loadDashboardsData();
            loadDIOTrees();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ hash –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const urlHash = window.location.hash;
            if (urlHash === '#calculator' || urlHash === '#capitalization') {
                if (capitalizationContainer && capitalizationIcon) {
                    capitalizationContainer.style.display = 'block';
                    capitalizationIcon.style.transform = 'rotate(180deg)';
                    capitalizationIcon.textContent = '‚ñ≤';
                    isCapitalizationExpanded = true;
                }
                setTimeout(() => {
                    switchTab('calculator');
                }, 100);
            } else if (urlHash === '#dio') {
                setTimeout(() => {
                    switchTab('dio');
                }, 100);
            } else if (urlHash === '#dashboards') {
                setTimeout(() => {
                    switchTab('dashboards');
                }, 100);
            } else {
                // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–µ–Ω –†–µ–µ—Å—Ç—Ä –ù–ü–ê
                const npaNav = document.getElementById('navNPA');
                if (npaNav) {
                    npaNav.classList.add('active');
                }
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ GitHub
            loadFromGitHub().then(() => {
                console.log('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }).catch((error) => {
                console.log('‚ö†Ô∏è GitHub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
                console.log('–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è hash
            window.addEventListener('hashchange', function() {
                const hash = window.location.hash;
                console.log('Hash changed to:', hash);
                
                if (hash === '#calculator') {
                    if (capitalizationContainer && capitalizationIcon && !isCapitalizationExpanded) {
                        toggleCapitalization();
                    }
                    setTimeout(() => {
                        switchTab('calculator');
                    }, 50);
                } else if (hash === '#dio') {
                    switchTab('dio');
                } else if (hash === '#dashboards') {
                    switchTab('dashboards');
                } else if (hash === '#npas') {
                    switchTab('npas');
                }
            });
        });
    </script>
</body>
</html>
