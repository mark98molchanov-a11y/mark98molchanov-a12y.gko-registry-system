<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–¥–µ–ª –ì–ö–û: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π </title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ Tailwind –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: { 
                            50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 
                            600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e' 
                        },
                        superset: { 50: '#eef2ff', 500: '#4f46e5', 600: '#4338ca', 700: '#3730a3' },
                        calculator: { 50: '#f0f9ff', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9' },
                        dio: { 50: '#f0f9ff', 500: '#7c3aed', 600: '#6d28d9', 700: '#5b21b6' }
                    }
                }
            }
        }
        
        body { background-color: #f8fafc; }
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        .tab-btn { 
            border-bottom: 2px solid transparent; 
            color: #64748b; 
            cursor: pointer; 
            transition: all 0.2s; 
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        .tab-btn:hover { color: #1e293b; }
        .tab-btn.active { 
            border-bottom: 2px solid #0ea5e9; 
            color: #0ea5e9; 
            font-weight: 600; 
        }
        
        .card-anim { transition: all 0.2s ease-out; }
        .card-anim:hover { transform: translateY(-2px); }

        .filter-chip {
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        .filter-chip.active {
            background-color: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
            box-shadow: 0 2px 4px rgba(14, 165, 233, 0.3);
        }
        .filter-chip:not(.active):hover {
            background-color: #e2e8f0;
            color: #334155;
        }

        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            width: 1.25em; height: 1.25em;
            border: 2px solid #cbd5e1;
            border-radius: 0.35em;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .custom-checkbox::before {
            content: "";
            width: 0.75em; height: 0.75em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked {
            background-color: #0ea5e9;
            border-color: #0ea5e9;
        }
        .custom-checkbox:checked::before { transform: scale(1); }
        
        .progress-bar-fill { transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .dashboard-card {
            border-left: 4px solid #4f46e5;
            position: relative;
            overflow: hidden;
        }
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4f46e510 0%, transparent 100%);
            border-radius: 0 0 0 60px;
        }
        
        .status-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .status-active { background-color: #10b98120; color: #059669; }
        .status-draft { background-color: #f59e0b20; color: #d97706; }
        .status-archived { background-color: #6b728020; color: #4b5563; }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chart-container { height: 260px; }
        
        .calculator-tab {
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .methodology-text h3 { color: #1e3a8a; font-weight: 700; margin-top: 1.5em; margin-bottom: 0.5em; font-size: 1.1em; }
        .methodology-text h4 { color: #1e40af; font-weight: 600; margin-top: 1em; margin-bottom: 0.3em; font-size: 0.95em; }
        .methodology-text p { margin-bottom: 0.8em; line-height: 1.6; text-align: justify; }
        .methodology-text ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .methodology-text li { margin-bottom: 0.4em; }
        .methodology-text .definition { font-size: 0.9em; color: #334155; margin-left: 1em; border-left: 2px solid #cbd5e1; padding-left: 0.8em; margin-bottom: 0.5em; }
        .methodology-text .source { font-size: 0.85em; color: #64748b; font-style: italic; margin-top: 4px; display: block; }
        
        .calculator-input::placeholder {
            color: transparent;
        }
        
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; }
            .shadow-lg, .shadow-xl { box-shadow: none !important; }
            .border { border: 1px solid #ddd !important; }
        }
        .print-only { display: none; }
        
        .book-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .book-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
            flex-shrink: 0;
            box-shadow: 1px 0 5px rgba(0,0,0,0.05);
        }
        
        .book-content {
            flex-grow: 1;
            overflow-y: auto;
            background: #f8fafc;
        }
        
        .book-section {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .book-section.main {
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .book-section.main:hover {
            background: linear-gradient(135deg, #075985 0%, #0c4a6e 100%);
        }
        
        .book-subsection {
            padding: 1rem 1.5rem 1rem 3rem;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
        }
        
        .book-subsection:hover {
            background: #f1f5f9;
            color: #0ea5e9;
        }
        
        .book-subsection.active {
            background: #e0f2fe;
            color: #0284c7;
            border-left: 4px solid #0ea5e9;
            font-weight: 600;
        }
        
        .section-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .book-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .book-header-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }
        
        .book-header-subtitle {
            font-size: 0.875rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        
        .capitalization-section {
            border-top: 1px solid #e2e8f0;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
        }
        
        .book-subsubsection {
            padding: 0.75rem 1.5rem 0.75rem 3.5rem;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
            font-size: 0.875rem;
            background: #f8fafc;
        }
        
        .book-subsubsection:hover {
            background: #e0f2fe;
            color: #0284c7;
        }
        
        .book-subsubsection.active {
            background: #dbeafe;
            color: #1d4ed8;
            border-left: 3px solid #3b82f6;
            font-weight: 600;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ GitHub Token */
        #githubTokenModal {
            transition: opacity 0.2s;
        }
        
        #githubTokenModal:not(.hidden) {
            opacity: 1;
        }
        
        #githubTokenModal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        #githubTokenInput {
            font-family: 'Consolas', 'Monaco', monospace;
            letter-spacing: 0.5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –î–ò–û */
        .dio-tab-content {
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .dio-tab-content.active {
            display: block;
            opacity: 1;
        }
        
        .tree-container {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            overflow: hidden;
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }
        
        .tree-header {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tree-title {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .tree-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .tree-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }
        
        .tree-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .tree-wrapper {
            flex: 1;
            overflow: auto;
            padding: 1rem;
            position: relative;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û */
        #dioTree {
            min-height: 500px;
            font-family: 'Inter', sans-serif;
        }
        
        .tree-node {
            margin: 4px 0;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        
        .tree-node:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        .tree-node.selected {
            background: #e0f2fe;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.1);
        }
        
        .node-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .node-toggle {
            cursor: pointer;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background: #e2e8f0;
            color: #64748b;
        }
        
        .node-toggle:hover {
            background: #cbd5e1;
        }
        
        .node-text {
            flex: 1;
            font-size: 0.875rem;
            color: #334155;
        }
        
        .node-badge {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 9999px;
            background: #e2e8f0;
            color: #64748b;
        }
        
        /* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            z-index: 1000;
            min-width: 200px;
            display: none;
        }
        
        .context-menu.active {
            display: block;
        }
        
        .context-menu-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
            color: #334155;
            transition: background 0.2s;
        }
        
        .context-menu-item:hover {
            background: #f1f5f9;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background: #10b981;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            z-index: 1000;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û */
        .dark-theme .tree-node {
            background: #1e293b;
            border-color: #334155;
            color: #cbd5e1;
        }
        
        .dark-theme .tree-node:hover {
            background: #334155;
            border-color: #475569;
        }
        
        .dark-theme .tree-node.selected {
            background: #0c4a6e;
            border-color: #0ea5e9;
        }
        
        .dark-theme .node-toggle {
            background: #334155;
            color: #94a3b8;
        }
        
        .dark-theme .node-toggle:hover {
            background: #475569;
        }
        
        .dark-theme .node-text {
            color: #cbd5e1;
        }
        
        .dark-theme .node-badge {
            background: #334155;
            color: #94a3b8;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1024px) {
            .book-sidebar {
                width: 240px;
            }
        }
        
        @media (max-width: 768px) {
            .book-layout {
                flex-direction: column;
            }
            
            .book-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
                max-height: 300px;
            }
            
            .tree-controls {
                flex-wrap: wrap;
            }
            
            .tree-btn {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }
        }
    </style>
    
    <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û -->
    <style id="dio-styles">
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ */
        :root {
            --primary-color: #7c3aed;
            --primary-light: #8b5cf6;
            --primary-dark: #6d28d9;
            --accent-color: #10b981;
            --text-color: #334155;
            --text-light: #64748b;
            --bg-color: #ffffff;
            --controls-bg: #f8fafc;
            --border-color: #e2e8f0;
            --hover-bg: #f1f5f9;
            --selected-bg: #e0f2fe;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .dark-theme {
            --primary-color: #8b5cf6;
            --primary-light: #a78bfa;
            --primary-dark: #7c3aed;
            --accent-color: #34d399;
            --text-color: #f1f5f9;
            --text-light: #cbd5e1;
            --bg-color: #0f172a;
            --controls-bg: #1e293b;
            --border-color: #334155;
            --hover-bg: #334155;
            --selected-bg: #1e40af;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        
        /* –ö–æ–Ω—Ç—Ä–æ–ª—ã –¥–µ—Ä–µ–≤–∞ */
        .dio-controls {
            position: sticky;
            top: 0;
            background: var(--controls-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            z-index: 10;
        }
        
        .dio-controls input,
        .dio-controls select,
        .dio-controls button {
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 0.875rem;
        }
        
        .dio-controls button {
            cursor: pointer;
            transition: all 0.2s;
            background: var(--primary-color);
            color: white;
            border: none;
        }
        
        .dio-controls button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        /* –£–∑–ª—ã –¥–µ—Ä–µ–≤–∞ */
        .tree-node-wrapper {
            margin-left: 1.5rem;
            position: relative;
        }
        
        .tree-node-wrapper::before {
            content: '';
            position: absolute;
            left: -0.75rem;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border-color);
        }
        
        .tree-node {
            position: relative;
            margin: 0.25rem 0;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        
        .tree-node:hover {
            background: var(--hover-bg);
            border-color: var(--primary-light);
            transform: translateX(2px);
        }
        
        .tree-node.selected {
            background: var(--selected-bg);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }
        
        .tree-node.dragging {
            opacity: 0.7;
            transform: scale(0.98);
        }
        
        .node-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .node-toggle {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 0.25rem;
            background: var(--controls-bg);
            color: var(--text-light);
            transition: all 0.2s;
        }
        
        .node-toggle:hover {
            background: var(--border-color);
        }
        
        .node-title {
            flex: 1;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .node-badges {
            display: flex;
            gap: 0.25rem;
            margin-left: 0.5rem;
        }
        
        .node-badge {
            font-size: 0.75rem;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            background: var(--controls-bg);
            color: var(--text-light);
        }
        
        .node-badge.important {
            background: #fef3c7;
            color: #92400e;
        }
        
        .node-badge.warning {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .node-badge.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .info-panel {
            position: fixed;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            width: 300px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            padding: 1rem;
            z-index: 1000;
            display: none;
        }
        
        .info-panel.active {
            display: block;
        }
        
        .info-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .info-panel-title {
            font-weight: 600;
            color: var(--text-color);
        }
        
        .info-panel-close {
            cursor: pointer;
            color: var(--text-light);
            font-size: 1.25rem;
            line-height: 1;
        }
        
        .info-panel-content {
            color: var(--text-color);
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—à–∏–±–∫–∏ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            padding: 1rem;
            border-radius: 0.5rem;
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            margin: 1rem;
        }
        
        /* –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ */
        .drop-zone {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(124, 58, 237, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            z-index: 9999;
            display: none;
        }
        
        .drop-zone.active {
            display: flex;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                width: auto;
                transform: none;
                border-radius: 0.5rem 0.5rem 0 0;
            }
            
            .dio-controls {
                padding: 0.5rem;
            }
            
            .dio-controls button {
                padding: 0.375rem 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="text-slate-800 antialiased flex flex-col min-h-screen">

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-4">
                    <div class="bg-brand-900 text-white p-2 rounded-lg shadow-lg">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-900 leading-none tracking-tight">–û—Ç–¥–µ–ª –ì–ö–û</h1>
                        <p class="text-xs text-slate-500 mt-1 font-medium">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <div class="flex gap-2">
                        <!-- Combined JSON Import -->
                        <button onclick="importJson()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                            <span>–ò–º–ø–æ—Ä—Ç JSON</span>
                        </button>

                        <button onclick="exportJson()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç JSON</span>
                        </button>

                        <!-- Save to GitHub -->
                        <button onclick="showGitHubTokenModal()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow flex items-center gap-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
                            </svg>
                            <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ GitHub</span>
                        </button>
                        
                        <button onclick="hardResetCurrent()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 011.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            <span id="resetBtnText">–°–±—Ä–æ—Å</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="book-layout">
        <aside class="book-sidebar">
            <div class="book-section main" onclick="toggleAllSections()">
                <div class="section-icon">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                </div>
                <span>–û—Ç–¥–µ–ª –ì–ö–û</span>
                <div id="collapseIcon" class="ml-auto transition-transform">‚ñº</div>
            </div>
            
            <div id="subsectionsContainer">
                <div class="book-subsection" onclick="switchTab('npas')" id="navNPA">
                    <div class="section-icon">üìö</div>
                    <span>–†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê</span>
                </div>
                
                <div class="book-subsection" onclick="switchTab('dashboards')" id="navDashboards">
                    <div class="section-icon">üìä</div>
                    <span>–î–∞—à–±–æ—Ä–¥—ã superset</span>
                </div>
                
                <div class="capitalization-section">
                    <div class="book-subsection" onclick="toggleCapitalization()" id="navCapitalizationToggle">
                        <div class="section-icon">üí∞</div>
                        <span>–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
                        <div class="ml-auto transition-transform" id="capitalizationIcon">‚ñº</div>
                    </div>
                    
                    <div id="capitalizationSubsections" style="display: none;">
                        <div class="book-subsubsection" onclick="switchTab('calculator')" id="navCalculator">
                            <div class="section-icon">üßÆ</div>
                            <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
                        </div>
                    </div>
                </div>
                
                <div class="book-section main" onclick="switchTab('dio')" style="background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); border-top: 1px solid #8b5cf6;">
                    <div class="section-icon">
                        <img src="https://avatars.mds.yandex.net/i?id=b76c00669840a26fac6c5622da34239f_l-16407139-images-thumbs&n=13" 
                             style="width: 20px; height: 20px; object-fit: contain; border-radius: 4px;">
                    </div>
                    <span>–ë–∞–∑–∞ –î–ò–û</span>
                </div>
            </div>
        </aside>

        <main class="book-content">
            <div class="book-header">
                <div>
                    <div class="book-header-title" id="currentSectionTitle">–†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê</div>
                    <div class="book-header-subtitle" id="currentSectionSubtitle">–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã –∏ –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è</div>
                </div>
                
                <div class="flex items-center gap-3" id="currentSectionButtons">
                    <div id="npaImportButtons" class="flex gap-2">
                        <button onclick="document.getElementById('importInput').click()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            <span>–ò–º–ø–æ—Ä—Ç Excel</span>
                        </button>
                        <input type="file" id="importInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="handleFileImport(this)">
                    </div>
                    
                    <div id="dashboardsImportButtons" class="flex gap-2 hidden">
                        <button onclick="document.getElementById('importExcelInput').click()" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            <span>–ò–º–ø–æ—Ä—Ç Excel</span>
                        </button>
                        <input type="file" id="importExcelInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="handleExcelImport(this)">
                    </div>
                    
                    <button id="addButton" onclick="openModal()" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow flex items-center gap-2 active:scale-95">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        <span id="addButtonText">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</span>
                    </button>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê -->
            <div class="tab-content active" id="npasTab">
                <div class="flex-grow w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 pb-24">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ù–ü–ê -->
                    <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <!-- Total Card -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="resetAllFilters()">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-brand-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-brand-100"></div>
                            <div class="relative z-10">
                                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–ù–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ</h3>
                                <div class="text-4xl font-extrabold text-slate-900" id="statTotal">0</div>
                                <div class="mt-4 flex items-center text-xs text-brand-600 font-medium">
                                    <span class="w-2 h-2 rounded-full bg-brand-500 mr-2"></span> –ó–∞–ø–∏—Å–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm md:col-span-3 flex flex-col justify-between">
                            <div class="flex justify-between items-center mb-4">
                                 <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–∏</h3>
                                 <span class="text-[10px] text-slate-400">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div onclick="setDocFilter('237-–§–ó')" class="p-3 rounded-xl bg-indigo-50 border border-indigo-100 cursor-pointer hover:bg-indigo-100 transition relative overflow-hidden group">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-indigo-900 text-xs">237-–§–ó</span>
                                        <span class="bg-white/80 text-indigo-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countFZ">0</span>
                                    </div>
                                    <div class="w-full bg-indigo-200 rounded-full h-1 overflow-hidden">
                                        <div id="barFZ" class="bg-indigo-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div onclick="setDocFilter('–ü—Ä–∏–∫–∞–∑ ‚Ññ –ü/0336')" class="p-3 rounded-xl bg-sky-50 border border-sky-100 cursor-pointer hover:bg-sky-100 transition relative overflow-hidden group">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-sky-900 text-xs">–ü—Ä–∏–∫–∞–∑ –ü/0336</span>
                                        <span class="bg-white/80 text-sky-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countOrder">0</span>
                                    </div>
                                    <div class="w-full bg-sky-200 rounded-full h-1 overflow-hidden">
                                        <div id="barOrder" class="bg-sky-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div onclick="setDocFilter('378.2 –ù–ö –†–§')" class="p-3 rounded-xl bg-amber-50 border border-amber-100 cursor-pointer hover:bg-amber-100 transition relative overflow-hidden group">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-bold text-amber-900 text-xs">378.2 –ù–ö –†–§</span>
                                        <span class="bg-white/80 text-amber-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countNK">0</span>
                                    </div>
                                    <div class="w-full bg-amber-200 rounded-full h-1 overflow-hidden">
                                        <div id="barNK" class="bg-amber-600 h-1 rounded-full progress-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ù–ü–ê -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 space-y-4">
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row gap-4">
                                <div class="relative flex-grow">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                    </span>
                                    <input type="text" id="searchInput" oninput="renderGrid()" placeholder="–ü–æ–∏—Å–∫..." class="pl-10 pr-4 py-2.5 w-full border border-slate-200 bg-slate-50 rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                                </div>
                                <select id="sortSelect" onchange="renderGrid()" class="py-2.5 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none cursor-pointer">
                                    <option value="lastUpdated">üïí –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è</option>
                                    <option value="dateDesc">üìÖ –ü–æ –¥–∞—Ç–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
                                    <option value="dateAsc">üìÖ –ü–æ –¥–∞—Ç–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
                                </select>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4">
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–§–∏–ª—å—Ç—Ä –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É</div>
                                    <div class="flex gap-2 overflow-x-auto custom-scroll pb-1" id="docFilterContainer"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É</div>
                                    <div class="flex gap-2 flex-wrap" id="typeFilterContainer"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–µ–≥–∏</div>
                                    <div class="flex gap-2 flex-wrap" id="targetContainer"></div>
                                </div>
                            </div>
                            <div id="activeFiltersBar" class="hidden flex items-center justify-between bg-brand-50 border border-brand-100 text-brand-700 px-4 py-2 rounded-lg text-sm">
                                <span class="font-medium">–§–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
                                <button onclick="resetAllFilters()" class="text-xs font-bold uppercase hover:text-brand-900 underline">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–≤ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–µ)</h4>
                            <div class="flex-grow relative" style="min-height: 300px;">
                                <canvas id="typeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mt-2 mb-1">
                        <div class="text-sm text-slate-500 font-medium">–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π (<span id="filteredCount">0</span>)</div>
                        <div class="flex gap-2">
                            <button onclick="exportToExcelNPA()" class="text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                –≠–∫—Å–ø–æ—Ä—Ç Excel
                            </button>
                            <button onclick="toggleSelectAll()" class="text-xs text-brand-600 font-bold hover:underline ml-4">–í—ã–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    
                    <div id="cardsGrid" class="grid grid-cols-1 gap-4"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –î–∞—à–±–æ—Ä–¥—ã -->
            <div class="tab-content" id="dashboardsTab">
                <div class="flex-grow w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 pb-24">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ -->
                    <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="resetAllDashboardsFilters()">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-superset-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-superset-100"></div>
                            <div class="relative z-10">
                                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–í—Å–µ–≥–æ –¥–∞—à–±–æ—Ä–¥–æ–≤</h3>
                                <div class="text-4xl font-extrabold text-slate-900" id="statTotalDashboards">0</div>
                                <div class="mt-4 flex items-center text-xs text-superset-600 font-medium">
                                    <span class="w-2 h-2 rounded-full bg-superset-500 mr-2"></span> –í —Å–∏—Å—Ç–µ–º–µ Apache Superset
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group" onclick="setStatusFilterDashboards('active')">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-emerald-100"></div>
                            <div class="relative z-10">
                                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">–ê–∫—Ç–∏–≤–Ω—ã–µ</h3>
                                <div class="text-4xl font-extrabold text-emerald-600" id="statActiveDashboards">0</div>
                                <div class="mt-4 flex items-center text-xs text-emerald-600 font-medium">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2"></span> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–±–æ—Ç–µ
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition cursor-pointer relative overflow-hidden group md:col-span-2">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-amber-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-amber-100"></div>
                            <div class="relative z-10">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">–ü–æ —Ç–∏–ø–∞–º –∞–Ω–∞–ª–∏–∑–∞</h3>
                                    <span class="text-[10px] text-slate-400">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div onclick="setTypeFilterDashboards('analytical')" class="p-2.5 rounded-xl bg-slate-50 border border-slate-100 cursor-pointer hover:bg-slate-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-slate-700 text-xs">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                                            <span class="bg-white text-slate-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countAnalytical">0</span>
                                        </div>
                                    </div>
                                    <div onclick="setTypeFilterDashboards('monitoring')" class="p-2.5 rounded-xl bg-blue-50 border border-blue-100 cursor-pointer hover:bg-blue-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-blue-700 text-xs">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</span>
                                            <span class="bg-white text-blue-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countMonitoring">0</span>
                                        </div>
                                    </div>
                                    <div onclick="setTypeFilterDashboards('operational')" class="p-2.5 rounded-xl bg-purple-50 border border-purple-100 cursor-pointer hover:bg-purple-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-purple-700 text-xs">–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ</span>
                                            <span class="bg-white text-purple-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countOperational">0</span>
                                        </div>
                                    </div>
                                    <div onclick="setTypeFilterDashboards('reporting')" class="p-2.5 rounded-xl bg-rose-50 border border-rose-100 cursor-pointer hover:bg-rose-100 transition">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-rose-700 text-xs">–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å</span>
                                            <span class="bg-white text-rose-700 text-[10px] font-bold px-1.5 py-0.5 rounded" id="countReporting">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤ -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 space-y-4">
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col sm:flex-row gap-4">
                                <div class="relative flex-grow">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </span>
                                    <input type="text" id="searchInputDashboards" oninput="renderDashboardsGrid()" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é..." class="pl-10 pr-4 py-2.5 w-full border border-slate-200 bg-slate-50 rounded-lg text-sm focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none">
                                </div>
                                <select id="sortSelectDashboards" onchange="renderDashboardsGrid()" class="py-2.5 px-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none cursor-pointer">
                                    <option value="createdDesc">üìÖ –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
                                    <option value="createdAsc">üìÖ –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
                                    <option value="nameAsc">üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                                    <option value="nameDesc">üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                                </select>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-4">
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–°—Ç–∞—Ç—É—Å</div>
                                    <div class="flex gap-2 overflow-x-auto custom-scroll pb-1" id="statusFilterContainerDashboards"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</div>
                                    <div class="flex gap-2 flex-wrap" id="typeFilterContainerDashboards"></div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-slate-400 uppercase mb-2">–¢–µ–≥–∏</div>
                                    <div class="flex gap-2 flex-wrap" id="tagsContainerDashboards"></div>
                                </div>
                            </div>
                            <div id="activeFiltersBarDashboards" class="hidden flex items-center justify-between bg-brand-50 border border-brand-100 text-brand-700 px-4 py-2 rounded-lg text-sm">
                                <span class="font-medium">–§–∏–ª—å—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã</span>
                                <button onclick="resetAllDashboardsFilters()" class="text-xs font-bold uppercase hover:text-brand-900 underline">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col">
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –∞–Ω–∞–ª–∏–∑–∞</h4>
                            <div class="chart-container">
                                <canvas id="typeChartDashboards"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mt-2 mb-1">
                        <div class="text-sm text-slate-500 font-medium">–î–∞—à–±–æ—Ä–¥—ã (<span id="filteredCountDashboards">0</span>)</div>
                        <div class="flex gap-2">
                            <button onclick="exportToExcelDashboards()" class="text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                –≠–∫—Å–ø–æ—Ä—Ç Excel
                            </button>
                            <button onclick="toggleSelectAllDashboards()" class="text-xs text-brand-600 font-bold hover:underline ml-4">–í—ã–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    
                    <div id="cardsGridDashboards" class="grid grid-cols-1 lg:grid-cols-2 gap-6"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
            <div class="tab-content calculator-tab" id="calculatorTab">
                <div id="calculatorRoot"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ë–∞–∑–∞ –î–ò–û -->
            <div class="tab-content dio-tab-content" id="dioTab">
                <div class="flex-grow w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="tree-container">
                        <div class="tree-header">
                            <div class="tree-title">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã—Ö –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π</div>
                            <div class="tree-controls">
                                <button class="tree-btn" id="dioSaveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button class="tree-btn" id="dioLoadBtn">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub</button>
                                <button class="tree-btn" id="dioExportBtn">üì§ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
                                <button class="tree-btn" id="dioImportBtn">üì• –ò–º–ø–æ—Ä—Ç JSON</button>
                                <button class="tree-btn" id="dioAddRootBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–µ–Ω—å</button>
                                <button class="tree-btn" id="dioThemeBtn">üåì –¢–µ–º–∞</button>
                            </div>
                        </div>
                        
                        <div class="dio-controls">
                            <input type="text" id="dioSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." style="flex: 1;">
                            <select id="dioFilterSelect">
                                <option value="">–í—Å–µ —É–∑–ª—ã</option>
                                <option value="important">–í–∞–∂–Ω—ã–µ</option>
                                <option value="warning">–í–Ω–∏–º–∞–Ω–∏–µ</option>
                                <option value="success">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
                            </select>
                            <button id="dioExpandBtn">üìñ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
                            <button id="dioCollapseBtn">üìï –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
                            <span id="dioNodeCount" style="color: var(--text-light); font-size: 0.875rem; margin-left: auto; padding: 0.5rem;">–£–∑–ª–æ–≤: 0</span>
                        </div>
                        
                        <div class="tree-wrapper">
                            <div id="dioTree"></div>
                        </div>
                    </div>
                    
                    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —É–∑–ª–µ -->
                    <div class="info-panel" id="dioInfoPanel">
                        <div class="info-panel-header">
                            <div class="info-panel-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–∑–ª–µ</div>
                            <div class="info-panel-close" id="dioInfoClose">√ó</div>
                        </div>
                        <div class="info-panel-content" id="dioInfoContent">
                            –í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                        </div>
                    </div>
                    
                    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é -->
                    <div class="context-menu" id="dioContextMenu">
                        <div class="context-menu-item" data-action="addChild">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª</div>
                        <div class="context-menu-item" data-action="edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</div>
                        <div class="context-menu-item" data-action="delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</div>
                        <div class="context-menu-item" data-action="duplicate">üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å</div>
                        <div class="context-menu-item" data-action="markImportant">‚≠ê –û—Ç–º–µ—Ç–∏—Ç—å –≤–∞–∂–Ω—ã–º</div>
                        <div class="context-menu-item" data-action="addNote">üìù –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ</div>
                    </div>
                    
                    <!-- –ó–æ–Ω–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
                    <div class="drop-zone" id="dioDropZone">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON —Ñ–∞–π–ª —Å—é–¥–∞</div>
                </div>
            </div>
        </main>
    </div>

    <footer class="bg-white border-t border-slate-200 mt-auto py-4">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-slate-400">&copy; 2026 –û—Ç–¥–µ–ª –ì–ö–û</p>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞) -->
    <div id="modal" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="relative bg-white w-full max-w-3xl mx-auto mt-10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden transform transition-all scale-95" id="modalContent">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ù–ü–ê -->
        </div>
    </div>

    <div id="modalDashboards" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeModalDashboards()"></div>
        <div class="relative bg-white w-full max-w-3xl mx-auto mt-10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden transform transition-all scale-95" id="modalContentDashboards">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤ -->
        </div>
    </div>

    <div id="githubTokenModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50" onclick="closeGitHubModal()"></div>
        <div class="relative bg-white w-96 mx-auto mt-32 rounded-xl shadow-xl p-6">
            <h3 class="text-lg font-bold mb-4">üîë GitHub Token</h3>
            <input type="password" id="githubTokenInput" placeholder="github_pat_..." class="w-full border p-3 rounded-lg mb-3 text-sm font-mono" autocomplete="off">
            <p class="text-xs text-gray-500 mb-4">–í–≤–µ–¥–∏—Ç–µ Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ <code>repo</code></p>
            <div class="flex gap-2">
                <button onclick="closeGitHubModal()" class="flex-1 py-2 border rounded-lg">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="saveToGitHub()" class="flex-1 py-2 bg-emerald-500 text-white rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞) -->
    <div id="bulkToolbar" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-40 hidden flex items-center gap-6 animate-bounce-in transition-all">
        <!-- –ü–∞–Ω–µ–ª—å –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ù–ü–ê -->
    </div>
    
    <div id="bulkToolbarDashboards" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl z-40 hidden flex items-center gap-6 animate-bounce-in transition-all">
        <!-- –ü–∞–Ω–µ–ª—å –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤ -->
    </div>

    <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û
        window.DIO_TREE_DATA = null;
        window.DIO_SELECTED_NODE = null;
        window.DIO_DRAGGING_NODE = null;
        window.DIO_CONTEXT_MENU_NODE = null;
        window.DIO_THEME = 'light';
        window.DIO_GITHUB_RAW_URL = 'https://raw.githubusercontent.com/mark98molchanov-a11y/mark98molchanov-a12y.gko-registry-system/main/';
        window.DIO_GITHUB_API_URL = 'https://api.github.com/repos/mark98molchanov-a11y/mark98molchanov-a12y.gko-registry-system/contents/';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ –î–ò–û
        function initDIOTree() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ –î–ò–û...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
            if (typeof LZString === 'undefined') {
                console.error('LZString –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            if (typeof Sortable === 'undefined') {
                console.error('Sortable –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞
            loadDIOTreeData();
            setupDIOTreeControls();
            renderDIOTree();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub
            setTimeout(() => {
                loadDIOTreeFromGitHub();
            }, 100);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–µ—Ä–µ–≤–∞
        function loadDIOTreeData() {
            const saved = localStorage.getItem('gko_dio_tree_v1');
            if (saved) {
                try {
                    window.DIO_TREE_DATA = JSON.parse(saved);
                    console.log('–î–∞–Ω–Ω—ã–µ –¥–µ—Ä–µ–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–µ—Ä–µ–≤–∞:', e);
                    createDefaultDIOTree();
                }
            } else {
                createDefaultDIOTree();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function createDefaultDIOTree() {
            window.DIO_TREE_DATA = {
                id: 'root',
                title: '–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
                children: [
                    {
                        id: 'node1',
                        title: '–û—Ç–¥–µ–ª –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è',
                        description: '–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–æ–ª–Ω–æ–º–æ—á–∏—è',
                        children: [
                            {
                                id: 'node1-1',
                                title: '–ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∑–µ–º–µ–ª—å',
                                tags: ['–≤–∞–∂–Ω–æ', '–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç']
                            },
                            {
                                id: 'node1-2',
                                title: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –≥—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–æ—Ä–º'
                            }
                        ]
                    },
                    {
                        id: 'node2',
                        title: '–û—Ç–¥–µ–ª –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π',
                        children: [
                            {
                                id: 'node2-1',
                                title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–º—É—â–µ—Å—Ç–≤–æ–º'
                            },
                            {
                                id: 'node2-2',
                                title: '–ü—Ä–∏–≤–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤'
                            }
                        ]
                    }
                ]
            };
            console.log('–°–æ–∑–¥–∞–Ω–æ –¥–µ—Ä–µ–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–µ—Ä–µ–≤–∞
        function saveDIOTreeData() {
            try {
                localStorage.setItem('gko_dio_tree_v1', JSON.stringify(window.DIO_TREE_DATA));
                console.log('–î–∞–Ω–Ω—ã–µ –¥–µ—Ä–µ–≤–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                showDIOTreeNotification('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É–∑–ª–æ–≤
                updateDIOTreeNodeCount();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ GitHub
                updateCombinedDataOnGitHub();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', e);
                showDIOTreeNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ä–µ–≤–∞ –∏–∑ GitHub
        async function loadDIOTreeFromGitHub() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ä–µ–≤–∞ –î–ò–û –∏–∑ GitHub...');
                
                const response = await fetch(`${window.DIO_GITHUB_RAW_URL}gko_all_data.json`);
                if (!response.ok) {
                    console.log('–§–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ GitHub');
                    return;
                }
                
                const data = await response.json();
                if (data.dioTree) {
                    window.DIO_TREE_DATA = data.dioTree;
                    localStorage.setItem('gko_dio_tree_v1', JSON.stringify(window.DIO_TREE_DATA));
                    console.log('–î–µ—Ä–µ–≤–æ –î–ò–û –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ GitHub');
                    showDIOTreeNotification('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub', 'success');
                    renderDIOTree();
                }
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub:', error.message);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –Ω–∞ GitHub
        async function saveDIOTreeToGitHub(token) {
            if (!token) {
                showDIOTreeNotification('–í–≤–µ–¥–∏—Ç–µ GitHub Token', 'warning');
                return;
            }
            
            try {
                const allData = await loadCombinedDataFromGitHub();
                allData.dioTree = window.DIO_TREE_DATA;
                allData.exportDate = new Date().toISOString();
                allData.metadata.dioNodeCount = countDIOTreeNodes(window.DIO_TREE_DATA);
                
                const content = JSON.stringify(allData, null, 2);
                const apiUrl = `${window.DIO_GITHUB_API_URL}gko_all_data.json`;
                
                let sha = null;
                try {
                    const res = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    // –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                }
                
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –î–ò–û: ${new Date().toLocaleString('ru-RU')}`,
                        content: btoa(unescape(encodeURIComponent(content))),
                        sha: sha
                    })
                });
                
                if (response.ok) {
                    showDIOTreeNotification('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞ GitHub', 'success');
                    return true;
                } else {
                    const error = await response.json();
                    showDIOTreeNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                    return false;
                }
            } catch (error) {
                showDIOTreeNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                return false;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function loadCombinedDataFromGitHub() {
            try {
                const response = await fetch(`${window.DIO_GITHUB_RAW_URL}gko_all_data.json`);
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', error);
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            return {
                version: "1.0",
                exportDate: new Date().toISOString(),
                npas: [],
                dashboards: [],
                calculator: {},
                dioTree: window.DIO_TREE_DATA,
                metadata: {
                    npaCount: 0,
                    dashboardsCount: 0,
                    dioNodeCount: countDIOTreeNodes(window.DIO_TREE_DATA),
                    exportFormat: "combined"
                }
            };
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ GitHub
        async function updateCombinedDataOnGitHub() {
            const token = localStorage.getItem('github_token');
            if (!token) return;
            
            try {
                await saveDIOTreeToGitHub(token);
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ GitHub:', error);
            }
        }
        
        // –ü–æ–¥—Å—á–µ—Ç —É–∑–ª–æ–≤ –¥–µ—Ä–µ–≤–∞
        function countDIOTreeNodes(node) {
            let count = 1; // –¢–µ–∫—É—â–∏–π —É–∑–µ–ª
            if (node.children && node.children.length > 0) {
                node.children.forEach(child => {
                    count += countDIOTreeNodes(child);
                });
            }
            return count;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É–∑–ª–æ–≤
        function updateDIOTreeNodeCount() {
            const count = countDIOTreeNodes(window.DIO_TREE_DATA);
            const counter = document.getElementById('dioNodeCount');
            if (counter) {
                counter.textContent = `–£–∑–ª–æ–≤: ${count}`;
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showDIOTreeNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-emerald-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-amber-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-white/80">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ä–µ–≤–æ–º
        function setupDIOTreeControls() {
            // –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            document.getElementById('dioSaveBtn')?.addEventListener('click', saveDIOTreeData);
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub
            document.getElementById('dioLoadBtn')?.addEventListener('click', loadDIOTreeFromGitHub);
            
            // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ JSON
            document.getElementById('dioExportBtn')?.addEventListener('click', exportDIOTreeJSON);
            
            // –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ JSON
            document.getElementById('dioImportBtn')?.addEventListener('click', importDIOTreeJSON);
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞
            document.getElementById('dioAddRootBtn')?.addEventListener('click', addDIORootNode);
            
            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
            document.getElementById('dioThemeBtn')?.addEventListener('click', toggleDIOTreeTheme);
            
            // –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞
            document.getElementById('dioSearchInput')?.addEventListener('input', filterDIOTree);
            
            // –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('dioFilterSelect')?.addEventListener('change', filterDIOTree);
            
            // –ö–Ω–æ–ø–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å
            document.getElementById('dioExpandBtn')?.addEventListener('click', expandAllDIOTree);
            document.getElementById('dioCollapseBtn')?.addEventListener('click', collapseAllDIOTree);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            document.getElementById('dioInfoClose')?.addEventListener('click', closeDIOInfoPanel);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–æ–Ω—ã –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            setupDIODropZone();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
            setupDIOContextMenu();
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤–∞ –≤ JSON
        function exportDIOTreeJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(window.DIO_TREE_DATA, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = `dio_tree_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showDIOTreeNotification('–î–µ—Ä–µ–≤–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ JSON', 'success');
        }
        
        // –ò–º–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤–∞ –∏–∑ JSON
        function importDIOTreeJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ –î–ò–û? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
                            window.DIO_TREE_DATA = data;
                            saveDIOTreeData();
                            renderDIOTree();
                            showDIOTreeNotification('–î–µ—Ä–µ–≤–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                        }
                    } catch (error) {
                        showDIOTreeNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞
        function addDIORootNode() {
            const title = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞:');
            if (title && title.trim()) {
                if (!window.DIO_TREE_DATA.children) {
                    window.DIO_TREE_DATA.children = [];
                }
                
                const newNode = {
                    id: 'node_' + Date.now(),
                    title: title.trim(),
                    children: []
                };
                
                window.DIO_TREE_DATA.children.push(newNode);
                saveDIOTreeData();
                renderDIOTree();
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleDIOTreeTheme() {
            const body = document.body;
            if (window.DIO_THEME === 'light') {
                body.classList.add('dark-theme');
                window.DIO_THEME = 'dark';
                document.getElementById('dioThemeBtn').textContent = 'üåû –°–≤–µ—Ç–ª–∞—è';
            } else {
                body.classList.remove('dark-theme');
                window.DIO_THEME = 'light';
                document.getElementById('dioThemeBtn').textContent = 'üåì –¢–µ–º–∞';
            }
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞
        function filterDIOTree() {
            const searchTerm = document.getElementById('dioSearchInput').value.toLowerCase();
            const filterType = document.getElementById('dioFilterSelect').value;
            
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
            renderDIOTree();
        }
        
        // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —É–∑–ª—ã
        function expandAllDIOTree() {
            // –í –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —É–∑–ª—ã
            renderDIOTree();
        }
        
        // –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —É–∑–ª—ã
        function collapseAllDIOTree() {
            // –í –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã
            renderDIOTree(true);
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function closeDIOInfoPanel() {
            document.getElementById('dioInfoPanel').classList.remove('active');
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–æ–Ω—ã –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function setupDIODropZone() {
            const dropZone = document.getElementById('dioDropZone');
            if (!dropZone) return;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('active');
            }
            
            function unhighlight() {
                dropZone.classList.remove('active');
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type === 'application/json' || file.name.endsWith('.json')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const data = JSON.parse(e.target.result);
                                if (confirm('–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ä–µ–≤–æ –∏–∑ —Ñ–∞–π–ª–∞?')) {
                                    window.DIO_TREE_DATA = data;
                                    saveDIOTreeData();
                                    renderDIOTree();
                                    showDIOTreeNotification('–î–µ—Ä–µ–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ —Ñ–∞–π–ª–∞', 'success');
                                }
                            } catch (error) {
                                showDIOTreeNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                            }
                        };
                        reader.readAsText(file);
                    } else {
                        showDIOTreeNotification('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ JSON —Ñ–∞–π–ª—ã', 'warning');
                    }
                }
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function setupDIOContextMenu() {
            const contextMenu = document.getElementById('dioContextMenu');
            if (!contextMenu) return;
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', () => {
                contextMenu.classList.remove('active');
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –ø—É–Ω–∫—Ç–∞–º –º–µ–Ω—é
            contextMenu.querySelectorAll('.context-menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = item.dataset.action;
                    handleDIOContextMenuAction(action);
                    contextMenu.classList.remove('active');
                });
            });
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
            document.addEventListener('contextmenu', (e) => {
                if (e.target.closest('#dioTree')) {
                    e.preventDefault();
                    showDIOContextMenu(e);
                }
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        function showDIOContextMenu(e) {
            const contextMenu = document.getElementById('dioContextMenu');
            const nodeElement = e.target.closest('.tree-node');
            
            if (nodeElement) {
                window.DIO_CONTEXT_MENU_NODE = nodeElement;
                contextMenu.style.left = e.pageX + 'px';
                contextMenu.style.top = e.pageY + 'px';
                contextMenu.classList.add('active');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function handleDIOContextMenuAction(action) {
            if (!window.DIO_CONTEXT_MENU_NODE) return;
            
            const nodeId = window.DIO_CONTEXT_MENU_NODE.dataset.nodeId;
            const node = findDIOTreeNode(window.DIO_TREE_DATA, nodeId);
            
            if (!node) return;
            
            switch (action) {
                case 'addChild':
                    addDIOChildNode(node);
                    break;
                case 'edit':
                    editDIOTreeNode(node);
                    break;
                case 'delete':
                    deleteDIOTreeNode(node);
                    break;
                case 'duplicate':
                    duplicateDIOTreeNode(node);
                    break;
                case 'markImportant':
                    markDIOTreeNodeImportant(node);
                    break;
                case 'addNote':
                    addDIOTreeNodeNote(node);
                    break;
            }
        }
        
        // –ü–æ–∏—Å–∫ —É–∑–ª–∞ –ø–æ ID
        function findDIOTreeNode(root, id) {
            if (root.id === id) return root;
            if (root.children) {
                for (const child of root.children) {
                    const found = findDIOTreeNode(child, id);
                    if (found) return found;
                }
            }
            return null;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–µ–≥–æ —É–∑–ª–∞
        function addDIOChildNode(parentNode) {
            const title = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–µ–≥–æ —É–∑–ª–∞:');
            if (title && title.trim()) {
                if (!parentNode.children) {
                    parentNode.children = [];
                }
                
                const newNode = {
                    id: 'node_' + Date.now(),
                    title: title.trim()
                };
                
                parentNode.children.push(newNode);
                saveDIOTreeData();
                renderDIOTree();
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–ª–∞
        function editDIOTreeNode(node) {
            const title = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–∑–ª–∞:', node.title);
            if (title !== null) {
                node.title = title.trim();
                if (node.title) {
                    saveDIOTreeData();
                    renderDIOTree();
                }
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞
        function deleteDIOTreeNode(node) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É–∑–µ–ª?')) {
                if (node === window.DIO_TREE_DATA) {
                    // –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª
                    showDIOTreeNotification('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª', 'warning');
                    return;
                }
                
                // –ü–æ–∏—Å–∫ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—è
                removeDIOTreeNodeFromParent(window.DIO_TREE_DATA, node.id);
                saveDIOTreeData();
                renderDIOTree();
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—è
        function removeDIOTreeNodeFromParent(root, id) {
            if (root.children) {
                const index = root.children.findIndex(child => child.id === id);
                if (index > -1) {
                    root.children.splice(index, 1);
                    return true;
                }
                
                for (const child of root.children) {
                    if (removeDIOTreeNodeFromParent(child, id)) {
                        return true;
                    }
                }
            }
            return false;
        }
        
        // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–ª–∞
        function duplicateDIOTreeNode(node) {
            const duplicate = JSON.parse(JSON.stringify(node));
            duplicate.id = 'node_' + Date.now();
            duplicate.title = node.title + ' (–∫–æ–ø–∏—è)';
            
            // –ü–æ–∏—Å–∫ —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞
            const parent = findDIOTreeNodeParent(window.DIO_TREE_DATA, node.id);
            if (parent) {
                if (!parent.children) parent.children = [];
                parent.children.push(duplicate);
                saveDIOTreeData();
                renderDIOTree();
            }
        }
        
        // –ü–æ–∏—Å–∫ —Ä–æ–¥–∏—Ç–µ–ª—è —É–∑–ª–∞
        function findDIOTreeNodeParent(root, id) {
            if (root.children) {
                for (const child of root.children) {
                    if (child.id === id) {
                        return root;
                    }
                    const found = findDIOTreeNodeParent(child, id);
                    if (found) return found;
                }
            }
            return null;
        }
        
        // –û—Ç–º–µ—Ç–∏—Ç—å —É–∑–µ–ª –∫–∞–∫ –≤–∞–∂–Ω—ã–π
        function markDIOTreeNodeImportant(node) {
            if (!node.tags) node.tags = [];
            if (!node.tags.includes('–≤–∞–∂–Ω–æ')) {
                node.tags.push('–≤–∞–∂–Ω–æ');
                saveDIOTreeData();
                renderDIOTree();
                showDIOTreeNotification('–£–∑–µ–ª –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –≤–∞–∂–Ω—ã–π', 'success');
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –∫ —É–∑–ª—É
        function addDIOTreeNodeNote(node) {
            const note = prompt('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ:');
            if (note && note.trim()) {
                if (!node.description) node.description = '';
                node.description += (node.description ? '\n' : '') + note.trim();
                saveDIOTreeData();
                renderDIOTree();
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–µ—Ä–µ–≤–∞
        function renderDIOTree(collapsed = false) {
            const treeContainer = document.getElementById('dioTree');
            if (!treeContainer) return;
            
            treeContainer.innerHTML = '';
            
            if (!window.DIO_TREE_DATA) {
                treeContainer.innerHTML = '<div class="error-message">–î–∞–Ω–Ω—ã–µ –¥–µ—Ä–µ–≤–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</div>';
                return;
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª –∏ –µ–≥–æ –¥–µ—Ç–µ–π
            renderDIOTreeNode(window.DIO_TREE_DATA, treeContainer, 0, collapsed);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            initDIOTreeSortable();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —É–∑–ª–æ–≤
            updateDIOTreeNodeCount();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É–∑–ª–∞ –¥–µ—Ä–µ–≤–∞
        function renderDIOTreeNode(node, container, depth = 0, collapsed = false) {
            const nodeElement = document.createElement('div');
            nodeElement.className = 'tree-node-wrapper';
            nodeElement.dataset.nodeId = node.id;
            
            const nodeDiv = document.createElement('div');
            nodeDiv.className = 'tree-node';
            nodeDiv.dataset.nodeId = node.id;
            
            // –û—Ç—Å—Ç—É–ø –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≥–ª—É–±–∏–Ω—ã
            nodeDiv.style.paddingLeft = (depth * 20) + 'px';
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–∑–ª–∞
            const headerDiv = document.createElement('div');
            headerDiv.className = 'node-header';
            
            // –ö–Ω–æ–ø–∫–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å –¥–ª—è —É–∑–ª–æ–≤ —Å –¥–µ—Ç—å–º–∏
            if (node.children && node.children.length > 0) {
                const toggleBtn = document.createElement('div');
                toggleBtn.className = 'node-toggle';
                toggleBtn.innerHTML = collapsed ? '‚ñ∂' : '‚ñº';
                toggleBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleDIOTreeNode(node.id);
                };
                headerDiv.appendChild(toggleBtn);
            } else {
                // –ó–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
                const spacer = document.createElement('div');
                spacer.className = 'node-toggle';
                spacer.style.visibility = 'hidden';
                headerDiv.appendChild(spacer);
            }
            
            // –ù–∞–∑–≤–∞–Ω–∏–µ —É–∑–ª–∞
            const titleSpan = document.createElement('span');
            titleSpan.className = 'node-title';
            titleSpan.textContent = node.title;
            titleSpan.onclick = () => selectDIOTreeNode(node);
            headerDiv.appendChild(titleSpan);
            
            // –ë–µ–π–¥–∂–∏–∫–∏ (—Ç–µ–≥–∏)
            if (node.tags && node.tags.length > 0) {
                const badgesDiv = document.createElement('div');
                badgesDiv.className = 'node-badges';
                
                node.tags.forEach(tag => {
                    const badge = document.createElement('span');
                    badge.className = 'node-badge ' + 
                        (tag === '–≤–∞–∂–Ω–æ' ? 'important' : 
                         tag === '–≤–Ω–∏–º–∞–Ω–∏–µ' ? 'warning' : 
                         tag === '–∑–∞–≤–µ—Ä—à–µ–Ω–æ' ? 'success' : '');
                    badge.textContent = tag;
                    badgesDiv.appendChild(badge);
                });
                
                headerDiv.appendChild(badgesDiv);
            }
            
            nodeDiv.appendChild(headerDiv);
            nodeElement.appendChild(nodeDiv);
            container.appendChild(nodeElement);
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –¥–µ—Ç–µ–π, –µ—Å–ª–∏ –Ω–µ —Å–≤–µ—Ä–Ω—É—Ç–æ
            if (node.children && node.children.length > 0 && !collapsed) {
                const childrenContainer = document.createElement('div');
                childrenContainer.className = 'tree-children';
                childrenContainer.dataset.parentId = node.id;
                
                node.children.forEach(child => {
                    renderDIOTreeNode(child, childrenContainer, depth + 1, collapsed);
                });
                
                nodeElement.appendChild(childrenContainer);
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —É–∑–ª–∞ (—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å)
        function toggleDIOTreeNode(nodeId) {
            // –í –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤—Å–µ –¥–µ—Ä–µ–≤–æ
            renderDIOTree();
        }
        
        // –í—ã–±–æ—Ä —É–∑–ª–∞
        function selectDIOTreeNode(node) {
            window.DIO_SELECTED_NODE = node;
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —É–∑–ª–æ–≤
            document.querySelectorAll('.tree-node').forEach(el => {
                el.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É–∑–µ–ª
            const nodeElement = document.querySelector(`[data-node-id="${node.id}"] .tree-node`);
            if (nodeElement) {
                nodeElement.classList.add('selected');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É–∑–ª–µ
            showDIOInfoPanel(node);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function showDIOInfoPanel(node) {
            const infoPanel = document.getElementById('dioInfoPanel');
            const infoContent = document.getElementById('dioInfoContent');
            
            if (!infoPanel || !infoContent) return;
            
            let html = `<h4 class="font-bold mb-2">${node.title}</h4>`;
            
            if (node.description) {
                html += `<p class="mb-2">${node.description}</p>`;
            }
            
            if (node.tags && node.tags.length > 0) {
                html += `<div class="mb-2"><strong>–¢–µ–≥–∏:</strong> ${node.tags.join(', ')}</div>`;
            }
            
            html += `<div class="text-sm text-gray-500 mt-2">ID: ${node.id}</div>`;
            
            infoContent.innerHTML = html;
            infoPanel.classList.add('active');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function initDIOTreeSortable() {
            const treeContainer = document.getElementById('dioTree');
            if (!treeContainer) return;
            
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Sortable.js
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            initDIOTree();
        });
    </script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script type="text/babel">
        // React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞)
        const { useState, useEffect, useRef, useMemo } = React;
        
        // –ò–∫–æ–Ω–∫–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        const IconCalculator = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconDatabase = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>;
        const IconMap = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>;
        const IconFileText = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>;
        const IconShieldCheck = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="m9 12 2 2 4-4"/></svg>;
        const IconBookOpen = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const IconRotateCcw = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const IconCoins = ({size=16, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="M17.12 12.23A6 6 0 0 1 5 13.5"/></svg>;
        const IconChevronDown = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>;
        const IconChevronUp = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>;
        const IconAlertCircle = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
        const IconDownload = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const IconUpload = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const IconCalendar = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const IconCopy = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl border border-slate-200 shadow-sm ${className}`}>
                {children}
            </div>
        );
        
        const ResultBreakdown = ({ items, total }) => {
            const [isOpen, setIsOpen] = useState(true);
            return (
                <div className="mt-6 border border-blue-100 rounded-lg overflow-hidden no-print">
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 transition-colors"
                    >
                        <div className="flex items-center gap-2 font-semibold text-blue-900 text-sm">
                            <IconCalculator size={16} />
                            <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <span className="font-bold text-blue-700">{total.toFixed(2)}%</span>
                            {isOpen ? <IconChevronUp size={16} /> : <IconChevronDown size={16} />}
                        </div>
                    </button>
                    {isOpen && (
                        <div className="p-3 bg-white space-y-2">
                        {items.map((item, idx) => (
                            <div key={idx} className="flex justify-between items-center py-2 border-b border-slate-100 last:border-0">
                                <div className="pr-4">
                                    <div className="text-sm font-medium text-slate-700">{item.label}</div>
                                    <div className="text-xs text-slate-500">{item.desc}</div>
                                </div>
                                <div className={`text-sm font-bold font-mono px-2 py-1 rounded ${
                                    item.value >= 80 ? 'bg-green-100 text-green-700' : 
                                    item.value >= 50 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'
                                }`}>
                                    {item.value.toFixed(2)}%
                                </div>
                            </div>
                        ))}
                        </div>
                    )}
                </div>
            );
        };
        
        const CalculatorInputGroup = ({ label, value, onChange, placeholder, hint }) => {
            const [localValue, setLocalValue] = useState(value === 0 ? '' : value.toString());

            useEffect(() => {
                const currentNumeric = localValue === '' ? 0 : parseFloat(localValue.replace(',', '.'));
                
                if (currentNumeric !== value) {
                    setLocalValue(value === 0 ? '' : value.toString());
                }
            }, [value]);

            const handleChange = (e) => {
                const input = e.target.value;
                if (/^[0-9.,-]*$/.test(input)) {
                    setLocalValue(input);
                    const normalized = input.replace(/,/g, '.');
                    const parsed = parseFloat(normalized);
                    if (!isNaN(parsed)) onChange(parsed); else onChange(0);
                }
            };

            return (
                <div className="mb-4 break-inside-avoid">
                    <label className="block text-sm font-medium text-slate-700 mb-1">{label}</label>
                    <div className="relative">
                        <input
                            type="text"
                            inputMode="decimal"
                            value={localValue}
                            onChange={handleChange}
                            className="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:outline-none focus:border-blue-500 transition-colors calculator-input"
                            placeholder="" 
                        />
                        {hint && (
                            <div className="mt-1 text-xs text-slate-400 flex items-center gap-1 no-print">
                                <IconAlertCircle size={12} /> {hint}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        function EfficiencyCalculator() {
            const [activeCalcTab, setActiveCalcTab] = useState(0);
            const [moneyUnit, setMoneyUnit] = useState('rub'); 
            const [period, setPeriod] = useState('2025_year');
            const [calculatorData, setCalculatorData] = useState({});
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                console.log('üîç –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è...');
                
                try {
                    const savedDataStr = localStorage.getItem('gko_calculator_data_v1');
                    console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ localStorage (—Å—ã—Ä—ã–µ):', savedDataStr);
                    
                    if (savedDataStr) {
                        const savedData = JSON.parse(savedDataStr);
                        console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ localStorage (–ø–∞—Ä—Å–∏–Ω–≥):', savedData);

                        if (savedData && typeof savedData === 'object') {
                            const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                            const initialDataModel = {
                                ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                                ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                                k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                                s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                                k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                                k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                            };
                            const newData = {};
                            periodsList.forEach(p => {
                                if (savedData[p]) {
                                    newData[p] = { ...initialDataModel, ...savedData[p] };
                                } else {
                                    newData[p] = { ...initialDataModel };
                                }
                            });
                            
                            console.log('–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', newData);
                            setCalculatorData(newData);
                        } else {
                            console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É—é –Ω–∞—á–∞–ª—å–Ω—ã–µ');
                            const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                            const initialDataModel = {
                                ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                                ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                                k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                                s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                                k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                                k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                            };
                            
                            const initialDb = {};
                            periodsList.forEach(p => initialDb[p] = { ...initialDataModel });
                            setCalculatorData(initialDb);
                        }
                    } else {
                        console.log('localStorage –ø—É—Å—Ç –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞');
                        const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                        const initialDataModel = {
                            ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                            ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                            k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                            s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                            k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                            k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                        };
                        
                        const initialDb = {};
                        periodsList.forEach(p => initialDb[p] = { ...initialDataModel });
                        setCalculatorData(initialDb);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞:', error);
                    const periodsList = ['2025_year', '2026_1_kv', '2026_2_kv', '2026_3_kv', '2026_4_kv'];
                    const initialDataModel = {
                        ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                        ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                        k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                        s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                        k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                        k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                    };
                    
                    const initialDb = {};
                    periodsList.forEach(p => initialDb[p] = { ...initialDataModel });
                    setCalculatorData(initialDb);
                } finally {
                    setIsLoading(false);
                }
            }, []);

            const moneyLabels = {
                'rub': '—Ä—É–±.', 'thous': '—Ç—ã—Å. —Ä—É–±.', 'mln': '–º–ª–Ω —Ä—É–±.', 'bln': '–º–ª—Ä–¥ —Ä—É–±.', 'trln': '—Ç—Ä–ª–Ω —Ä—É–±.'
            };

            const periodsList = [
                { id: '2025_year', label: '2025 –≥–æ–¥' },
                { id: '2026_1_kv', label: '2026 - 1 –∫–≤–∞—Ä—Ç–∞–ª' },
                { id: '2026_2_kv', label: '2026 - 2 –∫–≤–∞—Ä—Ç–∞–ª' },
                { id: '2026_3_kv', label: '2026 - 3 –∫–≤–∞—Ä—Ç–∞–ª' },
                { id: '2026_4_kv', label: '2026 - 4 –∫–≤–∞—Ä—Ç–∞–ª' },
            ];

            const initialDataModel = {
                ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
            };
            
            const currentData = calculatorData[period] || { ...initialDataModel };
            
            const updateCalcData = (field, value) => {
                console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: ${field} = ${value}`);
                
                const updatedData = {
                    ...calculatorData,
                    [period]: {
                        ...(calculatorData[period] || {}),
                        [field]: value
                    }
                };
                
                console.log('–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', updatedData);
                setCalculatorData(updatedData);
                localStorage.setItem('gko_calculator_data_v1', JSON.stringify(updatedData));
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage');
            };

            const copyFromPreviousPeriod = () => {
                const currentIndex = periodsList.findIndex(p => p.id === period);
                if (currentIndex > 0) {
                    const prevPeriodId = periodsList[currentIndex - 1].id;
                    const prevData = calculatorData[prevPeriodId];
                    
                    if (confirm(`–í—Å—Ç–∞–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ "${periodsList[currentIndex - 1].label}" –≤ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥? –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.`)) {
                        const updatedData = {
                            ...calculatorData,
                            [period]: prevData ? { ...prevData } : { ...initialDataModel }
                        };
                        
                        setCalculatorData(updatedData);
                        localStorage.setItem('gko_calculator_data_v1', JSON.stringify(updatedData));
                    }
                } else {
                    alert("–≠—Ç–æ –ø–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥, –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏.");
                }
            };
            
            const calculateResults = (data) => {
                const calcPerc = (num, den) => {
                    if (den === 0) return 0;
                    let val = (num / den) * 100;
                    return Math.min(100, Math.max(0, val));
                };
                
                let sub1_1 = calcPerc(data.ks_otch, data.ks_cel);
                const k_changes = data.k_21 + (data.k_22 + data.k_22_1) + data.k_sud;
                const sub1_2 = (data.k_on_obsh > 0) ? Math.min(100, Math.max(0, (1 - (k_changes / data.k_on_obsh)) * 100)) : 0;
                const ks_changes = data.ks_21 + (data.ks_22 + data.ks_22_1) + data.ks_sud;
                const sub1_3 = (data.ks_on_obsh > 0) ? Math.min(100, Math.max(0, (1 - (ks_changes / data.ks_on_obsh)) * 100)) : 0;
                const ind1 = (sub1_1 + sub1_2 + sub1_3) / 3;
                const bad_net = Math.max(0, data.k_bezrp - data.k_mkd - data.k_vyyavl);
                const sub2_1 = (data.k_on_obsh_reestr > 0) ? Math.min(100, Math.max(0, (1 - (bad_net / data.k_on_obsh_reestr)) * 100)) : 0;
                const sub2_2 = (data.k_on_obsh_reestr > 0) ? Math.min(100, Math.max(0, (1 - (data.k_nkor / data.k_on_obsh_reestr)) * 100)) : 0;
                const ind2 = (sub2_1 + sub2_2) / 2;
                let sub3_1 = calcPerc(data.s_vyyavl, data.s_ter);
                const sub3_2 = calcPerc(data.s_vuf, data.s_gosmun);
                const ind3 = (sub3_1 + sub3_2) / 2;
                let sub4_1 = calcPerc(data.k_ps, data.k_pdpr);
                const sub4_2 = calcPerc(data.k_reg, data.k_obsh_reg);
                const ind4 = (sub4_1 + sub4_2) / 2;
                const violations_total = data.k_vknm_gzn + data.k_vknm_mzk;
                const checks_total = data.k_pknm_gzn + data.k_pknm_mzk;
                const fixed_total = data.k_uknm_gzn + data.k_uknm_mzk;
                const sub5_1 = calcPerc(violations_total, checks_total); 
                const sub5_2 = calcPerc(fixed_total, violations_total);
                const ind5 = (sub5_1 + sub5_2) / 2;
                const total = (ind1 * 0.25) + (ind2 * 0.25) + (ind3 * 0.25) + (ind4 * 0.125) + (ind5 * 0.125);

                return { ind1, ind2, ind3, ind4, ind5, total, sub1_1, sub1_2, sub1_3, sub2_1, sub2_2, sub3_1, sub3_2, sub4_1, sub4_2, sub5_1, sub5_2 };
            };

            const results = useMemo(() => calculateResults(currentData), [currentData]);

            const resetCurrentCalcPeriod = () => {
                if (!confirm(`–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∞ "${periodsList.find(p => p.id === period)?.label}"?`)) {
                    return;
                }
                
                const emptyData = {
                    ks_otch: 0, ks_cel: 0, k_on_obsh: 0, k_21: 0, k_22: 0, k_22_1: 0, k_sud: 0, 
                    ks_on_obsh: 0, ks_21: 0, ks_22: 0, ks_22_1: 0, ks_sud: 0,
                    k_bezrp: 0, k_mkd: 0, k_vyyavl: 0, k_on_obsh_reestr: 0, k_nkor: 0,
                    s_vyyavl: 0, s_ter: 0, s_vuf: 0, s_gosmun: 0,
                    k_ps: 0, k_pdpr: 0, k_reg: 0, k_obsh_reg: 0,
                    k_vknm_gzn: 0, k_vknm_mzk: 0, k_pknm_gzn: 0, k_pknm_mzk: 0, k_uknm_gzn: 0, k_uknm_mzk: 0,
                };
                
                const updatedData = {
                    ...calculatorData,
                    [period]: emptyData
                };
                
                setCalculatorData(updatedData);
                localStorage.setItem('gko_calculator_data_v1', JSON.stringify(updatedData));
                
                showNotification(`–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –æ—á–∏—â–µ–Ω—ã`, 'success');
            };
            
            const sections = [
                { title: "–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞", short: "–ö–∞–¥–∞—Å—Ç—Ä", icon: IconCalculator, weight: "25%", color: "text-blue-600", bg: "bg-blue-100", numWeight: 0.25 },
                { title: "–†–µ–µ—Å—Ç—Ä –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", short: "–†–µ–µ—Å—Ç—Ä", icon: IconDatabase, weight: "25%", color: "text-indigo-600", bg: "bg-indigo-100", numWeight: 0.25 },
                { title: "–í–æ–≤–ª–µ—á–µ–Ω–∏–µ –∑–µ–º–µ–ª—å", short: "–ó–µ–º–ª—è", icon: IconMap, weight: "25%", color: "text-green-600", bg: "bg-green-100", numWeight: 0.25 },
                { title: "–§–ì–ò–° –ï–¶–ü –ù–°–ü–î", short: "–ù–°–ü–î", icon: IconFileText, weight: "12.5%", color: "text-purple-600", bg: "bg-purple-100", numWeight: 0.125 },
                { title: "–ó–µ–º–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å", short: "–ö–æ–Ω—Ç—Ä–æ–ª—å", icon: IconShieldCheck, weight: "12.5%", color: "text-red-600", bg: "bg-red-100", numWeight: 0.125 },
                { title: "–ú–µ—Ç–æ–¥–∏–∫–∞", short: "–ò–Ω—Ñ–æ", icon: IconBookOpen, weight: "–ò–Ω—Ñ–æ", color: "text-slate-600", bg: "bg-slate-100", numWeight: 0 },
            ];

            const finalResultsArray = [
                { section: sections[0], val: results.ind1 },
                { section: sections[1], val: results.ind2 },
                { section: sections[2], val: results.ind3 },
                { section: sections[3], val: results.ind4 },
                { section: sections[4], val: results.ind5 },
            ];

            return (
                <div className="max-w-7xl mx-auto p-2 md:p-6">
                    <header className="mb-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col xl:flex-row justify-between items-center gap-4 no-print">
                        <div>
                            <h1 className="text-xl font-bold text-slate-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h1>
                            <p className="text-slate-500 text-sm">–ù–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º (–ö–≤–∞—Ä—Ç–∞–ª / –ì–æ–¥)</p>
                        </div>
                        <div className="flex flex-wrap gap-2 items-center justify-center">
                            <div className="flex items-center bg-slate-50 border border-slate-300 rounded-lg p-1">
                                <div className="pl-2 pr-1 text-slate-500"><IconCalendar size={16} /></div>
                                <select value={period} onChange={(e) => setPeriod(e.target.value)} className="bg-transparent text-sm focus:outline-none p-1 cursor-pointer font-medium text-slate-700 min-w-[140px]">
                                    {periodsList.map(p => <option key={p.id} value={p.id}>{p.label}</option>)}
                                </select>
                            </div>
                            <button onClick={copyFromPreviousPeriod} className="flex items-center gap-1 px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-blue-50 hover:text-blue-600 text-xs font-medium transition-colors border border-slate-200" title="–í–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∫–∞–∫ –æ—Å–Ω–æ–≤—É">
                                <IconCopy size={14} /> <span className="hidden sm:inline">–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –ø—Ä–µ–¥. –ø–µ—Ä–∏–æ–¥–∞</span>
                            </button>
                            <div className="w-px h-6 bg-slate-300 mx-2 hidden xl:block"></div>
                            <button onClick={resetCurrentCalcPeriod} className="px-3 py-2 bg-red-50 text-red-600 rounded-lg border border-red-100 hover:bg-red-100 transition-colors">
                                <IconRotateCcw size={16} />
                            </button>
                        </div>
                    </header>
                    
                    <div className="print-only mb-8">
                        <h1 className="text-3xl font-bold">–û—Ç—á–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≠–∫–∞–ø)</h1>
                        <p className="text-xl mt-2">–ü–µ—Ä–∏–æ–¥: <b>{periodsList.find(p=>p.id===period)?.label}</b></p>
                        <p className="text-sm text-slate-500">–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: {new Date().toLocaleDateString()}</p>
                    </div>

                    <div className="grid grid-cols-1 xl:grid-cols-4 gap-6">
                        <div className="xl:col-span-3 space-y-4">
                            <div className="flex overflow-x-auto gap-2 pb-1 no-scrollbar no-print">
                                {sections.map((s, idx) => (
                                    <button key={idx} onClick={() => setActiveCalcTab(idx)} className={`flex items-center gap-2 px-3 py-2 rounded-lg whitespace-nowrap text-sm font-medium transition-colors ${activeCalcTab === idx ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`}>
                                        <s.icon size={16} /> <span>{s.short}</span>
                                    </button>
                                ))}
                            </div>

                            <Card className="p-5 print:shadow-none print:border-none print:p-0">
                                {activeCalcTab !== 5 && (
                                    <div className="flex flex-wrap items-center justify-between border-b pb-3 mb-4 gap-2 no-print">
                                        <h2 className="text-lg font-bold flex items-center gap-2 text-slate-800">
                                            {React.createElement(sections[activeCalcTab].icon, { className: "text-slate-400" })}
                                            {sections[activeCalcTab].title} 
                                            <span className="text-xs bg-slate-100 px-2 py-1 rounded text-slate-500 font-normal">–í–µ—Å: {sections[activeCalcTab].weight}</span>
                                        </h2>
                                        {activeCalcTab === 0 && (
                                            <div className="flex bg-slate-100 p-1 rounded">
                                                <IconCoins size={14} className="mx-2 text-slate-400 mt-1"/>
                                                {['rub', 'mln', 'bln', 'trln'].map((unit) => (
                                                <button key={unit} onClick={() => setMoneyUnit(unit)} className={`px-2 py-0.5 text-xs font-medium rounded transition-colors ${moneyUnit === unit ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                                    {unit === 'rub' ? '–†—É–±' : unit === 'mln' ? '–ú–ª–Ω' : unit === 'bln' ? '–ú–ª—Ä–¥' : '–¢—Ä–ª–Ω'}
                                                </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ */}
                                {activeCalcTab === 0 && (
                                    <>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            <div className="bg-slate-50 p-3 rounded border border-slate-100 print:bg-white print:border-slate-300">
                                                <h3 className="font-semibold text-slate-900 text-sm mb-3">5.1. –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—É–º–º–∞—Ä–Ω–æ–π –ö–° (–ò_—Å—É–º)</h3>
                                                <CalculatorInputGroup label={`–ö–°_–æ—Ç—á - –¢–µ–∫—É—â–∞—è (${moneyLabels[moneyUnit]})`} value={currentData.ks_otch} onChange={(v) => updateCalcData('ks_otch', v)} />
                                                <CalculatorInputGroup label={`–ö–°_—Ü–µ–ª - –¶–µ–ª–µ–≤–∞—è 2030 (${moneyLabels[moneyUnit]})`} value={currentData.ks_cel} onChange={(v) => updateCalcData('ks_cel', v)} />
                                            </div>
                                            <div className="bg-slate-50 p-3 rounded border border-slate-100 print:bg-white print:border-slate-300">
                                                <h3 className="font-semibold text-slate-900 text-sm mb-3">5.2 & 5.3 –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è</h3>
                                                <CalculatorInputGroup label="–ö_–æ–Ω.–æ–±—â - –í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ö–° (—à—Ç)" value={currentData.k_on_obsh} onChange={(v) => updateCalcData('k_on_obsh', v)} />
                                                <CalculatorInputGroup label={`–ö–°_–æ–±—â - –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (${moneyLabels[moneyUnit]})`} value={currentData.ks_on_obsh} onChange={(v) => updateCalcData('ks_on_obsh', v)} />
                                            </div>
                                            <div className="bg-orange-50 p-3 rounded md:col-span-2 border border-orange-100 print:bg-white print:border-slate-300">
                                                <h3 className="text-sm font-bold text-orange-800 mb-3">–û–±—ä–µ–∫—Ç—ã —Å –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–π –ö–° (–¥–ª—è –ò_–∏–∑–º.–∫ –∏ –ò_–∏–∑–º.–∫—Å)</h3>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div><CalculatorInputGroup label="–ö21 - –°—Ç. 21 (—à—Ç)" value={currentData.k_21} onChange={(v) => updateCalcData('k_21', v)} /><CalculatorInputGroup label={`–ö–°21 - –°—Ç. 21 (${moneyLabels[moneyUnit]})`} value={currentData.ks_21} onChange={(v) => updateCalcData('ks_21', v)} /></div>
                                                    <div><CalculatorInputGroup label="–ö22 - –°—Ç. 22 –∏ 22.1 (—à—Ç)" value={currentData.k_22} onChange={(v) => updateCalcData('k_22', v)} /><CalculatorInputGroup label={`–ö–°22 - –°—Ç. 22 –∏ 22.1 (${moneyLabels[moneyUnit]})`} value={currentData.ks_22} onChange={(v) => updateCalcData('ks_22', v)} /></div>
                                                    <div><CalculatorInputGroup label="–ö22.1 - –°—Ç. 22.1 (–¥–æ–ø., —à—Ç)" value={currentData.k_22_1} onChange={(v) => updateCalcData('k_22_1', v)} /><CalculatorInputGroup label={`–ö–°22.1 - –°—Ç. 22.1 (–¥–æ–ø., ${moneyLabels[moneyUnit]})`} value={currentData.ks_22_1} onChange={(v) => updateCalcData('ks_22_1', v)} /></div>
                                                    <div><CalculatorInputGroup label="–ö—Å—É–¥ - –°—É–¥ (—à—Ç)" value={currentData.k_sud} onChange={(v) => updateCalcData('k_sud', v)} /><CalculatorInputGroup label={`–ö–°—Å—É–¥ - –°—É–¥ (${moneyLabels[moneyUnit]})`} value={currentData.ks_sud} onChange={(v) => updateCalcData('ks_sud', v)} /></div>
                                                </div>
                                            </div>
                                        </div>
                                        <ResultBreakdown total={results.ind1} items={[{ label: "5.1 –ò_—Å—É–º", desc: "–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏ 2030", value: results.sub1_1 }, { label: "5.2 –ò_–∏–∑–º.–∫", desc: "–°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª-–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π", value: results.sub1_2 }, { label: "5.3 –ò_–∏–∑–º.–∫—Å", desc: "–°–Ω–∏–∂–µ–Ω–∏–µ —Å—É–º–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π", value: results.sub1_3 }]} />
                                    </>
                                )}
                                
                                {/* –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ */}
                                {activeCalcTab === 1 && (
                                    <>
                                        <div className="space-y-4">
                                            <CalculatorInputGroup label="–ö_–æ–Ω.–æ–±—â - –í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ï–ì–†–ù" value={currentData.k_on_obsh_reestr} onChange={(v) => updateCalcData('k_on_obsh_reestr', v)} />
                                            <div className="bg-slate-50 p-3 rounded border border-slate-100 grid md:grid-cols-3 gap-2 print:bg-white print:border-slate-300">
                                                <CalculatorInputGroup label="–ö–±–µ–∑—Ä–ø - –ü—Ä–∞–≤–∞ –Ω–µ –∑–∞—Ä–µ–≥." value={currentData.k_bezrp} onChange={(v) => updateCalcData('k_bezrp', v)} />
                                                <CalculatorInputGroup label="–ö–º–∫–¥ - –ú–ö–î (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ)" value={currentData.k_mkd} onChange={(v) => updateCalcData('k_mkd', v)} />
                                                <CalculatorInputGroup label="–ö–≤—ã—è–≤–ª - –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ (–∏—Å–∫–ª)" value={currentData.k_vyyavl} onChange={(v) => updateCalcData('k_vyyavl', v)} />
                                            </div>
                                            <CalculatorInputGroup label="–ö_–Ω–∫–æ—Ä - –ë–µ–∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫" value={currentData.k_nkor} onChange={(v) => updateCalcData('k_nkor', v)} hint="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏" />
                                        </div>
                                        <ResultBreakdown total={results.ind2} items={[{ label: "6.1 –ò_–æ–Ω", desc: "–î–æ–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø—Ä–∞–≤–∞–º–∏", value: results.sub2_1 }, { label: "6.2 –ò_–∫–∞—á", desc: "–ö–∞—á–µ—Å—Ç–≤–æ —Å–≤–µ–¥–µ–Ω–∏–π –ï–ì–†–ù", value: results.sub2_2 }]} />
                                    </>
                                )}
                                
                                {activeCalcTab === 2 && (
                                    <>
                                        <div className="space-y-4">
                                            <div className="bg-green-50 p-3 rounded border border-green-100 print:bg-white print:border-slate-300">
                                                <h3 className="font-semibold text-green-900 mb-2 text-sm">7.1. –î–æ–ª—è –≤—ã—è–≤–ª–µ–Ω–Ω–æ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–ò_–≤—ã—è–≤–ª)</h3>
                                                <CalculatorInputGroup label="S_–≤—ã—è–≤–ª - –ü–ª–æ—â–∞–¥—å –≤—ã—è–≤–ª–µ–Ω–Ω–∞—è (–≥–∞)" value={currentData.s_vyyavl} onChange={(v) => updateCalcData('s_vyyavl', v)} />
                                                <CalculatorInputGroup label="S_—Ç–µ—Ä - –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–≥–∞)" value={currentData.s_ter} onChange={(v) => updateCalcData('s_ter', v)} />
                                            </div>
                                            <div className="bg-green-50 p-3 rounded border border-green-100 print:bg-white print:border-slate-300">
                                                <h3 className="font-semibold text-green-900 mb-2 text-sm">7.2. –í–æ–≤–ª–µ—á–µ–Ω–∏–µ –≤ –æ–±–æ—Ä–æ—Ç (–ò_–æ–±–æ—Ä–æ—Ç)</h3>
                                                <CalculatorInputGroup label="S_–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª - –ü–ª–æ—â–∞–¥—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–∞—è/—Å–¥–µ–ª–∫–∏ (–≥–∞)" value={currentData.s_vuf} onChange={(v) => updateCalcData('s_vuf', v)} />
                                                <CalculatorInputGroup label="S_–≥–æ—Å–º—É–Ω - –í—Å–µ–≥–æ –≥–æ—Å. –∏ –º—É–Ω. –∑–µ–º–µ–ª—å (–≥–∞)" value={currentData.s_gosmun} onChange={(v) => updateCalcData('s_gosmun', v)} />
                                            </div>
                                        </div>
                                        <ResultBreakdown total={results.ind3} items={[{ label: "7.1 –ò_–≤—ã—è–≤–ª", desc: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—ã—è–≤–ª–µ–Ω–∏—è", value: results.sub3_1 }, { label: "7.2 –ò_–æ–±–æ—Ä–æ—Ç", desc: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–æ–≤–ª–µ—á–µ–Ω–∏—è", value: results.sub3_2 }]} />
                                    </>
                                )}
                                
                                {activeCalcTab === 3 && (
                                    <>
                                        <div className="space-y-4">
                                            <div className="bg-purple-50 p-3 rounded border border-purple-100 print:bg-white print:border-slate-300">
                                                <h3 className="font-semibold text-purple-900 mb-2 text-sm">8.1. –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ò_–ø–¥)</h3>
                                                <CalculatorInputGroup label="–ö_–ø—Å - –ü–µ—Ä–µ–¥–∞–Ω–æ —Å–ª–æ–µ–≤" value={currentData.k_ps} onChange={(v) => updateCalcData('k_ps', v)} />
                                                <CalculatorInputGroup label="–ö_–ø–¥–ø—Ä - –ü–ª–∞–Ω –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É" value={currentData.k_pdpr} onChange={(v) => updateCalcData('k_pdpr', v)} />
                                            </div>
                                            <div className="bg-purple-50 p-3 rounded border border-purple-100 print:bg-white print:border-slate-300">
                                                <h3 className="font-semibold text-purple-900 mb-2 text-sm">8.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ù–°–ü–î –≤ —É—Å–ª—É–≥–∞—Ö (–ò_—É—Å–ª)</h3>
                                                <CalculatorInputGroup label="–ö_—Ä–µ–≥ - –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã —Å –ù–°–ü–î" value={currentData.k_reg} onChange={(v) => updateCalcData('k_reg', v)} />
                                                <CalculatorInputGroup label="–ö_–æ–±—â - –í—Å–µ–≥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–æ–≤" value={currentData.k_obsh_reg} onChange={(v) => updateCalcData('k_obsh_reg', v)} />
                                            </div>
                                        </div>
                                        <ResultBreakdown total={results.ind4} items={[{ label: "8.1 –ò_–ø–¥", desc: "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞", value: results.sub4_1 }, { label: "8.2 –ò_—É—Å–ª", desc: "–¶–∏—Ñ—Ä–æ–≤—ã–µ —É—Å–ª—É–≥–∏", value: results.sub4_2 }]} />
                                    </>
                                )}
                                
                                {activeCalcTab === 4 && (
                                    <>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            <div className="bg-red-50 p-3 rounded border border-red-100 print:bg-white print:border-slate-300">
                                                <h3 className="text-red-900 font-bold text-sm mb-2">–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π (–ì–ó–ù)</h3>
                                                <CalculatorInputGroup label="–ö–≤–∫–Ω–º - –í—ã—è–≤–ª–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_vknm_gzn} onChange={(v) => updateCalcData('k_vknm_gzn', v)} />
                                                <CalculatorInputGroup label="–ö–ø–∫–Ω–º - –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫" value={currentData.k_pknm_gzn} onChange={(v) => updateCalcData('k_pknm_gzn', v)} />
                                                <CalculatorInputGroup label="–ö—É–∫–Ω–º - –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_uknm_gzn} onChange={(v) => updateCalcData('k_uknm_gzn', v)} />
                                            </div>
                                            <div className="bg-red-50 p-3 rounded border border-red-100 print:bg-white print:border-slate-300">
                                                <h3 className="text-red-900 font-bold text-sm mb-2">–ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π (–ú–ó–ö)</h3>
                                                <CalculatorInputGroup label="–ö–≤–∫–Ω–º - –í—ã—è–≤–ª–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_vknm_mzk} onChange={(v) => updateCalcData('k_vknm_mzk', v)} />
                                                <CalculatorInputGroup label="–ö–ø–∫–Ω–º - –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫" value={currentData.k_pknm_mzk} onChange={(v) => updateCalcData('k_pknm_mzk', v)} />
                                                <CalculatorInputGroup label="–ö—É–∫–Ω–º - –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π" value={currentData.k_uknm_mzk} onChange={(v) => updateCalcData('k_uknm_mzk', v)} />
                                            </div>
                                        </div>
                                        <ResultBreakdown total={results.ind5} items={[{ label: "9.1 –ò_–≤–∫–Ω–º", desc: "–í—ã—è–≤–ª—è–µ–º–æ—Å—Ç—å (–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞–º)", value: results.sub5_1 }, { label: "9.2 –ò_—É–∫–Ω–º", desc: "–£—Å—Ç—Ä–∞–Ω—è–µ–º–æ—Å—Ç—å (–∫ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º)", value: results.sub5_2 }]} />
                                    </>
                                )}

                                {activeCalcTab === 5 && (
                                    <div className="space-y-6 text-slate-800 methodology-text">
                                        <div className="border-b pb-4">
                                            <h2 className="text-2xl font-bold">–ü—Ä–æ–µ–∫—Ç –º–µ—Ç–æ–¥–∏–∫–∏</h2>
                                            <p className="text-slate-500 mt-1">–û –ø–æ—Ä—è–¥–∫–µ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π</p>
                                        </div>
                                        {/* –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–µ—Ç–æ–¥–∏–∫–∏ */}
                                    </div>
                                )}
                            </Card>
                        </div>
                        
                        <div className="xl:col-span-1">
                            <Card className="p-4 bg-white border-2 border-slate-200 shadow-xl sticky top-4 text-slate-800 print:shadow-none print:border print:border-slate-300">
                                <h2 className="text-xs uppercase text-slate-500 font-bold mb-1 print:text-slate-600">–ò—Ç–æ–≥–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                                <div className="text-5xl font-bold mb-2 text-slate-900">{results.total.toFixed(2)}%</div>
                                <div className="w-full bg-slate-200 h-2 rounded-full overflow-hidden mb-6 print:border print:border-slate-300">
                                    <div className="bg-blue-600 h-full transition-all print:bg-black" style={{ width: `${Math.min(results.total, 100)}%` }}></div>
                                </div>
                                
                                <div className="text-xs font-bold uppercase tracking-wider text-slate-400 mb-3 border-b border-slate-200 pb-1">–ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
                                
                                <div className="space-y-3">
                                    {finalResultsArray.map((item, idx) => (
                                        <div key={idx} className="flex items-center gap-2 p-2 rounded-lg bg-slate-50 border border-slate-100 print:bg-white print:border-slate-200 hover:bg-slate-100 transition-colors">
                                            <div className={`p-2 rounded-lg ${item.section.bg} ${item.section.color} print:bg-white`}>
                                                {React.createElement(item.section.icon, { size: 20 })}
                                            </div>
                                            
                                            <div className="flex-1 min-w-0">
                                                <div className="text-xs font-bold text-slate-700 truncate print:text-slate-600">
                                                    {item.section.title}
                                                </div>
                                                <div className="flex justify-between items-center mt-1">
                                                    <span className="font-mono text-slate-400 text-[10px]">{item.val.toFixed(1)}%</span>
                                                    <div className="text-right leading-tight">
                                                        <div className="text-[14px] font-bold text-slate-900">{(item.val * item.section.numWeight).toFixed(2)}%</div>
                                                        <div className="text-[9px] text-slate-400">–í–∫–ª–∞–¥ –≤ –∏—Ç–æ–≥ (–≤–µ—Å {item.section.numWeight})</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-6 pt-4 border-t border-slate-200 text-xs text-slate-400 print:text-black print:border-slate-300">
                                    –ü–µ—Ä–∏–æ–¥: {periodsList.find(p=>p.id===period)?.label}
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        }

        function initCalculator() {
            const calculatorRoot = document.getElementById('calculatorRoot');
            if (calculatorRoot) {
                const root = ReactDOM.createRoot(calculatorRoot);
                root.render(<EfficiencyCalculator />);
            }
        }
    </script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        window.GITHUB_RAW_URL = 'https://raw.githubusercontent.com/mark98molchanov-a11y/mark98molchanov-a12y.gko-registry-system/main/';
        
        const STORAGE_KEY_NPA = 'rosreestr_npa_viz_v5';
        const STORAGE_KEY_DASHBOARDS = 'gko_dashboards_v2';
        const STORAGE_KEY_CALCULATOR = 'gko_calculator_data_v1';
        const STORAGE_KEY_DIO = 'gko_dio_tree_v1';
        const STORAGE_KEY_ALL = 'gko_all_data.json';
        
        let appData = [];
        let currentDocFilter = null;
        let currentTypeFilter = null;
        let currentTargetFilter = null;
        let selectedIds = new Set();
        let editId = null;
        let chartInstance = null;
        
        let dashboardsData = [];
        let currentStatusFilterDashboards = null;
        let currentTypeFilterDashboards = null;
        let currentTagFilterDashboards = null;
        let selectedIdsDashboards = new Set();
        let editIdDashboards = null;
        let chartInstanceDashboards = null;
        
        let currentTab = 'npas';
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GitHub
        async function loadFromGitHub() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub...');
                
                const response = await fetch(`${window.GITHUB_RAW_URL}gko_all_data.json`);
                
                if (!response.ok) {
                    throw new Error(`–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (${response.status})`);
                }
                
                const json = await response.json();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –ù–ü–ê
                if (json.npas && Array.isArray(json.npas)) {
                    appData = [...json.npas];
                    localStorage.setItem(STORAGE_KEY_NPA, JSON.stringify(appData));
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${json.npas.length} –∑–∞–ø–∏—Å–µ–π –ù–ü–ê`);
                    if (currentTab === 'npas') {
                        renderGrid();
                    }
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤
                if (json.dashboards && Array.isArray(json.dashboards)) {
                    dashboardsData = [...json.dashboards];
                    localStorage.setItem(STORAGE_KEY_DASHBOARDS, JSON.stringify(dashboardsData));
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${json.dashboards.length} –¥–∞—à–±–æ—Ä–¥–æ–≤`);
                    if (currentTab === 'dashboards') {
                        renderDashboardsGrid();
                    }
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
                if (json.calculator) {
                    console.log('–î–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞–π–¥–µ–Ω—ã –≤ GitHub:', json.calculator);
                    localStorage.setItem(STORAGE_KEY_CALCULATOR, JSON.stringify(json.calculator));
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ä–µ–≤–∞ –î–ò–û
                if (json.dioTree) {
                    console.log('–î–µ—Ä–µ–≤–æ –î–ò–û –Ω–∞–π–¥–µ–Ω–æ –≤ GitHub');
                    localStorage.setItem(STORAGE_KEY_DIO, JSON.stringify(json.dioTree));
                    
                    // –ï—Å–ª–∏ –º—ã –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –î–ò–û, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ä–µ–≤–æ
                    if (currentTab === 'dio' && window.DIO_TREE_DATA) {
                        window.DIO_TREE_DATA = json.dioTree;
                        renderDIOTree();
                    }
                }
                
                showNotification('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub', 'success');
                
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub:', error.message);
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                loadData();
                loadDashboardsData();
            }
        }
        
        let currentGitHubToken = null;

        function showGitHubTokenModal() {
            document.getElementById('githubTokenInput').value = '';
            document.getElementById('githubTokenModal').classList.remove('hidden');
            document.getElementById('githubTokenInput').focus();
        }

        function closeGitHubModal() {
            document.getElementById('githubTokenModal').classList.add('hidden');
            document.getElementById('githubTokenInput').value = '';
            currentGitHubToken = null;
        }
        
        async function saveToGitHub() {
            const token = document.getElementById('githubTokenInput').value.trim();
            
            if (!token) {
                alert('–í–≤–µ–¥–∏—Ç–µ GitHub Token');
                return;
            }
            
            currentGitHubToken = token;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            localStorage.setItem('github_token', token);
            
            const allData = {
                version: "1.0",
                exportDate: new Date().toISOString(),
                npas: appData,
                dashboards: dashboardsData,
                calculator: JSON.parse(localStorage.getItem(STORAGE_KEY_CALCULATOR) || '{}'),
                dioTree: window.DIO_TREE_DATA || JSON.parse(localStorage.getItem(STORAGE_KEY_DIO) || '{}'),
                metadata: {
                    npaCount: appData.length,
                    dashboardsCount: dashboardsData.length,
                    dioNodeCount: window.DIO_TREE_DATA ? countDIOTreeNodes(window.DIO_TREE_DATA) : 0,
                    exportFormat: "combined"
                }
            };
            
            const content = JSON.stringify(allData, null, 2);
            const owner = 'mark98molchanov-a11y';
            const repo = 'mark98molchanov-a12y.gko-registry-system';
            const path = 'gko_all_data.json';
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
            
            try {
                let sha = null;
                try {
                    const res = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (res.ok) {
                        const data = await res.json();
                        sha = data.sha;
                    }
                } catch (e) { /* –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç */ }
                
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: ${new Date().toLocaleString('ru-RU')}`,
                        content: btoa(unescape(encodeURIComponent(content))),
                        sha: sha
                    })
                });
                
                if (response.ok) {
                    closeGitHubModal();
                    showNotification('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞ GitHub', 'success');
                } else {
                    const error = await response.json();
                    alert(`–û—à–∏–±–∫–∞: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                    document.getElementById('githubTokenInput').focus();
                }
                
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                document.getElementById('githubTokenInput').focus();
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 ${
                type === 'success' ? 'bg-emerald-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-amber-500 text-white' :
                'bg-brand-600 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-white/80">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        function exportJson() {
            const calculatorData = JSON.parse(localStorage.getItem(STORAGE_KEY_CALCULATOR) || '{}');
            const dioTreeData = JSON.parse(localStorage.getItem(STORAGE_KEY_DIO) || '{}');
            
            const allData = {
                version: "1.0",
                exportDate: new Date().toISOString(),
                npas: appData,
                dashboards: dashboardsData,
                calculator: calculatorData,
                dioTree: dioTreeData,
                metadata: {
                    npaCount: appData.length,
                    dashboardsCount: dashboardsData.length,
                    dioNodeCount: countDIOTreeNodes(dioTreeData),
                    exportFormat: "combined"
                }
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allData, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = `gko_all_data.json`;
            a.click();
        }

        function importJson() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const json = JSON.parse(e.target.result);
                        
                        let confirmMessage = "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞?\n\n";
                        let hasNPA = false;
                        let hasDashboards = false;
                        let hasCalculator = false;
                        let hasDIO = false;
                        
                        if (json.npas && Array.isArray(json.npas)) {
                            confirmMessage += `–ù–ü–ê: ${json.npas.length} –∑–∞–ø–∏—Å–µ–π\n`;
                            hasNPA = true;
                        }
                        
                        if (json.dashboards && Array.isArray(json.dashboards)) {
                            confirmMessage += `–î–∞—à–±–æ—Ä–¥—ã: ${json.dashboards.length} –∑–∞–ø–∏—Å–µ–π\n`;
                            hasDashboards = true;
                        }
                        
                        if (json.calculator) {
                            confirmMessage += `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫\n`;
                            hasCalculator = true;
                        }
                        
                        if (json.dioTree) {
                            confirmMessage += `–î–µ—Ä–µ–≤–æ –î–ò–û: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö\n`;
                            hasDIO = true;
                        }
                        
                        if (json.version && json.version === "1.0" && json.exportFormat === "combined") {
                            confirmMessage += "\n–§–æ—Ä–º–∞—Ç: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª";
                        } else if (Array.isArray(json) && json.length > 0 && json[0].doc) {
                            confirmMessage = `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${json.length} –∑–∞–ø–∏—Å–µ–π –ù–ü–ê?`;
                            hasNPA = true;
                        } else if (Array.isArray(json) && json.length > 0 && json[0].title) {
                            confirmMessage = `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${json.length} –¥–∞—à–±–æ—Ä–¥–æ–≤?`;
                            hasDashboards = true;
                        } else if (json.id && json.title) {
                            confirmMessage = `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ –î–ò–û?`;
                            hasDIO = true;
                        }
                        
                        if (confirm(confirmMessage)) {
                            if (hasNPA) {
                                const npaData = json.npas || json;
                                appData = [...npaData];
                                saveData();
                            }
                            
                            if (hasDashboards) {
                                const dashData = json.dashboards || json;
                                dashboardsData = [...dashData];
                                saveDashboardsData();
                            }
                            
                            if (hasCalculator && json.calculator) {
                                localStorage.setItem(STORAGE_KEY_CALCULATOR, JSON.stringify(json.calculator));
                            }
                            
                            if (hasDIO && json.dioTree) {
                                localStorage.setItem(STORAGE_KEY_DIO, JSON.stringify(json.dioTree));
                                if (window.DIO_TREE_DATA) {
                                    window.DIO_TREE_DATA = json.dioTree;
                                    if (currentTab === 'dio') {
                                        renderDIOTree();
                                    }
                                }
                            }
                            
                            showNotification("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!", 'success');
                        }
                    } catch(e) {
                        showNotification("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: " + e.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function switchTab(tabName) {
            // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.book-section.main, .book-subsection, .book-subsubsection').forEach(el => {
                el.classList.remove('active');
            });
            
            const navIdMap = {
                'npas': 'navNPA',
                'dashboards': 'navDashboards', 
                'calculator': 'navCalculator',
                'dio': null
            };
            
            const navId = navIdMap[tabName];
            if (navId) {
                const activeNavItem = document.getElementById(navId);
                if (activeNavItem) {
                    activeNavItem.classList.add('active');
                }
            }
            
            // –î–ª—è –≥–ª–∞–≤–Ω–æ–π —Å–µ–∫—Ü–∏–∏ –î–ò–û
            if (tabName === 'dio') {
                const dioSection = Array.from(document.querySelectorAll('.book-section.main'))
                    .find(el => el.textContent.includes('–ë–∞–∑–∞ –î–ò–û'));
                if (dioSection) {
                    dioSection.classList.add('active');
                }
            }
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content, .dio-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            if (tabName === 'dio') {
                document.getElementById('dioTab').classList.add('active');
                document.getElementById('currentSectionTitle').textContent = '–ë–∞–∑–∞ –î–ò–û';
                document.getElementById('currentSectionSubtitle').textContent = '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π';
            } else {
                document.getElementById(`${tabName}Tab`).classList.add('active');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
                const titles = {
                    'npas': '–†–µ–µ—Å—Ç—Ä—ã –ù–ü–ê',
                    'dashboards': '–î–∞—à–±–æ—Ä–¥—ã Superset',
                    'calculator': '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏'
                };
                
                const subtitles = {
                    'npas': '–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã –∏ –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è',
                    'dashboards': '–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Apache Superset',
                    'calculator': '–†–∞—Å—á–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π'
                };
                
                document.getElementById('currentSectionTitle').textContent = titles[tabName];
                document.getElementById('currentSectionSubtitle').textContent = subtitles[tabName];
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if (tabName === 'dio') {
                document.getElementById('npaImportButtons').classList.add('hidden');
                document.getElementById('dashboardsImportButtons').classList.add('hidden');
                document.getElementById('addButtonText').textContent = '–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª';
                document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –î–ò–û';
                document.getElementById('addButton').onclick = () => {
                    if (window.DIO_SELECTED_NODE) {
                        addDIOChildNode(window.DIO_SELECTED_NODE);
                    } else {
                        addDIORootNode();
                    }
                };
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ –î–ò–û, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
                if (!window.DIO_TREE_DATA) {
                    initDIOTree();
                }
                
            } else if (tabName === 'npas') {
                document.getElementById('npaImportButtons').classList.remove('hidden');
                document.getElementById('dashboardsImportButtons').classList.add('hidden');
                document.getElementById('addButtonText').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
                document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –ù–ü–ê';
                document.getElementById('addButton').onclick = openModal;
                renderGrid();
                
            } else if (tabName === 'dashboards') {
                document.getElementById('npaImportButtons').classList.add('hidden');
                document.getElementById('dashboardsImportButtons').classList.remove('hidden');
                document.getElementById('addButtonText').textContent = '–ù–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥';
                document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –¥–∞—à–±–æ—Ä–¥–æ–≤';
                document.getElementById('addButton').onclick = openModal;
                
                if (dashboardsData.length === 0) {
                    loadDashboardsData();
                }
                
                setTimeout(() => {
                    updateDashboardStatsDashboards();
                    renderStatusFiltersDashboards();
                    renderTypeFiltersDashboards();
                    renderTagsDashboards();
                    updateChartDashboards(dashboardsData);
                    renderDashboardsGrid();
                }, 50);
                
            } else if (tabName === 'calculator') {
                document.getElementById('npaImportButtons').classList.add('hidden');
                document.getElementById('dashboardsImportButtons').classList.add('hidden');
                document.getElementById('addButtonText').textContent = '–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç';
                document.getElementById('resetBtnText').textContent = '–°–±—Ä–æ—Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞';
                document.getElementById('addButton').onclick = () => {
                    alert('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏');
                };
                
                initCalculator();
            }
            
            currentTab = tabName;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
            document.getElementById('bulkToolbar').classList.add('hidden');
            document.getElementById('bulkToolbarDashboards').classList.add('hidden');
        }
        
        function hardResetCurrent() {
            if (currentTab === 'npas') {
                if (confirm("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ù–ü–ê? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) { 
                    localStorage.removeItem(STORAGE_KEY_NPA); 
                    loadData();
                    showNotification('–î–∞–Ω–Ω—ã–µ –ù–ü–ê —Å–±—Ä–æ—à–µ–Ω—ã', 'success');
                }
            } else if (currentTab === 'dashboards') {
                if (confirm("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–æ–≤? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞—à–±–æ—Ä–¥—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) {
                    localStorage.removeItem(STORAGE_KEY_DASHBOARDS);
                    loadDashboardsData();
                    showNotification('–î–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ —Å–±—Ä–æ—à–µ–Ω—ã', 'success');
                }
            } else if (currentTab === 'calculator') {
                if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞?")) {
                    localStorage.removeItem(STORAGE_KEY_CALCULATOR);
                    initCalculator();
                    showNotification('–î–∞–Ω–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –æ—á–∏—â–µ–Ω—ã', 'success');
                }
            } else if (currentTab === 'dio') {
                if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–∞–∑—ã –î–ò–û?")) {
                    localStorage.removeItem(STORAGE_KEY_DIO);
                    createDefaultDIOTree();
                    saveDIOTreeData();
                    showNotification('–î–∞–Ω–Ω—ã–µ –î–ò–û –æ—á–∏—â–µ–Ω—ã', 'success');
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–µ—Ä–µ–≤–∞ –î–ò–û (—É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤—ã—à–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ)
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ù–ü–ê –∏ –¥–∞—à–±–æ—Ä–¥–æ–≤ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞)
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY_NPA);
            if (saved) {
                try {
                    appData = JSON.parse(saved);
                } catch (e) { 
                    appData = [];
                }
            } else {
                appData = [];
            }
            renderGrid();
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY_NPA, JSON.stringify(appData));
            renderGrid();
        }

        function setDocFilter(val) { currentDocFilter = currentDocFilter === val ? null : val; renderGrid(); }
        function setTypeFilter(val) { currentTypeFilter = currentTypeFilter === val ? null : val; renderGrid(); }
        function setTargetFilter(val) { currentTargetFilter = currentTargetFilter === val ? null : val; renderGrid(); }
        function resetAllFilters() { currentDocFilter = null; currentTypeFilter = null; currentTargetFilter = null; document.getElementById('searchInput').value=''; renderGrid(); }

        function renderGrid() {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–∫–∏ –ù–ü–ê
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sortMode = document.getElementById('sortSelect').value;
            
            let filtered = appData.filter(item => {
                const matchesDoc = !currentDocFilter || item.doc === currentDocFilter;
                const matchesType = !currentTypeFilter || item.type === currentTypeFilter;
                const matchesTarget = !currentTargetFilter || (item.target && item.target.includes(currentTargetFilter));
                const matchesSearch = 
                    (item.human && item.human.toLowerCase().includes(search)) || 
                    (item.norm && item.norm.toLowerCase().includes(search)) || 
                    (item.doc && item.doc.toLowerCase().includes(search));
                return matchesDoc && matchesType && matchesTarget && matchesSearch;
            });

            filtered.sort((a, b) => {
                if (sortMode === 'dateDesc') return parseDate(b.date) - parseDate(a.date);
                if (sortMode === 'dateAsc') return parseDate(a.date) - parseDate(b.date);
                if (sortMode === 'lastUpdated') return (b.updated || 0) - (a.updated || 0);
                return a.id - b.id;
            });

            renderDocFilters();
            renderTypeFilters();
            renderTags();
            updateActiveBar();
            updateDashboard(filtered);

            const container = document.getElementById('cardsGrid');
            container.innerHTML = '';

            document.getElementById('filteredCount').innerText = filtered.length;

            if (filtered.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-slate-400">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
                return;
            }

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫ –ù–ü–ê
            filtered.forEach(item => {
                const isSelected = selectedIds.has(item.id);
                const badgeColor = getBadgeColor(item.doc);
                const typeColor = getTypeColor(item.type);
                const updateDate = item.updated ? new Date(item.updated).toLocaleString('ru-RU', { 
                    day: '2-digit', month: '2-digit', year: 'numeric', 
                    hour: '2-digit', minute: '2-digit' 
                }) : '‚Äî';

                const div = document.createElement('div');
                div.className = `bg-white rounded-2xl shadow-sm border ${isSelected ? 'border-brand-500 ring-2 ring-brand-200' : 'border-slate-200'} p-5 card-anim relative group hover:border-brand-300`;
                div.innerHTML = `
                    <div class="absolute top-5 left-5 z-10">
                        <input type="checkbox" class="custom-checkbox" onchange="toggleSelection('${item.id}')" ${isSelected ? 'checked' : ''}>
                    </div>
                    <div class="pl-10">
                        <div class="flex flex-wrap justify-between items-start gap-2 mb-3">
                            <div class="flex flex-wrap items-center gap-2">
                                <span class="text-[10px] font-extrabold px-2 py-1 rounded-md ${badgeColor} uppercase tracking-wider cursor-pointer hover:opacity-80" onclick="setDocFilter('${item.doc}')">${item.doc}</span>
                                <span class="text-[10px] font-bold px-2 py-1 rounded-md ${typeColor} uppercase tracking-wider cursor-pointer hover:opacity-80" onclick="setTypeFilter('${item.type}')">${item.type}</span>
                            </div>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="editItem(${item.id})" class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-brand-600">‚úèÔ∏è</button>
                                <button onclick="deleteItem(${item.id})" class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-red-500">üóëÔ∏è</button>
                            </div>
                        </div>
                        <h3 class="font-bold text-lg text-slate-800 mb-3">${item.norm}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <div class="bg-red-50 p-2.5 rounded-lg border border-red-100 text-sm text-slate-600">
                                <strong class="block text-[10px] text-red-400 uppercase">–ë—ã–ª–æ</strong>${item.before}
                            </div>
                            <div class="bg-emerald-50 p-2.5 rounded-lg border border-emerald-100 text-sm text-slate-800 font-medium">
                                <strong class="block text-[10px] text-emerald-600 uppercase">–°—Ç–∞–ª–æ</strong>${item.after}
                            </div>
                        </div>
                        <p class="text-slate-600 text-sm mb-3">${item.human}</p>
                        ${item.example ? `<div class="text-xs text-slate-500 bg-slate-50 p-2 rounded border-l-2 border-brand-200 mb-3 italic">"${item.example}"</div>` : ''}
                        
                        <div class="flex items-center gap-2 mt-2 flex-wrap">
                            ${(item.target||'').split(',').map(t => `<span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full cursor-pointer hover:bg-brand-100 hover:text-brand-700 transition" onclick="setTargetFilter('${t.trim()}')">#${t.trim()}</span>`).join('')}
                        </div>

                        <!-- Footer Info -->
                        <div class="mt-4 pt-3 border-t border-slate-100 flex flex-wrap justify-between items-center text-xs text-slate-400">
                           <div class="flex gap-3">
                                <span title="–û—Å–Ω–æ–≤–∞–Ω–∏–µ">üìÑ ${item.changeDoc || '‚Äî'}</span>
                                <span title="–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è" class="text-slate-600 font-bold">üìÖ ${item.date || '‚Äî'}</span>
                           </div>
                           <div class="flex items-center gap-3">
                                <span title="–û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –±–∞–∑–µ">üîÑ ${updateDate}</span>
                                <button onclick="toggleCardText('${item.id}')" class="text-brand-600 font-bold hover:underline">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç ‚ñº</button>
                           </div>
                        </div>
                        
                        <!-- Collapsible Legal Text -->
                        <div id="legal-${item.id}" class="hidden mt-3 pt-3 border-t border-dashed border-slate-200 grid grid-cols-1 md:grid-cols-2 gap-4 text-xs font-mono bg-slate-50 p-3 rounded-lg">
                            <div><strong class="block text-slate-400 uppercase mb-1">–°—Ç–∞—Ä–∞—è —Ä–µ–¥.</strong>${item.fullOld || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}</div>
                            <div><strong class="block text-emerald-600 uppercase mb-1">–ù–æ–≤–∞—è —Ä–µ–¥.</strong>${item.fullNew || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            updateBulkToolbar();
        }

        function updateDashboard(dataSource) {
            const data = dataSource || appData;
            const total = data.length;
            document.getElementById('statTotal').innerText = total;

            const countFZ = data.filter(i => i.doc.includes('237')).length;
            const countOrder = data.filter(i => i.doc.includes('0336')).length;
            const countNK = data.filter(i => i.doc.includes('378') || i.doc.includes('NK')).length;

            document.getElementById('countFZ').innerText = countFZ;
            document.getElementById('countOrder').innerText = countOrder;
            document.getElementById('countNK').innerText = countNK;

            document.getElementById('barFZ').style.width = (total ? (countFZ/total*100) : 0) + '%';
            document.getElementById('barOrder').style.width = (total ? (countOrder/total*100) : 0) + '%';
            document.getElementById('barNK').style.width = (total ? (countNK/total*100) : 0) + '%';
            
            const typeCounts = {};
            data.forEach(i => { typeCounts[i.type] = (typeCounts[i.type] || 0) + 1; });
            const sortedKeys = Object.keys(typeCounts).sort((a,b) => typeCounts[b] - typeCounts[a]);
            const sortedData = sortedKeys.map(k => typeCounts[k]);
            
            const ctx = document.getElementById('typeChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedKeys,
                    datasets: [{
                        label: '–ó–∞–ø–∏—Å–µ–π',
                        data: sortedData,
                        backgroundColor: '#3b82f6',
                        borderRadius: 4,
                        barThickness: 20
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { precision: 0 } },
                        y: { grid: { display: false } }
                    },
                    onClick: (e, els) => {
                        if(els.length > 0) {
                            const index = els[0].index;
                            setTypeFilter(sortedKeys[index]);
                        }
                    }
                }
            });
        }

        function renderDocFilters() {
            const container = document.getElementById('docFilterContainer');
            const docs = [...new Set(appData.map(item => item.doc))];
            container.innerHTML = docs.map(doc => {
                const isActive = currentDocFilter === doc;
                return `<button onclick="setDocFilter('${doc}')" class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">${doc}</button>`;
            }).join('');
        }

        function renderTypeFilters() {
            const container = document.getElementById('typeFilterContainer');
            const types = [...new Set(appData.map(item => item.type))];
            container.innerHTML = types.map(t => {
                const isActive = currentTypeFilter === t;
                return `<button onclick="setTypeFilter('${t}')" class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">${t}</button>`;
            }).join('');
        }

        function renderTags() {
            const container = document.getElementById('targetContainer');
            const counts = {}; appData.forEach(i => (i.target||'').split(',').forEach(t => { const k=t.trim(); if(k) counts[k]=(counts[k]||0)+1; }));
            container.innerHTML = Object.keys(counts).map(k => {
                const isActive = currentTargetFilter === k;
                return `<button onclick="setTargetFilter('${k}')" class="filter-chip px-3 py-1 border rounded-full text-xs ${isActive ? 'active' : 'bg-white text-slate-500 border-slate-200'}">${k} <span class="opacity-60 ml-1">${counts[k]}</span></button>`;
            }).join('');
        }

        function updateActiveBar() {
            const bar = document.getElementById('activeFiltersBar');
            if(currentDocFilter || currentTypeFilter || currentTargetFilter) bar.classList.remove('hidden'); else bar.classList.add('hidden');
        }

        function openModal() {
            if (currentTab === 'npas') {
                openModalNPA();
            } else if (currentTab === 'dashboards') {
                openModalDashboards();
            }
        }

        function openModalNPA() {
            editId = null;
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ù–ü–ê
        }

        function editItem(id) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –ù–ü–ê
        }

        function saveItem() {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –ù–ü–ê
        }

        function deleteItem(id) { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) { appData = appData.filter(i => i.id !== id); selectedIds.delete(id); saveData(); } }
        
        function toggleSelection(idStr) { const id = parseInt(idStr); if (selectedIds.has(id)) selectedIds.delete(id); else selectedIds.add(id); updateBulkToolbar(); renderGrid(); }
        function toggleSelectAll() {
            const visibleIds = Array.from(document.querySelectorAll('#cardsGrid .custom-checkbox')).map(cb => parseInt(cb.getAttribute('onchange').match(/\d+/)[0]));
            const allSelected = visibleIds.every(id => selectedIds.has(id));
            visibleIds.forEach(id => { if(allSelected) selectedIds.delete(id); else selectedIds.add(id); });
            updateBulkToolbar(); renderGrid();
        }
        function clearSelection() { selectedIds.clear(); updateBulkToolbar(); renderGrid(); }
        function updateBulkToolbar() { 
            const el = document.getElementById('bulkToolbar'); 
            document.getElementById('bulkCount').innerText = selectedIds.size; 
            if (selectedIds.size > 0 && currentTab === 'npas') {
                el.classList.remove('hidden');
            } else {
                el.classList.add('hidden');
            }
        }
        function bulkDelete() { if(confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedIds.size} –∑–∞–ø–∏—Å–µ–π?`)) { appData = appData.filter(i => !selectedIds.has(i.id)); clearSelection(); saveData(); } }
        
        function getBadgeColor(doc) {
            if(doc.includes("237")) return "bg-indigo-100 text-indigo-700";
            if(doc.includes("0336")) return "bg-sky-100 text-sky-700";
            if(doc.includes("378") || doc.includes("NK")) return "bg-amber-100 text-amber-800";
            return "bg-slate-100 text-slate-700";
        }
        
        function getTypeColor(type) {
            if(type === '–¶–∏—Ñ—Ä–∞') return 'bg-purple-100 text-purple-700';
            if(type === '–§–∏–Ω–∞–Ω—Å—ã') return 'bg-emerald-100 text-emerald-700';
            if(type === '–ö–æ–Ω—Ç—Ä–æ–ª—å') return 'bg-rose-100 text-rose-700';
            return 'bg-slate-100 text-slate-600';
        }
        
        function parseDate(d) { if (!d) return 0; const p = d.split('.'); return p.length === 3 ? new Date(p[2], p[1]-1, p[0]).getTime() : 0; }
        
        function exportToExcelNPA() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sortMode = document.getElementById('sortSelect').value;
            
            let filtered = appData.filter(item => {
                const matchesDoc = !currentDocFilter || item.doc === currentDocFilter;
                const matchesType = !currentTypeFilter || item.type === currentTypeFilter;
                const matchesTarget = !currentTargetFilter || (item.target && item.target.includes(currentTargetFilter));
                const matchesSearch = 
                    (item.human && item.human.toLowerCase().includes(search)) || 
                    (item.norm && item.norm.toLowerCase().includes(search)) || 
                    (item.doc && item.doc.toLowerCase().includes(search));
                return matchesDoc && matchesType && matchesTarget && matchesSearch;
            });

            filtered.sort((a, b) => {
                if (sortMode === 'dateDesc') return parseDate(b.date) - parseDate(a.date);
                if (sortMode === 'dateAsc') return parseDate(a.date) - parseDate(b.date);
                if (sortMode === 'lastUpdated') return (b.updated || 0) - (a.updated || 0);
                return a.id - b.id;
            });
            
            const data = filtered.map(item => ({
                '–î–æ–∫—É–º–µ–Ω—Ç': item.doc || '',
                '–ù–æ—Ä–º–∞/–°—Ç–∞—Ç—å—è': item.norm || '',
                '–¢–∏–ø': item.type || '',
                '–¢–µ–≥–∏': item.target || '',
                '–ë—ã–ª–æ': item.before || '',
                '–°—Ç–∞–ª–æ': item.after || '',
                '–ü–æ—è—Å–Ω–µ–Ω–∏–µ': item.human || '',
                '–ü—Ä–∏–º–µ—Ä': item.example || '',
                '–û—Å–Ω–æ–≤–∞–Ω–∏–µ': item.changeDoc || '',
                '–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è': item.date || '',
                '–°—Ç–∞—Ä–∞—è —Ä–µ–¥–∞–∫—Ü–∏—è': item.fullOld || '',
                '–ù–æ–≤–∞—è —Ä–µ–¥–∞–∫—Ü–∏—è': item.fullNew || '',
                '–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è': item.updated ? new Date(item.updated).toLocaleString('ru-RU') : ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "–†–µ–µ—Å—Ç—Ä –ù–ü–ê");
            
            ws['!cols'] = [
                { wch: 15 },    // –î–æ–∫—É–º–µ–Ω—Ç
                { wch: 20 },    // –ù–æ—Ä–º–∞/–°—Ç–∞—Ç—å—è
                { wch: 12 },    // –¢–∏–ø
                { wch: 20 },    // –¢–µ–≥–∏
                { wch: 30 },    // –ë—ã–ª–æ
                { wch: 30 },    // –°—Ç–∞–ª–æ
                { wch: 40 },    // –ü–æ—è—Å–Ω–µ–Ω–∏–µ
                { wch: 30 },    // –ü—Ä–∏–º–µ—Ä
                { wch: 20 },    // –û—Å–Ω–æ–≤–∞–Ω–∏–µ
                { wch: 12 },    // –î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è
                { wch: 30 },    // –°—Ç–∞—Ä–∞—è —Ä–µ–¥–∞–∫—Ü–∏—è
                { wch: 30 },    // –ù–æ–≤–∞—è —Ä–µ–¥–∞–∫—Ü–∏—è
                { wch: 20 }     // –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            ];
            
            const fileName = `–†–µ–µ—Å—Ç—Ä_–ù–ü–ê_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${filtered.length} –∑–∞–ø–∏—Å–µ–π –≤ Excel`, 'success');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
        function loadDashboardsData() {
            const saved = localStorage.getItem(STORAGE_KEY_DASHBOARDS);
            if (saved) {
                try {
                    dashboardsData = JSON.parse(saved);
                } catch (e) { 
                    dashboardsData = [];
                }
            } else {
                dashboardsData = [];
            }
            updateDashboardStatsDashboards();
            renderStatusFiltersDashboards();
            renderTypeFiltersDashboards();
            renderTagsDashboards();
            
            if (currentTab === 'dashboards') {
                renderDashboardsGrid();
            } else {
                updateChartDashboards(dashboardsData);
            }
        }
        
        function saveDashboardsData() {
            localStorage.setItem(STORAGE_KEY_DASHBOARDS, JSON.stringify(dashboardsData));
            renderDashboardsGrid();
        }

        function setStatusFilterDashboards(val) { 
            currentStatusFilterDashboards = currentStatusFilterDashboards === val ? null : val; 
            renderDashboardsGrid(); 
        }

        function setTypeFilterDashboards(val) { 
            currentTypeFilterDashboards = currentTypeFilterDashboards === val ? null : val; 
            renderDashboardsGrid(); 
        }

        function setTagFilterDashboards(val) { 
            currentTagFilterDashboards = currentTagFilterDashboards === val ? null : val; 
            renderDashboardsGrid(); 
        }

        function resetAllDashboardsFilters() { 
            currentStatusFilterDashboards = null; 
            currentTypeFilterDashboards = null; 
            currentTagFilterDashboards = null; 
            document.getElementById('searchInputDashboards').value=''; 
            renderDashboardsGrid(); 
        }

        function renderDashboardsGrid() {
            const search = document.getElementById('searchInputDashboards').value.toLowerCase();
            const sortMode = document.getElementById('sortSelectDashboards').value;
            
            let filtered = dashboardsData.filter(item => {
                const matchesStatus = !currentStatusFilterDashboards || item.status === currentStatusFilterDashboards;
                const matchesType = !currentTypeFilterDashboards || item.analysisType === currentTypeFilterDashboards;
                const matchesTag = !currentTagFilterDashboards || (item.tags && item.tags.some(tag => tag.toLowerCase() === currentTagFilterDashboards.toLowerCase()));
                const matchesSearch = 
                    (item.title && item.title.toLowerCase().includes(search)) || 
                    (item.description && item.description.toLowerCase().includes(search)) ||
                    (item.owner && item.owner.toLowerCase().includes(search)) ||
                    (item.tags && item.tags.some(tag => tag.toLowerCase().includes(search)));
                
                return matchesStatus && matchesType && matchesTag && matchesSearch;
            });

            filtered.sort((a, b) => {
                switch(sortMode) {
                    case 'nameAsc': return a.title.localeCompare(b.title);
                    case 'nameDesc': return b.title.localeCompare(a.title);
                    case 'createdDesc': return (b.createdDate || 0) - (a.createdDate || 0);
                    case 'createdAsc': return (a.createdDate || 0) - (b.createdDate || 0);
                    default: return (b.createdDate || 0) - (a.createdDate || 0);
                }
            });

            renderStatusFiltersDashboards();
            renderTypeFiltersDashboards();
            renderTagsDashboards();
            updateActiveBarDashboards();
            updateDashboardStatsDashboards(filtered);
            updateChartDashboards(filtered);

            const container = document.getElementById('cardsGridDashboards');
            container.innerHTML = '';
            document.getElementById('filteredCountDashboards').innerText = filtered.length;

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="col-span-2 text-center py-12 text-slate-400">
                        <svg class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="text-lg font-medium mb-2">–î–∞—à–±–æ—Ä–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        <p class="text-sm">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ <button onclick="resetAllDashboardsFilters()" class="text-brand-600 underline">—Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button></p>
                    </div>
                `;
                return;
            }

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–∞—à–±–æ—Ä–¥–æ–≤
            filtered.forEach(item => {
                const isSelected = selectedIdsDashboards.has(item.id);
                const statusColor = getStatusColorDashboards(item.status);
                const typeColor = getTypeColorDashboards(item.analysisType);
                const createdDate = item.createdDate ? new Date(item.createdDate).toLocaleDateString('ru-RU', { 
                    day: '2-digit', month: '2-digit', year: 'numeric'
                }) : '‚Äî';
                
                const tagsHtml = item.tags ? item.tags.map(tag => 
                    `<span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full cursor-pointer hover:bg-brand-100 hover:text-brand-700 transition" onclick="setTagFilterDashboards('${tag}')">#${tag}</span>`
                ).join('') : '';

                const card = document.createElement('div');
                card.className = `bg-white rounded-2xl shadow-sm border ${isSelected ? 'border-brand-500 ring-2 ring-brand-200' : 'border-slate-200'} p-5 card-anim dashboard-card hover:border-superset-300 group relative`;
                card.innerHTML = `
                    <div class="absolute top-5 left-5 z-10">
                        <input type="checkbox" class="custom-checkbox" onchange="toggleSelectionDashboards(${item.id})" ${isSelected ? 'checked' : ''}>
                    </div>
                    <div class="pl-10">
                        <div class="flex flex-wrap justify-between items-start gap-2 mb-3">
                            <div class="flex flex-wrap items-center gap-2">
                                <span class="status-badge ${statusColor}">${getStatusTextDashboards(item.status)}</span>
                                <span class="text-[10px] font-bold px-2 py-1 rounded-md ${typeColor} uppercase tracking-wider">${getTypeTextDashboards(item.analysisType)}</span>
                            </div>
                        </div>
                        
                        <h3 class="font-bold text-lg text-slate-800 mb-2">${item.title}</h3>
                        
                        <div class="mb-3">
                            <a href="${item.url}" target="_blank" class="text-sm text-superset-600 hover:text-superset-700 font-medium break-all">
                                <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                </svg>
                                ${item.url.replace('https://', '').replace('http://', '')}
                            </a>
                        </div>
                        
                        <p class="text-slate-600 text-sm mb-4">${item.description}</p>
                        
                        <div class="flex items-center gap-2 mb-3 flex-wrap">
                            ${tagsHtml}
                        </div>
                        
                        <!-- –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="mt-4 pt-3 border-t border-slate-100 grid grid-cols-2 gap-3 text-xs text-slate-500">
                            <div>
                                <div class="flex items-center gap-1">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    <span class="font-medium">${item.owner || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-0.5 bg-slate-100 rounded text-[10px] font-medium">${getFrequencyTextDashboards(item.updateFrequency)}</span>
                            </div>
                            <div class="col-span-2">
                                <div class="flex items-center gap-1">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    <span>–°–æ–∑–¥–∞–Ω: ${createdDate}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É -->
                        <div class="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-1">
                            <button onclick="openDashboard('${item.url}')" class="p-2 hover:bg-slate-100 rounded-lg text-slate-400 hover:text-superset-600 transition-colors" title="–û—Ç–∫—Ä—ã—Ç—å">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </button>
                            <button onclick="editDashboard(${item.id})" class="p-2 hover:bg-slate-100 rounded-lg text-slate-400 hover:text-brand-600 transition-colors" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </button>
                            <button onclick="deleteDashboard(${item.id})" class="p-2 hover:bg-slate-100 rounded-lg text-slate-400 hover:text-red-500 transition-colors" title="–£–¥–∞–ª–∏—Ç—å">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 011.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            updateBulkToolbarDashboards();
        }

        function updateDashboardStatsDashboards(filteredData = dashboardsData) {
            const total = dashboardsData.length;
            const active = dashboardsData.filter(d => d.status === 'active').length;
            
            const analytical = filteredData.filter(d => d.analysisType === 'analytical').length;
            const monitoring = filteredData.filter(d => d.analysisType === 'monitoring').length;
            const operational = filteredData.filter(d => d.analysisType === 'operational').length;
            const reporting = filteredData.filter(d => d.analysisType === 'reporting').length;
            
            document.getElementById('statTotalDashboards').innerText = total;
            document.getElementById('statActiveDashboards').innerText = active;
            document.getElementById('countAnalytical').innerText = analytical;
            document.getElementById('countMonitoring').innerText = monitoring;
            document.getElementById('countOperational').innerText = operational;
            document.getElementById('countReporting').innerText = reporting;
        }

        function updateChartDashboards(filteredData) {
            const typeCounts = {};
            filteredData.forEach(d => { 
                const type = getTypeTextDashboards(d.analysisType);
                typeCounts[type] = (typeCounts[type] || 0) + 1; 
            });
            
            const sortedTypes = Object.keys(typeCounts).sort((a, b) => typeCounts[b] - typeCounts[a]);
            const counts = sortedTypes.map(type => typeCounts[type]);
            
            const ctx = document.getElementById('typeChartDashboards').getContext('2d');
            if (chartInstanceDashboards) chartInstanceDashboards.destroy();
            
            const colors = {
                '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞': '#8b5cf6',
                '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥': '#3b82f6',
                '–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ': '#10b981',
                '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å': '#f43f5e',
                '–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ': '#f59e0b',
                '–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£': '#4f46e5'
            };
            
            const backgroundColors = sortedTypes.map(type => colors[type] || '#94a3b8');
            
            chartInstanceDashboards = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedTypes,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors,
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: { 
                        legend: { 
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    onClick: (e, els) => {
                        if (els.length > 0) {
                            const index = els[0].index;
                            const typeKey = getTypeKeyFromText(sortedTypes[index]);
                            if (typeKey) {
                                setTypeFilterDashboards(typeKey);
                            }
                        }
                    }
                }
            });
        }

        function getTypeKeyFromText(typeText) {
            const mapping = {
                '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞': 'analytical',
                '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥': 'monitoring',
                '–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ': 'operational',
                '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å': 'reporting',
                '–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ': 'forecast',
                '–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£': 'audit'
            };
            return mapping[typeText] || null;
        }

        function renderStatusFiltersDashboards() {
            const container = document.getElementById('statusFilterContainerDashboards');
            const statuses = ['active', 'draft', 'archived'];
            container.innerHTML = statuses.map(status => {
                const isActive = currentStatusFilterDashboards === status;
                const count = dashboardsData.filter(d => d.status === status).length;
                return `
                    <button onclick="setStatusFilterDashboards('${status}')" 
                            class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">
                        ${getStatusTextDashboards(status)} <span class="ml-1 opacity-70">(${count})</span>
                    </button>
                `;
            }).join('');
        }

        function renderTypeFiltersDashboards() {
            const container = document.getElementById('typeFilterContainerDashboards');
            const types = [...new Set(dashboardsData.map(d => d.analysisType))];
            container.innerHTML = types.map(type => {
                const isActive = currentTypeFilterDashboards === type;
                const count = dashboardsData.filter(d => d.analysisType === type).length;
                return `
                    <button onclick="setTypeFilterDashboards('${type}')" 
                            class="filter-chip px-3 py-1.5 rounded-lg text-xs font-bold border ${isActive ? 'active' : 'bg-white border-slate-200 text-slate-500'}">
                        ${getTypeTextDashboards(type)} <span class="ml-1 opacity-70">(${count})</span>
                    </button>
                `;
            }).join('');
        }

        function renderTagsDashboards() {
            const container = document.getElementById('tagsContainerDashboards');
            const tagCounts = {};
            
            dashboardsData.forEach(dashboard => {
                if (dashboard.tags && Array.isArray(dashboard.tags)) {
                    dashboard.tags.forEach(tag => {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    });
                }
            });
            
            const sortedTags = Object.keys(tagCounts).sort((a, b) => tagCounts[b] - tagCounts[a]);
            
            container.innerHTML = sortedTags.map(tag => {
                const isActive = currentTagFilterDashboards === tag;
                return `
                    <button onclick="setTagFilterDashboards('${tag}')" 
                            class="filter-chip px-3 py-1 border rounded-full text-xs ${isActive ? 'active' : 'bg-white text-slate-500 border-slate-200'}">
                        ${tag} <span class="opacity-60 ml-1">${tagCounts[tag]}</span>
                    </button>
                `;
            }).join('');
        }

        function updateActiveBarDashboards() {
            const bar = document.getElementById('activeFiltersBarDashboards');
            if (currentStatusFilterDashboards || currentTypeFilterDashboards || currentTagFilterDashboards) {
                bar.classList.remove('hidden');
            } else {
                bar.classList.add('hidden');
            }
        }

        function getStatusColorDashboards(status) {
            switch(status) {
                case 'active': return 'status-active';
                case 'draft': return 'status-draft';
                case 'archived': return 'status-archived';
                default: return 'status-draft';
            }
        }

        function getStatusTextDashboards(status) {
            switch(status) {
                case 'active': return '–ê–∫—Ç–∏–≤–Ω—ã–π';
                case 'draft': return '–ß–µ—Ä–Ω–æ–≤–∏–∫';
                case 'archived': return '–ê—Ä—Ö–∏–≤–Ω—ã–π';
                default: return status;
            }
        }

        function getTypeColorDashboards(type) {
            switch(type) {
                case 'analytical': return 'bg-purple-100 text-purple-700';
                case 'monitoring': return 'bg-blue-100 text-blue-700';
                case 'operational': return 'bg-emerald-100 text-emerald-700';
                case 'reporting': return 'bg-rose-100 text-rose-700';
                case 'forecast': return 'bg-amber-100 text-amber-700';
                case 'audit': return 'bg-indigo-100 text-indigo-700';
                default: return 'bg-slate-100 text-slate-600';
            }
        }

        function getTypeTextDashboards(type) {
            switch(type) {
                case 'analytical': return '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞';
                case 'monitoring': return '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥';
                case 'operational': return '–û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ';
                case 'reporting': return '–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å';
                case 'forecast': return '–ü—Ä–æ–≥–Ω–æ–∑';
                case 'audit': return '–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ì–ë–£';
                default: return type;
            }
        }

        function getFrequencyTextDashboards(freq) {
            switch(freq) {
                case 'realtime': return '–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è';
                case 'daily': return '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ';
                case 'weekly': return '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ';
                case 'monthly': return '–ï–∂–µ–º–µ—Å—è—á–Ω–æ';
                case 'quarterly': return '–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–æ';
                default: return freq;
            }
        }

        function toggleSelectionDashboards(id) {
            if (selectedIdsDashboards.has(id)) {
                selectedIdsDashboards.delete(id);
            } else {
                selectedIdsDashboards.add(id);
            }
            updateBulkToolbarDashboards();
            renderDashboardsGrid();
        }

        function toggleSelectAllDashboards() {
            const visibleCheckboxes = document.querySelectorAll('#cardsGridDashboards .custom-checkbox');
            const allSelected = Array.from(visibleCheckboxes).every(cb => cb.checked);
            
            visibleCheckboxes.forEach(cb => {
                const match = cb.getAttribute('onchange').match(/\d+/);
                if (match) {
                    const id = parseInt(match[0]);
                    if (allSelected) {
                        selectedIdsDashboards.delete(id);
                    } else {
                        selectedIdsDashboards.add(id);
                    }
                }
            });
            
            updateBulkToolbarDashboards();
            renderDashboardsGrid();
        }

        function clearSelectionDashboards() {
            selectedIdsDashboards.clear();
            updateBulkToolbarDashboards();
            renderDashboardsGrid();
        }

        function updateBulkToolbarDashboards() {
            const toolbar = document.getElementById('bulkToolbarDashboards');
            const countElement = document.getElementById('bulkCountDashboards');
            
            countElement.innerText = selectedIdsDashboards.size;
            
            if (selectedIdsDashboards.size > 0 && currentTab === 'dashboards') {
                toolbar.classList.remove('hidden');
            } else {
                toolbar.classList.add('hidden');
            }
        }

        function deleteDashboard(id) {
            if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–∞—à–±–æ—Ä–¥?")) {
                dashboardsData = dashboardsData.filter(d => d.id !== id);
                selectedIdsDashboards.delete(id);
                saveDashboardsData();
            }
        }

        function openDashboard(url) {
            window.open(url, '_blank');
        }

        function exportToExcelDashboards() {
            const search = document.getElementById('searchInputDashboards').value.toLowerCase();
            const sortMode = document.getElementById('sortSelectDashboards').value;
            
            let filtered = dashboardsData.filter(item => {
                const matchesStatus = !currentStatusFilterDashboards || item.status === currentStatusFilterDashboards;
                const matchesType = !currentTypeFilterDashboards || item.analysisType === currentTypeFilterDashboards;
                const matchesTag = !currentTagFilterDashboards || (item.tags && item.tags.some(tag => tag.toLowerCase() === currentTagFilterDashboards.toLowerCase()));
                const matchesSearch = 
                    (item.title && item.title.toLowerCase().includes(search)) || 
                    (item.description && item.description.toLowerCase().includes(search)) ||
                    (item.owner && item.owner.toLowerCase().includes(search)) ||
                    (item.tags && item.tags.some(tag => tag.toLowerCase().includes(search)));
                
                return matchesStatus && matchesType && matchesTag && matchesSearch;
            });

            filtered.sort((a, b) => {
                switch(sortMode) {
                    case 'nameAsc': return a.title.localeCompare(b.title);
                    case 'nameDesc': return b.title.localeCompare(a.title);
                    case 'createdDesc': return (b.createdDate || 0) - (a.createdDate || 0);
                    case 'createdAsc': return (a.createdDate || 0) - (b.createdDate || 0);
                    default: return (b.createdDate || 0) - (a.createdDate || 0);
                }
            });
            
            const data = filtered.map(d => ({
                '–ù–∞–∑–≤–∞–Ω–∏–µ': d.title,
                '–°—Å—ã–ª–∫–∞': d.url,
                '–û–ø–∏—Å–∞–Ω–∏–µ': d.description,
                '–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞': getTypeTextDashboards(d.analysisType),
                '–°—Ç–∞—Ç—É—Å': getStatusTextDashboards(d.status),
                '–í–ª–∞–¥–µ–ª–µ—Ü': d.owner,
                '–¢–µ–≥–∏': d.tags ? d.tags.join(', ') : '',
                '–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö': d.dataSource,
                '–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è': getFrequencyTextDashboards(d.updateFrequency),
                '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': d.createdDate ? new Date(d.createdDate).toLocaleDateString('ru-RU') : '',
                '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏': d.notes || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "–î–∞—à–±–æ—Ä–¥—ã");
            
            const maxWidth = data.reduce((w, r) => Math.max(w, r['–ù–∞–∑–≤–∞–Ω–∏–µ']?.length || 0), 10);
            ws['!cols'] = [
                { wch: maxWidth },     // –ù–∞–∑–≤–∞–Ω–∏–µ
                { wch: 40 },           // –°—Å—ã–ª–∫–∞
                { wch: 50 },           // –û–ø–∏—Å–∞–Ω–∏–µ
                { wch: 15 },           // –¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞
                { wch: 12 },           // –°—Ç–∞—Ç—É—Å
                { wch: 20 },           // –í–ª–∞–¥–µ–ª–µ—Ü
                { wch: 30 },           // –¢–µ–≥–∏
                { wch: 20 },           // –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
                { wch: 20 },           // –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                { wch: 15 },           // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
                { wch: 30 }            // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            ];
            
            const fileName = `–î–∞—à–±–æ—Ä–¥—ã_GKO_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${filtered.length} –¥–∞—à–±–æ—Ä–¥–æ–≤ –≤ Excel`, 'success');
        }

        function handleExcelImport(input) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ Excel –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
            alert("–ò–º–ø–æ—Ä—Ç Excel –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤");
        }

        function handleFileImport(input) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ Excel –¥–ª—è –ù–ü–ê
            alert("–ò–º–ø–æ—Ä—Ç Excel –¥–ª—è –ù–ü–ê");
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é
        let areSubsectionsCollapsed = false;

        function toggleAllSections() {
            const container = document.getElementById('subsectionsContainer');
            const icon = document.getElementById('collapseIcon');
            
            if (areSubsectionsCollapsed) {
                container.style.display = 'block';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '‚ñº';
                areSubsectionsCollapsed = false;
                
                if (isCapitalizationExpanded) {
                    const capContainer = document.getElementById('capitalizationSubsections');
                    const capIcon = document.getElementById('capitalizationIcon');
                    if (capContainer && capIcon) {
                        capContainer.style.display = 'block';
                        capIcon.style.transform = 'rotate(180deg)';
                        capIcon.textContent = '‚ñ≤';
                    }
                }
            } else {
                container.style.display = 'none';
                icon.style.transform = 'rotate(-90deg)';
                icon.textContent = '‚ñ∂';
                areSubsectionsCollapsed = true;
            }
        }
        
        let isCapitalizationExpanded = false;

        function toggleCapitalization() {
            const container = document.getElementById('capitalizationSubsections');
            const icon = document.getElementById('capitalizationIcon');
            
            if (isCapitalizationExpanded) {
                container.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '‚ñº';
                isCapitalizationExpanded = false;
            } else {
                container.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = '‚ñ≤';
                isCapitalizationExpanded = true;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
            const container = document.getElementById('subsectionsContainer');
            const icon = document.getElementById('collapseIcon');
            const capitalizationContainer = document.getElementById('capitalizationSubsections');
            const capitalizationIcon = document.getElementById('capitalizationIcon');
            
            if (container && icon) {
                container.style.display = 'block';
                icon.textContent = '‚ñº';
                areSubsectionsCollapsed = false;
            }
            
            if (capitalizationContainer && capitalizationIcon) {
                capitalizationContainer.style.display = 'none';
                capitalizationIcon.textContent = '‚ñº';
                isCapitalizationExpanded = false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º hash URL –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            const urlHash = window.location.hash;
            if (urlHash === '#calculator' || urlHash === '#capitalization') {
                if (capitalizationContainer && capitalizationIcon) {
                    capitalizationContainer.style.display = 'block';
                    capitalizationIcon.style.transform = 'rotate(180deg)';
                    capitalizationIcon.textContent = '‚ñ≤';
                    isCapitalizationExpanded = true;
                }
                
                const calculatorNav = document.getElementById('navCalculator');
                if (calculatorNav) {
                    calculatorNav.classList.add('active');
                }
                
                setTimeout(() => {
                    switchTab('calculator');
                }, 100);
                
            } else if (urlHash === '#dashboards') {
                setTimeout(() => {
                    switchTab('dashboards');
                }, 100);
                
            } else if (urlHash === '#dio') {
                setTimeout(() => {
                    switchTab('dio');
                }, 100);
                
            } else {
                // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–µ–Ω –†–µ–µ—Å—Ç—Ä –ù–ü–ê
                const npaNav = document.getElementById('navNPA');
                if (npaNav) {
                    npaNav.classList.add('active');
                }
                
                loadData();
                loadDashboardsData();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub
            loadFromGitHub().then(() => {
                console.log('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub');
            }).catch((error) => {
                console.log('‚ö†Ô∏è GitHub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
                console.log('–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                loadData();
                loadDashboardsData();
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è hash
            window.addEventListener('hashchange', function() {
                const hash = window.location.hash;
                console.log('Hash changed to:', hash);
                
                if (hash === '#calculator') {
                    if (capitalizationContainer && capitalizationIcon && !isCapitalizationExpanded) {
                        toggleCapitalization();
                    }
                    setTimeout(() => {
                        switchTab('calculator');
                    }, 50);
                    
                } else if (hash === '#npas') {
                    switchTab('npas');
                    
                } else if (hash === '#dashboards') {
                    switchTab('dashboards');
                    
                } else if (hash === '#dio') {
                    switchTab('dio');
                }
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ –î–ò–û
            initDIOTree();
        });
    </script>
</body>
</html>
