<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ - Apache Superset Embed</title>
    <meta http-equiv="X-Frame-Options" content="allow-from *">
<meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data: blob:;
    script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: blob:;
    connect-src 'self' https://raw.githubusercontent.com https://api.github.com https://mark98molchanov-ally.github.io;
    font-src 'self';
">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    
    <style>
        #githubLoadBtn {
            background: linear-gradient(145deg, #24292e, #0366d6) !important;
            color: white !important;
            border: none !important;
            padding: 8px 12px !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            margin-left: 10px !important;
            font-weight: 500 !important;
        }
        
        #githubLoadBtn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 8px rgba(3, 102, 214, 0.3) !important;
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <script>
        const isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);
        if (isChrome && parseInt(navigator.userAgent.match(/Chrome\/(\d+)/)?.[1] || 0) < 50) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏');
        }

        if (!window.Promise) {
            document.write('<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>');
        }
        if (!window.fetch) {
            document.write('<script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js"><\/script>');
        }
    </script>
</head>

<body class="transition-colors duration-300">
    <div class="toggle-controls" id="toggleControls">‚â°</div>
    
    <div class="background-text">
        <h1>–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–æ–≥–æ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –æ–∫—Ä—É–≥–∞</h1>
    </div>
    
    <div class="controls" id="controls">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫..." style="padding: 8px; border-radius: 8px; border: 1px solid var(--primary-color);">
        <span id="selectedCount" style="margin-left: 10px; font-size: 0.9em; color: var(--accent-color); display: none;">–í—ã–¥–µ–ª–µ–Ω–æ: 0</span>
        <div class="autocomplete-suggestions" id="searchSuggestions"></div>
        
        <button type="button" id="jsonExportBtn">JSON –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button type="button" id="jsonImportBtn">JSON –ò–º–ø–æ—Ä—Ç</button>
        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–¥–µ—Å—å —Å–∫—Ä–∏–ø—Ç–æ–º -->
        
        <button type="button" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" id="collapseAllBtn">–°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
        <button type="button" id="collapseParentBtn" class="collapse-parent-btn">–°–≤–µ—Ä–Ω—É—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è</button>
        
        <button type="button" id="addSuperordinateAboveBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–≤–µ—Ä—Ö—É</button>
        <button type="button" id="uploadFileBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
        
        <button type="button" id="mark269Btn">–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ 269-–ü</button>
        <button type="button" id="power269Btn">–ü–æ–ª–Ω–æ–º–æ—á–∏–µ –∏–∑ 269-–ü</button>
        <button type="button" id="subordinateBtn">–î–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã</button>
        <button type="button" id="forAllBtn">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
        <button type="button" id="authorityBtn">–ò–¥–µ–Ω—Ç–∏—á–Ω–æ–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–µ</button>
        <button type="button" id="okrBtn">OKR</button>
        <button type="button" id="indicatorBtn">–ì–æ—Å. –ø—Ä–æ–≥—Ä–∞–º–º–∞</button>
        <div class="cluster-controls" style="display: flex; gap: 5px; align-items: center;">
            <select id="clusterSelect" style="padding: 8px; border-radius: 8px; border: 1px solid var(--primary-color); background: var(--controls-bg); color: var(--text-color);">
                <option value="">–í—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
            </select>
            <button id="addToClusterBtn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä">üè∑Ô∏è</button>
        </div>
        <button type="button" id="zoomInBtn">+</button>
        <button type="button" id="zoomResetBtn" class="reset-zoom-btn" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–± –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —É–∑–ª–µ">‚≠ï</button>
        <button type="button" id="zoomOutBtn">-</button>
        <div class="theme-switch" id="themeSwitch">
            <span class="theme-icon sun-icon">‚òÄÔ∏è</span>
            <span class="theme-icon moon-icon">üåô</span>
            <div class="theme-switch-handle"></div>
            <div class="theme-transition-overlay" id="themeTransitionOverlay"></div>
        </div>
    </div>
    <div class="drop-zone" id="dropZone">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</div>
    <div id="tree" class="tree"></div>
    
    <div class="image-preview-container" id="previewContainer">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" class="image-preview" id="fullPreview">
    </div>
    <div class="watermark">Interactive Tree v9.2</div>
    <div class="history-log-icon" id="historyLogIcon" title="–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π">üïí</div>
    <div class="history-dialog-backdrop" id="historyDialogBackdrop">
        <div class="history-dialog">
            <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
            <ul class="history-list" id="historyList"></ul>
            <button class="history-dialog-close" id="historyDialogClose">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    <div class="department-management" id="departmentManagement">
        <div class="department-header">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞–º–∏</h2>
            <button id="closeDepartmentManagement">√ó –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="department-container" id="departmentContainer"></div>
    </div>
    <div id="tooltip-container" class="tooltip" style="display: none;"></div>
    <script src="node-effects.js"></script>
    <script src="indexed-db-manager.js"></script>
    <script src="tree-manager-core.js"></script>
    <script>
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É tree-manager-core.js
    console.log('=== –ü–†–û–í–ï–†–ö–ê –ó–ê–ì–†–£–ó–ö–ò –°–ö–†–ò–ü–¢–û–í ===');
    console.log('TreeManager –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof TreeManager !== 'undefined');
    console.log('TreeManagerCore –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof TreeManagerCore !== 'undefined');
    console.log('TreeManager –≤ window:', window.TreeManager);
    console.log('TreeManagerCore –≤ window:', window.TreeManagerCore);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ TreeManager - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è
    if (typeof TreeManager === 'function') {
        console.log('‚úÖ TreeManager –∑–∞–≥—Ä—É–∂–µ–Ω –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è');
        // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
        window.treeManager = new TreeManager();
        console.log('‚úÖ treeManager —Å–æ–∑–¥–∞–Ω:', window.treeManager);
    } else if (typeof window.TreeManager === 'function') {
        console.log('‚úÖ window.TreeManager –∑–∞–≥—Ä—É–∂–µ–Ω');
        window.treeManager = new window.TreeManager();
        console.log('‚úÖ treeManager —Å–æ–∑–¥–∞–Ω –∏–∑ window.TreeManager');
    } else if (typeof TreeManagerCore === 'function') {
        console.log('‚úÖ TreeManagerCore –∑–∞–≥—Ä—É–∂–µ–Ω');
        window.treeManager = new TreeManagerCore();
        console.log('‚úÖ treeManager —Å–æ–∑–¥–∞–Ω –∏–∑ TreeManagerCore');
    } else {
        console.error('‚ùå TreeManager –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
        window.treeManager = {
            initialize: () => console.log('TreeManager –∑–∞–≥–ª—É—à–∫–∞: initialize'),
            updateTree: () => console.log('TreeManager –∑–∞–≥–ª—É—à–∫–∞: updateTree'),
            saveData: () => console.log('TreeManager –∑–∞–≥–ª—É—à–∫–∞: saveData')
        };
    }
</script>
    <script src="main.js"></script>
<script>
console.log('–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ tree-manager-core.js:');
console.log('window.TreeManager:', window.TreeManager);
console.log('window.TreeManagerCore:', window.TreeManagerCore);
console.log('–í—Å–µ –∫–ª—é—á–∏ —Å Tree:', Object.keys(window).filter(k => k.includes('Tree')));
</script>
</body>
</html>
